- feature: Required columns
  schema: >
    User(id)(name) {
      id: Number
      name: String
      required: Boolean
    }
  tests:
    - test: all columns defined is valid
      data:
        User:
          - id: 0
            name: bob
            required: True
    - test: allows missing column
      data:
        User:
          - id: 0
            name: bob
    - test: missing index columns
      data:
        User:
          - required: True
          - required: False
      errors:
        - err: MissingIndex
          col: [id, name]
    - test: missing partial index
      data:
        User:
          - id: 0
            required: True
      errors:
        - err: MissingIndex
          col: name
    - test: missing value in row
      data:
        User:
          - id: 0
            name: bob
            required: True
          - id: 1
            name: sally
      errors:
        - err: MissingValue
          col: required
          row: 1
- feature: Optional columns
  schema: >
    User(id) {
      id: Number
      optional?: Number
      many*: Number
    }
  tests:
    - test: don't allow multiple values
      data:
        User:
          - id: 1
          - id: 2
            optional: 0
          - id: 3
            many: 1
          - id: 4
            optional: [1, 2] # Don't allow multiple values
      errors:
        - err: MultipleValues
          col: optional
          row: [3]
- feature: Multi-Value columns
  schema: >
    Post(id) {
      id: Number
      title: String
      author: String
      tags*: String
    }
  tests:
    - test: aggregate by index and test for multiple values
      data:
        Post:
          - id: 1
            title: [ "Post 1" ] # Single value lists are fine
            author: [ ben, ben ] # Duplicate values are fine
            tags: funny
          - id: 2
            title: "Post 2"
            author: bob
            tags: [funny, great]
          - id: 2 # Should allow entirely missing values
          - id: 3
            title: "Post 3"
            author: bill
          - id: 3
            title: "Post 3 again" # Same post, different title, should throw an error
            author: bill # Same post, same author is fine
          - id: 4
            title: ["Post 4", "Post 4 again"] # Should not allow multiple values in list
            author: susan
      errors:
        - err: MultipleValues
          col: title
          row: [3, 4]
        - err: MultipleValues
          col: title
          row: [5]