import{j as e,r as c}from"./@radix-CFOkMR_E.js";import{P as W,a0 as R,a1 as P,ac as q,a2 as C,a3 as y,a4 as v,aj as S,ak as Q,al as Z,C as Y,Y as E,aw as g,ax as D,M as G,N as K,O as J,S as h,A as z,b as T,B as V,h as N,r as M,z as u,D as X,o as ee,ay as se}from"./index-KsTz2dHG.js";import{S as te}from"./plus-DOeLmm7C.js";import{C as b,R as ae}from"./CopyButton-B3sWVJ4Z.js";import{S as re,P as ne}from"./SearchField-CXoBknpt.js";import{s as p,C as ce,p as A,c as le}from"./persist-BReKApOc.js";import{a as f}from"./@tanstack-k96lU_C-.js";import{L as O,c as ie}from"./@react-router-CO-OsFwI.js";import{D as oe}from"./DisplayDate-DYgIjlDF.js";import{I as de}from"./InlineAvatar-BvBtO2Dp.js";import{S as xe}from"./dots-horizontal-BObFzD5l.js";import{S as me,e as I}from"./components-DWe4cTjS.js";import{I as k}from"./Infobox-iv1Nu1A0.js";import{C as m}from"./CodeSnippet-Cyp7f4dM.js";import{C as he}from"./CollapsibleCard-Cu_A9W57.js";import{F as ue}from"./chevron-right-double-CZBOf6JM.js";import{s as pe}from"./url-rGEp5Umh.js";import"./@reactflow-DIYUhKYX.js";import"./copy-BXNk6BjL.js";import"./stack-detail-query-Ck7j7BP_.js";import"./database-1xWSgZfO.js";import"./chevron-down-D_ZlKMqH.js";function fe(){return e.jsx(W,{children:e.jsx("h1",{className:"text-display-xs font-semibold",children:"Stacks"})})}const je=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.2929 2.29295C17.788 0.797857 20.212 0.797859 21.7071 2.29295C23.2022 3.78805 23.2022 6.21207 21.7071 7.70717L18.7097 10.7045C18.7088 10.7054 18.708 10.7063 18.7071 10.7072C18.7062 10.708 18.7053 10.7089 18.7044 10.7098L8.50078 20.9134C8.48402 20.9302 8.46741 20.9468 8.45093 20.9633C8.20603 21.2086 7.99001 21.425 7.73334 21.5943C7.50768 21.7431 7.26295 21.8607 7.00578 21.9439C6.71327 22.0386 6.40936 22.0722 6.06483 22.1102C6.04165 22.1127 6.01829 22.1153 5.99474 22.1179L2.61038 22.4939C2.30845 22.5275 2.00765 22.422 1.79284 22.2072C1.57803 21.9924 1.47251 21.6916 1.50606 21.3896L1.8821 18.0053C1.88472 17.9817 1.8873 17.9583 1.88985 17.9352C1.92786 17.5906 1.96138 17.2867 2.05607 16.9942C2.13932 16.7371 2.25695 16.4923 2.40576 16.2667C2.57501 16.01 2.79138 15.794 3.03667 15.5491C3.05317 15.5326 3.06981 15.516 3.08657 15.4992L16.2929 2.29295ZM14 7.41427L4.50078 16.9134C4.17827 17.2359 4.1184 17.3025 4.07541 17.3677C4.02581 17.4429 3.9866 17.5245 3.95885 17.6102C3.9348 17.6845 3.92024 17.7728 3.86987 18.2261L3.63187 20.3681L5.77388 20.1301C6.22718 20.0798 6.3155 20.0652 6.3898 20.0412C6.47553 20.0134 6.5571 19.9742 6.63232 19.9246C6.69752 19.8816 6.76406 19.8217 7.08657 19.4992L16.5858 10.0001L14 7.41427ZM18 8.58584L15.4142 6.00006L17.7071 3.70716C18.4211 2.99312 19.5788 2.99312 20.2929 3.70717C21.0069 4.42121 21.0069 5.57891 20.2929 6.29295L18 8.58584Z"})),w=c.forwardRef((s,t)=>{const{triggerChildren:a,children:r,onSelect:n,onOpenChange:i,icon:d,open:x,...l}=s;return e.jsxs(R,{open:x,onOpenChange:i,children:[e.jsx(P,{asChild:!0,children:e.jsx(q,{...l,className:"hover:cursor-pointer",icon:s.icon,ref:t,onSelect:o=>{o.preventDefault(),n&&n()},children:a})}),r]})});w.displayName="DialogItem";const F=c.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(C,{...a,ref:r,children:[e.jsx(y,{children:e.jsx(v,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(H,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${t} -o NEW_ORCHESTRATOR_NAME`})]})]})]}));F.displayName="UpdateStackDialog";const B=c.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(C,{...a,ref:r,children:[e.jsx(y,{children:e.jsx(v,{children:"Delete Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(H,{action:"delete"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Delete a stack"}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack delete ${t}`})]})]})]}));B.displayName="DeleteStackDialog";function H({action:s}){function t(){switch(s){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(k,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",t()," your stack."]})]})})})}function ge({name:s}){const[t,a]=c.useState(!1),[r,n]=c.useState(!1),i=c.useRef(null),d=c.useRef(null);function x(){d.current=i.current}function l(o){a(o),o===!1&&n(!1)}return e.jsx(S,{open:r,onOpenChange:n,children:e.jsxs(S,{children:[e.jsx(Q,{className:"z-10",ref:i,children:e.jsx(xe,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsxs(Z,{hidden:t,onCloseAutoFocus:o=>{d.current&&(d.current.focus(),d.current=null,o.preventDefault())},className:"z-10",align:"end",sideOffset:1,children:[e.jsx(w,{onSelect:x,onOpenChange:l,icon:e.jsx(je,{className:"h-3 w-3 !fill-neutral-400"}),triggerChildren:"Update",children:e.jsx(F,{name:s,className:"lg:min-w-[600px]",closeModal:()=>l(!1)})}),e.jsx(w,{onSelect:x,onOpenChange:l,icon:e.jsx(me,{className:"h-3  w-3 !fill-neutral-400"}),triggerChildren:"Delete",children:e.jsx(B,{name:s,className:"lg:min-w-[600px]",closeModal:()=>l(!1)})})]})]})})}function Ne(){return e.jsx("div",{className:"flex h-9 items-center border-b border-theme-border-moderate bg-theme-surface-primary px-4 py-3",children:e.jsxs(Y,{className:"focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(ue,{className:"h-5 w-5 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Close"})]})})}const _=c.forwardRef(({name:s,children:t,type:a,...r},n)=>e.jsxs(R,{children:[e.jsx(P,{asChild:!0,children:t}),e.jsxs(C,{className:"w-fit max-w-fit",...r,ref:n,children:[e.jsx(y,{children:e.jsx(v,{children:E(a||"")})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(we,{type:a}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Describe your ",g(a)]}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml ${D(a)} describe ${s}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Update your ",g(a)]}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml ${D(a)} update ${s}`})]})]})]})]}));_.displayName="ComponentFallbackDialog";function we({type:s}){return e.jsx(k,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to manage your ",g(s),"."]})]})})})}const $=c.createContext(null);function Ce({children:s}){const[t,a]=c.useState([]);return e.jsx($.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function U(){const s=c.useContext($);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function ye({children:s,stackId:t,stackName:a}){return e.jsxs(G,{children:[e.jsx(K,{children:s}),e.jsx(J,{className:"w-[1000px] overflow-y-auto",children:e.jsxs(Ce,{children:[e.jsx(Ne,{}),e.jsx(ve,{stackId:t}),e.jsx(Se,{name:a}),e.jsx(be,{stackId:t})]})})]})}function ve({stackId:s}){const t=f({...p.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(h,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex items-center space-x-2 border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsx(z,{type:"square",size:"lg",children:e.jsx(T,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(b,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]})}function be({stackId:s}){var n;const{setIntegrations:t}=U(),a=f({...p.stackDetail(s)});if(c.useEffect(()=>{var x;if(!a.data)return;const d=I((x=a.data.metadata)==null?void 0:x.components).map(l=>{var o;return(o=l.body)==null?void 0:o.integration}).filter(l=>!!l&&l!=="built-in"&&l!=="custom");d.length>=1&&t(l=>Array.from(new Set([...l,...d])))},[a.data]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(h,{className:"h-[300px] w-full"})});const r=I((n=a.data.metadata)==null?void 0:n.components);return e.jsx("ul",{className:"space-y-5 p-5",children:r.map(i=>e.jsx("li",{children:e.jsx(ke,{component:i})},i.id))})}function ke({component:s}){var t,a,r,n,i;return e.jsxs(V,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${(t=s.body)==null?void 0:t.flavor} logo`,src:pe(((a=s.body)==null?void 0:a.logo_url)||"")}),e.jsxs("div",{children:[e.jsx(_,{type:((r=s.body)==null?void 0:r.type)||"orchestrator",name:s.name,children:e.jsx("button",{className:"text-text-xl",children:s.name})}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(b,{copyText:s.id})]})]})]}),e.jsx(ce,{type:((n=s.body)==null?void 0:n.type)||"orchestrator",children:E(((i=s.body)==null?void 0:i.type)||"")})]})}function Se({name:s}){const{integrations:t}=U();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(he,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(m,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}function L({children:s}){return e.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-sm bg-primary-100 text-text-lg font-semibold text-theme-text-brand",children:s})}function De(){return[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(z,{type:"square",size:"md",children:e.jsx(T,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(ye,{stackName:t,stackId:a,children:e.jsx("h2",{className:"text-text-md font-semibold",children:t})})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(b,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(oe,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>{var t;return{author:(t=s.body)==null?void 0:t.user}},cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(de,{username:t.name}):null}},{id:"actions",header:"",accessorKey:"name",cell:({getValue:s})=>e.jsx(ge,{name:s()})}]}function Ie({setHasResumeableStack:s}){const{success:t,data:a}=A(),r=f({...p.stackDeploymentStack({provider:(a==null?void 0:a.provider)||"aws",stack_name:(a==null?void 0:a.stackName)||"",date_start:a==null?void 0:a.timestamp}),enabled:t,throwOnError:!0});return c.useEffect(()=>{r.data&&(le(),s(!1))},[r.data]),!t||r.isError?null:r.isPending?e.jsx(h,{className:"h-[70px] w-full"}):e.jsx(k,{className:"w-full",children:e.jsxs("section",{className:"flex flex-wrap items-center justify-between gap-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:"You have a Stack provision incomplete"}),e.jsx("p",{className:"text-text-sm",children:"Return to the setup and finish the configuration on your cloud provider"})]}),e.jsx("div",{children:e.jsx(N,{className:"w-fit bg-theme-surface-primary",intent:"primary",emphasis:"subtle",asChild:!0,children:e.jsx(O,{to:M.stacks.create.newInfra,children:e.jsx("span",{children:"Review Stack"})})})})]})})}const j=1,Le=u.object({page:u.coerce.number().min(j).optional().default(j).catch(j),name:u.string().optional(),operator:u.enum(["and","or"]).optional()});function Re(){const[s]=ie(),{page:t,name:a,operator:r}=Le.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}function Pe(){const[s,t]=c.useState(A().success),a=Re(),{refetch:r,data:n}=f({...p.stackList({...a,sort_by:"desc:updated"}),throwOnError:!0});return e.jsx("section",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(re,{searchParams:a}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(N,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>r(),children:[e.jsx(ae,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(N,{size:"md",asChild:!0,children:e.jsxs(O,{to:M.stacks.create.index,children:[e.jsx(te,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[s&&e.jsx(Ie,{setHasResumeableStack:t}),e.jsx("div",{className:"w-full",children:n?e.jsx(X,{columns:De(),data:n.items}):e.jsx(h,{className:"h-[500px] w-full"})}),n?n.total_pages>1&&e.jsx(ne,{searchParams:a,paginate:n}):e.jsx(h,{className:"h-[36px] w-[300px]"})]})]})})}function es(){const{setCurrentBreadcrumbData:s}=ee(),{setTourState:t,tourState:{tourActive:a}}=se();return c.useEffect(()=>{a&&t(r=>({...r,run:!0,stepIndex:r.stepIndex}))},[a]),c.useEffect(()=>{s({segment:"stacks",data:null})},[]),e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Pe,{})]})}export{es as default};
