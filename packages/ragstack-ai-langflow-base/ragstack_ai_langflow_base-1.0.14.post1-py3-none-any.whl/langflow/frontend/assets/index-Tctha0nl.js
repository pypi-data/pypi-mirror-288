import{U as Y,a as V,g as ee,r as h,j as e,c as U,I as N,at as te,u as O,au as w,av as ve,l as j,z as $,S as R,i as M,as as ye,aw as Ce}from"./index-DYkSp9FA.js";import{C as be,u as Q,a as De,F as Fe,S as X,I as Ne}from"./index-CbQ1gxPo.js";import{P as Le}from"./index-BSBPG_5q.js";import{D as ke}from"./index-BpdXL-yr.js";import{N as Ee}from"./index-Cnj-yD2z.js";import{C as Ie}from"./checkbox-DNvnWRqS.js";import"./index-uB9Qfw-v.js";import"./index-D0UpKyR9.js";import"./index-CnIOm5PD.js";import"./input-B07-Z9fW.js";import"./addNewVariableButton-ean5a0gx.js";import"./popover-DF2l564d.js";import"./index-CSSgyQG4.js";import"./label-aRG2Gi51.js";import"./separator-C8Y4kPf6.js";import"./select-BlBc_MxU.js";import"./index-B-dA8edK.js";const Te=t=>{const{mutate:l}=Y(),r=async n=>(await V.post(`${ee("FLOWS")}/download/`,n.flow_ids,{responseType:"blob"})).data;return l(["usePostDownloadMultipleFlows"],async n=>await r(n),t)},Ue=t=>{const{mutate:l}=Y();return l(["useLoginUser"],async n=>(await V.delete(`${ee("FLOWS")}/`,{data:n.flow_ids})).data,t)};function Me({onFileDrop:t,children:l,dragMessage:r}){const[i,n]=h.useState(!1);h.useEffect(()=>{const d=()=>{document.visibilityState==="visible"&&n(!1)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]);const s=d=>{d.preventDefault(),d.dataTransfer.types.some(c=>c==="Files")&&t&&n(!0)},o=d=>{d.dataTransfer.types.some(c=>c==="Files")&&t&&n(!0),d.preventDefault()},p=d=>{d.preventDefault(),t&&n(!1)},m=d=>{d.preventDefault(),t&&t(d),n(!1)};return e.jsx("div",{onDragOver:s,onDragEnter:o,onDragLeave:p,onDrop:m,className:U("h-full w-full",i?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:i?e.jsxs(e.Fragment,{children:[e.jsx(N,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),r||"Drop your file here"]}):l})}const Oe=(t,l)=>{var d;const r=te(),i=O(c=>c.setSuccessData),n=O(c=>c.setErrorData),s=w(c=>c.getFolderById),o=(d=r==null?void 0:r.state)==null?void 0:d.folderId,p=w(c=>c.myCollectionId);return[c=>{if(c.preventDefault(),c.dataTransfer.types.some(f=>f==="Files")){const f=c.dataTransfer.files,u=[];for(let S=0;S<f.length;S++){const g=f[S];if(g.type==="application/json"){const b=new FileReader,L=new Promise((k,C)=>{b.onload=D=>{const E=D.target.result;JSON.parse(E).is_component,t({newProject:!0,file:g,isComponent:l==="all"?null:l==="component"}).then(x=>k()).catch(x=>{C(x)})},b.readAsText(g)});u.push(L)}}Promise.all(u).then(()=>{i({title:"All files uploaded successfully"}),s(o||p)}).catch(S=>{n({title:ve,list:[S]})})}}]},_e=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},Pe=(t,l)=>{const r=l==="component",i=(s,o)=>{const p=(s==null?void 0:s.updated_at)||(s==null?void 0:s.date_created),m=(o==null?void 0:o.updated_at)||(o==null?void 0:o.date_created);return p&&m?new Date(m).getTime()-new Date(p).getTime():p?1:m?-1:0},n=l==="all"?t:t==null?void 0:t.filter(s=>((s==null?void 0:s.is_component)??!1)===r);return(n==null?void 0:n.sort(i))??[]},Ae=({})=>{j(r=>r.addFlow),$();const[t,l]=h.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(Ee,{open:t,setOpen:l}),e.jsx("button",{onClick:()=>{l(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},Re=({handleSelectAll:t,handleDelete:l,handleDuplicate:r,handleExport:i,disableFunctions:n,setShouldSelectAll:s,shouldSelectAll:o})=>{const p=()=>{t(o),s(m=>!m)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:p,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{checked:!o,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:o?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(R,{content:n?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(M,{unstyled:!0,onClick:i,disabled:n,children:e.jsx(N,{name:"FileDown",className:U("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(R,{content:n?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(M,{unstyled:!0,onClick:r,disabled:n,children:e.jsx(N,{name:"Copy",className:U("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(R,{content:n?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(M,{unstyled:!0,onClick:l,disabled:n,children:e.jsx(N,{name:"Trash2",className:U("h-5 w-5 text-primary transition-all",n?"":"hover:text-status-red")})})})})]})]})})},$e=({item:t,type:l,isLoading:r,control:i})=>{const n=$(),s=t.is_component??!1,o=`/flow/${t.id}`,p=`edit-flow-button-${t.id}`,m=w(g=>g.folderUrl),d=w(g=>g.myCollectionId),f=m!=null&&m!==""?m:d,u=()=>{s||n(o,{state:{folderId:f}})},S=()=>s?null:e.jsx(ye,{to:o,children:e.jsxs(M,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":p,children:[e.jsx(N,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})});return e.jsx(be,{data:{is_component:s,...t},disabled:r,"data-testid":p,button:S(),onClick:s?void 0:u,playground:!s,control:i})},Be=(t,l)=>h.useMemo(()=>{const i=s=>({all:"item",component:"component",flow:"flow"})[s]||"",n=s=>({all:"items",component:"components",flow:"flows"})[s]||"";return(t==null?void 0:t.length)===1?i(l):n(l)},[t,l]),ze=(t,l,r)=>{h.useEffect(()=>{const n=Ce(t||[]).filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.description.toLowerCase().includes(l.toLowerCase()));r(l===""?t:n)},[t,l,r])},We=(t,l,r,i,n,s,o,p,m,d,c,f)=>({handleDuplicate:h.useCallback(()=>{Promise.all(t.map(S=>l(!0,r.find(g=>g.id===S)))).then(()=>{i(),n(!0),(!s||s===o)&&p(s||o),m({title:`${f} duplicated successfully`}),d([]),c(!1)})},[t,l,r,i,n,s,o,p,m,d,c,f])}),He=(t,l,r)=>({handleSelectAll:h.useCallback(n=>{const s=t==null?void 0:t.map(o=>o.id);if(n){Object.keys(l()).forEach(o=>{s!=null&&s.includes(o)&&r(o,!0)});return}Object.keys(l()).forEach(o=>{r(o,!1)})},[t,l,r])}),Je=(t,l,r,i,n)=>({handleSelectOptionsChange:h.useCallback(o=>{if(!((t==null?void 0:t.length)>0)){l({title:"No items selected",list:["Please select items to delete"]});return}o==="delete"?r(!0):o==="duplicate"?i():o==="export"&&n()},[t,l,r,i,n])}),qe=(t,l)=>{h.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const r=Object.keys(t).filter(i=>t[i]===!0);l(r)},[t,l])};function Ge({type:t="all"}){var K;const l=j(a=>a.uploadFlow);j(a=>a.removeFlow);const r=j(a=>a.isLoading),i=j(a=>a.setAllFlows),n=j(a=>a.allFlows),s=w(a=>{var y;return(y=a.selectedFolder)==null?void 0:y.flows}),o=O(a=>a.setSuccessData),p=O(a=>a.setErrorData),[m,d]=h.useState(!1),c=j(a=>a.searchFlowsComponents),f=j(a=>a.setSelectedFlowsComponentsCards),u=j(a=>a.selectedFlowsComponentsCards),[S]=Oe(l,t),[g,b]=h.useState(20),[L,k]=h.useState(1),C=te(),D=Pe(n,t),E=(L-1)*g,B=E+g,x=D==null?void 0:D.slice(E,B),ne=_e(t),v=(K=C==null?void 0:C.state)==null?void 0:K.folderId,_=w(a=>a.getFolderById),I=w(a=>a.myCollectionId),z=w(a=>a.getFoldersApi),se=w(a=>a.setFolderUrl),oe=j(a=>a.addFlow),W=w(a=>a.isLoadingFolders),le=w(a=>a.setSelectedFolder),[ae,H]=h.useState(!0),J=h.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);h.useEffect(()=>{se(v??""),f([]),T(!1),_(v||I)},[C]),ze(s,c,i);const q=()=>{k(1),b(20)},{getValues:re,control:G,setValue:ce}=Q(),ie=De({control:G}),de=Q(),{handleSelectAll:T}=He(s,re,ce),{handleDuplicate:ue}=We(u,oe,n,q,z,v,I,_,o,f,T,J),{mutate:pe}=Te(),me=()=>{pe({flow_ids:u},{onSuccess:a=>{const y=n.find(Se=>Se.id===u[0]),we=u.length>1?"application/zip":"application/json",Z=u.length>1?"_langflow_flows.zip":`${y.name}.json`,je=new Blob([a],{type:we}),F=document.createElement("a");F.href=window.URL.createObjectURL(je);let A=new Date().toISOString().replace(/[:.]/g,"");A=A.replace(/-/g,"").replace(/T/g,"").replace(/Z/g,""),F.download=u.length>1?`${A}${Z}`:`${Z}`,document.body.appendChild(F),F.click(),document.body.removeChild(F),o({title:`${J} exported successfully`}),f([]),T(!1),H(!0)}})},{handleSelectOptionsChange:P}=Je(u,p,d,ue,me),{mutate:fe}=Ue(),he=()=>{fe({flow_ids:u},{onSuccess:()=>{i([]),le(null),q(),z(!0),(!v||v===I)&&_(v||I),o({title:"Selected items deleted successfully"})},onError:()=>{p({title:"Error deleting items",list:["Please try again"]})}})};qe(ie,f);const xe=Be(u,t),ge=()=>{var a;return t==="all"?n==null?void 0:n.length:(a=n==null?void 0:n.filter(y=>(y.is_component??!1)===(t==="component")))==null?void 0:a.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(n==null?void 0:n.length)>0&&e.jsx(Re,{shouldSelectAll:ae,setShouldSelectAll:H,handleDelete:()=>P("delete"),handleSelectAll:T,handleDuplicate:()=>P("duplicate"),handleExport:()=>P("export"),disableFunctions:!((u==null?void 0:u.length)>0)})}),e.jsx(Me,{onFileDrop:S,dragMessage:`Drag your ${ne} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between","data-testid":"cards-wrapper",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!r&&!W&&(x==null?void 0:x.length)===0?e.jsx(Ae,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:r===!1&&(x==null?void 0:x.length)>0&&W===!1?e.jsx(e.Fragment,{children:x==null?void 0:x.map(a=>h.createElement(Fe,{...de,key:a.id},e.jsx("form",{children:e.jsx($e,{item:a,type:t,isLoading:r,control:G})})))}):e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(X,{})]})})}),!r&&(x==null?void 0:x.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(Le,{storeComponent:!0,pageIndex:L,pageSize:g,rowsCount:[10,20,50,100],totalRowsCount:ge(),paginate:(a,y)=>{k(y),b(a)}})})]})}),m&&e.jsx(ke,{open:m,setOpen:d,onConfirm:he,description:xe,children:e.jsx(e.Fragment,{})})]})}const Ke=({tabsOptions:t,setActiveTab:l,loading:r,tabActive:i})=>{const n=$(),s=w(c=>c.folderUrl),o=w(c=>c.myCollectionId),m=s!=null&&s!==""?s:o,d=c=>{const f=window.location.pathname;let u="";switch(c){case"Flows":u=f.replace(/components|all/,"flows");break;case"Components":u=f.replace(/flows|all/,"components");break;default:u=f.replace(/flows|components/,"all");break}n(u,{state:{folderId:m}})};return h.useEffect(()=>{const c=window.location.pathname;c.includes("components")?l("Components"):c.includes("flows")?l("Flows"):l("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((c,f)=>e.jsx("button",{"data-testid":`${c}-button-store`,disabled:r,onClick:()=>{d(c)},className:(i===c?"border-b-2 border-primary p-3":"border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(r?" cursor-not-allowed":""),children:c},f))})})},Ze=({})=>{const t=j(o=>o.isLoading),[l,r]=h.useState("Flows"),[i,n]=h.useState(""),s=j(o=>o.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(Ne,{loading:t,value:i,onChange:o=>{s(o.target.value),n(o.target.value)},onKeyDown:o=>{o.key==="Enter"&&s(i)}}),e.jsx(Ke,{tabsOptions:["All","Flows","Components"],setActiveTab:r,loading:t,tabActive:l})]})})},mt=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Ze,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(Ge,{type:t},t)})]});export{mt as default};
