import{U as v,a as E,g as N,aQ as te,r as p,j as e,I as ne,$ as C,aB as b,aR as _,aE as I,aD as R,aC as k,b as P,f as A,aS as K,k as $,i as y,aT as Y,ag as re,aU as oe,c as le,aV as O,aW as ie,aX as ce,aY as de,aZ as ue,l as me,ar as pe,a_ as he,u as V,A as G,ac as h,a9 as xe,a$ as fe,b0 as ge,b1 as H,b2 as M,w as je}from"./index-DYkSp9FA.js";import{u as ye}from"./use-patch-update-user-wfBJvF_5.js";import{I as S}from"./index-CSSgyQG4.js";import"./input-B07-Z9fW.js";import"./popover-DF2l564d.js";const we=t=>{const{mutate:o}=v();async function n({user_id:a,password:r}){return(await E.patch(`${N("USERS")}/${a}/reset-password`,r)).data}return o(["useResetPassword"],n,t)},Pe=t=>{const{mutate:o}=v();return o(["usePostAddApiKey"],async a=>(await E.post(`${N("API_KEY")}/store`,{api_key:a.key})).data,t)},Ae=()=>{const{query:t}=v(),o=async()=>(await E.get(`${N("FILES")}/profile_pictures/list`)).data;return t(["useGetProfilePicturesQuery"],async()=>{var l;const a=await o(),r={};return(l=a==null?void 0:a.files)==null||l.forEach(u=>{const[i,g]=u.split("/");r[i]?r[i].push(g):r[i]=[g]}),r},{placeholderData:te})},Se=(t,o)=>{p.useEffect(()=>{const n=document.getElementById(t??"null");n&&n.scrollIntoView({behavior:"smooth"})},[t]),p.useEffect(()=>{o("")},[o])},ve=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(ne,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),Ee=({password:t,cnfPassword:o,handleInput:n,handlePatchPassword:c})=>e.jsx(e.Fragment,{children:e.jsx(C,{onSubmit:a=>{c(t,o,n),a.preventDefault()},children:e.jsxs(b,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(_,{children:[e.jsx(I,{children:"Password"}),e.jsx(R,{children:"Type your new password and confirm it."})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(P,{name:"password",className:"w-full",children:[e.jsx(S,{id:"pasword",onChange:a=>{n({target:{name:"password",value:a}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(P,{name:"cnfPassword",className:"w-full",children:[e.jsx(S,{id:"cnfPassword",onChange:a=>{n({target:{name:"cnfPassword",value:a}})},value:o,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(A,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(y,{type:"submit",children:"Save"})})})]})})}),Ne=(t,o,n)=>{const c=async a=>Promise.all(a.map(r=>new Promise(l=>{const u=new Image;u.src=r,u.onload=l,u.onerror=l})));p.useEffect(()=>{if(n||!t)return;const a=[];Object.keys(t).flatMap(r=>t[r].map(l=>a.push(`${Y}files/profile_pictures/${r}/${l}`))),c(a).then(()=>{o(!0)})},[t,n])};function Ce({profilePictures:t,loading:o,value:n,onChange:c}){const a=p.useRef(null),r=re(i=>i.dark),[l,u]=p.useState(!1);return p.useEffect(()=>{var i;n&&a&&((i=a.current)==null||i.scrollIntoView({behavior:"smooth",block:"center"}))},[a,n]),Ne(t,u,o),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:o||!l?e.jsx(oe,{}):Object.keys(t).map((i,g)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:i})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[i].map((x,w)=>e.jsx(y,{ref:n===i+"/"+x?a:void 0,unstyled:!0,onClick:()=>c(i+"/"+x),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${Y}files/profile_pictures/${i+"/"+x}`,style:{filter:n===i+"/"+x?r?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:le("h-12 w-12")},w)}))})})]}))})}const be=({profilePicture:t,handleInput:o,handlePatchProfilePicture:n,handleGetProfilePictures:c,userData:a})=>{const{data:r,isFetching:l}=c;return e.jsx(C,{onSubmit:u=>{n(t),u.preventDefault()},children:e.jsxs(b,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(_,{children:[e.jsx(I,{children:"Profile Picture"}),e.jsx(R,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(k,{children:e.jsx("div",{className:"py-2",children:e.jsx(Ce,{profilePictures:r,loading:l,value:t==""?(a==null?void 0:a.profile_image)??O[parseInt((a==null?void 0:a.id)??"",30)%O.length]:t,onChange:u=>{o({target:{name:"profilePicture",value:u}})}})})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(y,{type:"submit",children:"Save"})})})]})})},_e=({apikey:t,handleInput:o,handleSaveKey:n,loadingApiKey:c,validApiKey:a,hasApiKey:r})=>e.jsx(e.Fragment,{children:e.jsx(C,{onSubmit:l=>{l.preventDefault(),n(t,o)},children:e.jsxs(b,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(_,{children:[e.jsx(I,{children:"Store API Key"}),e.jsx(R,{children:(r&&!a?ie:r?"":ce)+de})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(P,{name:"apikey",className:"w-full",children:[e.jsx(S,{id:"apikey",onChange:l=>{o({target:{name:"apikey",value:l}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[ue," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(y,{loading:c,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Fe=()=>{const t=me(s=>s.setCurrentFlowId),{scrollId:o}=pe(),[n,c]=p.useState(he),a=V(s=>s.setSuccessData),r=V(s=>s.setErrorData),{userData:l,setUserData:u}=p.useContext(G),i=h(s=>s.hasStore),g=h(s=>s.validApiKey),x=h(s=>s.hasApiKey),w=h(s=>s.loadingApiKey),{password:j,cnfPassword:F,profilePicture:q,apikey:B}=n,Q=xe(s=>s.autoLogin),{storeApiKey:W}=p.useContext(G),L=h(s=>s.updateHasApiKey),T=h(s=>s.updateValidApiKey),U=h(s=>s.updateLoadingApiKey),{mutate:z}=we(),{mutate:X}=ye(),Z=()=>{if(j!==F){r({title:fe,list:[ge]});return}j!==""&&z({user_id:l.id,password:{password:j}},{onSuccess:()=>{f({target:{name:"password",value:""}}),f({target:{name:"cnfPassword",value:""}}),a({title:H})},onError:s=>{var d,m;r({title:M,list:[(m=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:m.detail]})}})},J=Ae(),ee=s=>{s!==""&&X({user_id:l.id,user:{profile_image:s}},{onSuccess:()=>{let d=je.cloneDeep(l);d.profile_image=s,u(d),a({title:H})},onError:d=>{var m,D;r({title:M,list:[(D=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:D.detail]})}})};Se(o,t);const{mutate:se}=Pe({onSuccess:()=>{a({title:"API key saved successfully"}),L(!0),T(!0),U(!1),f({target:{name:"apikey",value:""}})},onError:s=>{var d,m;r({title:"API key save error",list:[(m=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:m.detail]}),L(!1),T(!1),U(!1)}}),ae=s=>{s&&(se({key:s}),W(s))};function f({target:{name:s,value:d}}){c(m=>({...m,[s]:d}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(ve,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(be,{profilePicture:q,handleInput:f,handlePatchProfilePicture:ee,handleGetProfilePictures:J,userData:l}),!Q&&e.jsx(Ee,{password:j,cnfPassword:F,handleInput:f,handlePatchPassword:Z}),i&&e.jsx(_e,{apikey:B,handleInput:f,handleSaveKey:ae,loadingApiKey:w,validApiKey:g,hasApiKey:x})]})]})};export{Fe as GeneralPage,Fe as default};
