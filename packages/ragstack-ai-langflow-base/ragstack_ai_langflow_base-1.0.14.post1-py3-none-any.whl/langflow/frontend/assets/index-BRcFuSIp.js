import{U as me,a as ue,g as xe,r,j as e,c as j,C as he,A as ie,B as M,$ as pe,b as I,d as k,e as $,f as F,E as Q,h as Y,i as J,k as fe,n as je,u as Z,l as Ne,m as ee,I as P,o as ge,p as ve,L as Ce,S as W,q as be,s as we,t as X,v as G,w as se,x as Se,y as te}from"./index-DYkSp9FA.js";import{u as Ee}from"./use-patch-update-user-wfBJvF_5.js";import{u as _e}from"./use-post-add-user-BCVunCN8.js";import{H as ye}from"./index-BcZLMy_U.js";import{P as Te}from"./index-BSBPG_5q.js";import{C as ae,a as re}from"./checkbox-DNvnWRqS.js";import{I as Ue}from"./input-B07-Z9fW.js";import{C as m}from"./index-_Rr2e0sv.js";import"./popover-DF2l564d.js";import"./index-D0UpKyR9.js";import"./separator-C8Y4kPf6.js";import"./index-BaEpDvL8.js";import"./label-aRG2Gi51.js";import"./shortcuts-DpxtRUV4.js";import"./select-BlBc_MxU.js";import"./index-B-dA8edK.js";const Re=i=>{const{mutate:l}=me();return l(["useDeleteUsers"],async({user_id:S})=>(await ue.delete(`${xe("USERS")}/${S}`)).data,i)},le=r.forwardRef(({className:i,...l},c)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:c,className:j("w-full caption-bottom text-sm",i),...l})}));le.displayName="Table";const ce=r.forwardRef(({className:i,...l},c)=>e.jsx("thead",{ref:c,className:j("[&_tr]:border-b",i),...l}));ce.displayName="TableHeader";const oe=r.forwardRef(({className:i,...l},c)=>e.jsx("tbody",{ref:c,className:j("[&_tr:last-child]:border-0",i),...l}));oe.displayName="TableBody";const De=r.forwardRef(({className:i,...l},c)=>e.jsx("tfoot",{ref:c,className:j("bg-primary font-medium text-primary-foreground",i),...l}));De.displayName="TableFooter";const K=r.forwardRef(({className:i,...l},c)=>e.jsx("tr",{ref:c,className:j("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...l}));K.displayName="TableRow";const p=r.forwardRef(({className:i,...l},c)=>e.jsx("th",{ref:c,className:j("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...l}));p.displayName="TableHead";const f=r.forwardRef(({className:i,...l},c)=>e.jsx("td",{ref:c,className:j("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...l}));f.displayName="TableCell";const Ae=r.forwardRef(({className:i,...l},c)=>e.jsx("caption",{ref:c,className:j("mt-4 text-sm text-muted-foreground",i),...l}));Ae.displayName="TableCaption";function ne({title:i,titleHeader:l,cancelText:c,confirmationText:E,children:S,icon:_,data:n,index:N,onConfirm:g,asChild:u}){const O=je[_],[v,y]=r.useState(!1),[C,L]=r.useState(!1),[b,T]=r.useState(!1),[d,H]=r.useState((n==null?void 0:n.password)??""),[x,U]=r.useState((n==null?void 0:n.username)??""),[w,h]=r.useState((n==null?void 0:n.password)??""),[R,z]=r.useState((n==null?void 0:n.is_active)??!1),[D,B]=r.useState((n==null?void 0:n.is_superuser)??!1),[V,q]=r.useState(he),{userData:s}=r.useContext(ie);function a({target:{name:t,value:A}}){q(de=>({...de,[t]:A}))}r.useEffect(()=>{n?(a({target:{name:"username",value:x}}),a({target:{name:"is_active",value:R}}),a({target:{name:"is_superuser",value:D}})):o()},[b]);function o(){H(""),U(""),h("")}return e.jsxs(M,{size:"medium-h-full",open:b,setOpen:T,children:[e.jsx(M.Trigger,{asChild:u,children:S}),e.jsxs(M.Header,{description:l,children:[e.jsx("span",{className:"pr-2",children:i}),e.jsx(O,{name:"icon",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(M.Content,{children:e.jsxs(pe,{onSubmit:t=>{if(d!==w){t.preventDefault();return}o(),g(1,V),T(!1),t.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(I,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{a({target:{name:"username",value:t}}),U(t)},value:x,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(F,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(I,{name:"password",serverInvalid:d!=w,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),v&&e.jsx(Q,{onClick:()=>y(!v),className:"h-5 cursor-pointer",strokeWidth:1.5}),!v&&e.jsx(Y,{onClick:()=>y(!v),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{a({target:{name:"password",value:t}}),H(t)},value:d,className:"primary-input",required:!n,type:v?"text":"password"})}),e.jsx(F,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),d!=w&&e.jsx(F,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(I,{name:"confirmpassword",serverInvalid:d!=w,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(k,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),C&&e.jsx(Q,{onClick:()=>L(!C),className:"h-5 cursor-pointer",strokeWidth:1.5}),!C&&e.jsx(Y,{onClick:()=>L(!C),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:t=>{h(t.target.value)},value:w,className:"primary-input",required:!n,type:C?"text":"password"})}),e.jsx(F,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(I,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(k,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx($,{asChild:!0,children:e.jsx(ae,{value:R,checked:R,id:"is_active",className:"relative top-0.5",onCheckedChange:t=>{a({target:{name:"is_active",value:t}}),z(t)}})})]})}),(s==null?void 0:s.is_superuser)&&e.jsx(I,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(k,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx($,{asChild:!0,children:e.jsx(ae,{checked:D,value:D,id:"is_superuser",className:"relative top-0.5",onCheckedChange:t=>{a({target:{name:"is_superuser",value:t}}),B(t)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(J,{variant:"outline",onClick:()=>{T(!1)},className:"mr-3",children:c}),e.jsx(fe,{asChild:!0,children:e.jsx(J,{className:"mt-8",children:E})})]})]})})]})}function Je(){const[i,l]=r.useState(""),[c,E]=r.useState(12),[S,_]=r.useState(1),[n,N]=r.useState(!0),g=Z(s=>s.setSuccessData),u=Z(s=>s.setErrorData),{userData:O}=r.useContext(ie),[v,y]=r.useState(0),C=Ne(s=>s.setCurrentFlowId),{mutate:L}=Re(),{mutate:b}=Ee(),{mutate:T}=_e();r.useEffect(()=>{C("")},[]);const d=r.useRef([]);r.useEffect(()=>{setTimeout(()=>{U()},500)},[]);const[H,x]=r.useState(d.current);function U(){N(!0),ee(S-1,c).then(s=>{y(s.total_count),d.current=s.users,x(s.users),N(!1)}).catch(s=>{N(!1)})}function w(s,a){N(!0),E(a),_(s),ee(a*(s-1),a).then(o=>{y(o.total_count),d.current=o.users,x(o.users),N(!1)}).catch(o=>{N(!1)})}function h(){_(1),E(10),U()}function R(s){if(l(s),s==="")x(d.current);else{const a=d.current.filter(o=>o.username.toLowerCase().includes(s.toLowerCase()));x(a)}}function z(s){L({user_id:s.id},{onSuccess:()=>{h(),g({title:be})},onError:a=>{u({title:we,list:[a.response.data.detail]})}})}function D(s,a){b({user_id:s,user:a},{onSuccess:()=>{h(),g({title:X})},onError:o=>{u({title:G,list:[o.response.data.detail]})}})}function B(s,a,o){const t=se.cloneDeep(o);t.is_active=!s,b({user_id:a,user:t},{onSuccess:()=>{h(),g({title:X})},onError:A=>{u({title:G,list:[A.response.data.detail]})}})}function V(s,a,o){const t=se.cloneDeep(o);t.is_superuser=!s,b({user_id:a,user:t},{onSuccess:()=>{h(),g({title:X})},onError:A=>{u({title:G,list:[A.response.data.detail]})}})}function q(s){T(s,{onSuccess:a=>{b({user_id:a.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{h(),g({title:Se})},onError:o=>{u({title:te,list:[o.response.data.detail]})}})},onError:a=>{u({title:te,list:[a.response.data.detail]})}})}return e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),O&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(P,{name:"Shield",className:"w-6"}),ge]})}),e.jsx("span",{className:"admin-page-description-text",children:ve}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(Ue,{placeholder:"Search Username",value:i,onChange:s=>R(s.target.value)}),i.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{l(""),x(d.current)},children:e.jsx(P,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(P,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(ne,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,a)=>{q(a)},asChild:!0,children:e.jsx(J,{variant:"primary",children:"New User"})})})]}),n?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(Ce,{remSize:12})}):d.current.length===0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-full overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(n?" border-0":""),children:e.jsxs(le,{className:"table-fixed outline-1",children:[e.jsx(ce,{className:n?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(K,{children:[e.jsx(p,{className:"h-10",children:"Id"}),e.jsx(p,{className:"h-10",children:"Username"}),e.jsx(p,{className:"h-10",children:"Active"}),e.jsx(p,{className:"h-10",children:"Superuser"}),e.jsx(p,{className:"h-10",children:"Created At"}),e.jsx(p,{className:"h-10",children:"Updated At"}),e.jsx(p,{className:"h-10 w-[100px] text-right"})]})}),!n&&e.jsx(oe,{children:H.map((s,a)=>e.jsxs(K,{children:[e.jsx(f,{className:"truncate py-2 font-medium",children:e.jsx(W,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(f,{className:"truncate py-2",children:e.jsx(W,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(f,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(m,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(o,t)=>{B(t.is_active,t.id,t)},children:[e.jsx(m.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(m.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(re,{checked:s.is_active})})})]})}),e.jsx(f,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(m,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(o,t)=>{V(t.is_superuser,t.id,t)},children:[e.jsx(m.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(m.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(re,{checked:s.is_superuser})})})]})}),e.jsx(f,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(f,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(f,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(ne,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:a,onConfirm:(o,t)=>{D(s.id,t)},children:e.jsx(W,{content:"Edit",side:"top",children:e.jsx(P,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(m,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:a,onConfirm:(o,t)=>{z(t)},children:[e.jsx(m.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(m.Trigger,{children:e.jsx(P,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},a))})]})}),e.jsx(Te,{pageIndex:S,pageSize:c,totalRowsCount:v,paginate:(s,a)=>{w(a,s)}})]})]})]})}export{Je as default};
