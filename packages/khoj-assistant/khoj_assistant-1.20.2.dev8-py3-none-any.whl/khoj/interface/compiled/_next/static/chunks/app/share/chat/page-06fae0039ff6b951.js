(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3111],{91955:function(e,t,n){Promise.resolve().then(n.bind(n,5506))},69591:function(e,t,n){"use strict";n.d(t,{EK:function(){return i},LF:function(){return a},k6:function(){return c}});var s=n(29039);let o=()=>window.fetch("https://ipapi.co/json").then(e=>e.json()).catch(e=>console.log(e)),a=e=>e.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());function i(){console.log("%c %s","font-family:monospace",'\n        __  __     __  __     ______       __        _____      __\n       /\\ \\/ /    /\\ \\_\\ \\   /\\  __ \\     /\\ \\      /\\  __ \\   /\\ \\\n       \\ \\  _"-.  \\ \\  __ \\  \\ \\ \\/\\ \\   _\\_\\ \\     \\ \\  __ \\  \\ \\ \\\n        \\ \\_\\ \\_\\  \\ \\_\\ \\_\\  \\ \\_____\\ /\\_____\\     \\ \\_\\ \\_\\  \\ \\_\\\n         \\/_/\\/_/   \\/_/\\/_/   \\/_____/ \\/_____/      \\/_/\\/_/   \\/_/\n\n\n       Greetings traveller,\n\n       I am ✨Khoj✨, your open-source, personal AI copilot.\n\n       See my source code at https://github.com/khoj-ai/khoj\n       Read my operating manual at https://docs.khoj.dev\n       ')}function c(){let{data:e,error:t}=(0,s.ZP)("/api/ip",o,{revalidateOnFocus:!1});return t||!e?null:e}},82697:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var s=n(57437),o=n(15238),a=n.n(o),i=n(2265),c=n(89178),r=n(94880),l=n(58485),u=n(16288),d=n(26100),h=n(19666),g=n(50495),_=e=>{let{name:t,avatar:n,link:o,description:a}=e;return(0,s.jsx)("div",{className:"relative group flex",children:(0,s.jsx)(h.pn,{children:(0,s.jsxs)(h.u,{children:[(0,s.jsx)(h.aJ,{asChild:!0,children:(0,s.jsxs)(g.z,{variant:"ghost",className:"flex items-center justify-center",children:[n,(0,s.jsx)("div",{children:t})]})}),(0,s.jsx)(h._v,{children:(0,s.jsxs)("div",{className:"w-80 h-30",children:[(0,s.jsx)("a",{href:o,target:"_blank",rel:"noreferrer",className:"mt-1 ml-2 block no-underline",children:(0,s.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[n,(0,s.jsxs)("div",{className:"mr-2 mt-1 flex justify-center items-center text-sm font-semibold text-gray-800",children:[t,(0,s.jsx)(d.o,{weight:"bold",className:"ml-1"})]})]})}),a&&(0,s.jsx)("p",{className:"mt-2 ml-6 text-sm text-gray-600 line-clamp-2",children:a||"A Khoj agent"})]})})]})})})},f=n(89417);function m(e){let[t,n]=(0,i.useState)(null),[o,d]=(0,i.useState)(0),[h,g]=(0,i.useState)(!0),m=(0,i.useRef)(null),p=(0,i.useRef)(null),x=(0,i.useRef)(null),[v,y]=(0,i.useState)(null),[j,w]=(0,i.useState)(!1),[b,C]=(0,i.useState)(!1);(0,i.useEffect)(()=>{window.addEventListener("resize",()=>{C(window.innerWidth<768)}),C(window.innerWidth<768)},[]),(0,i.useEffect)(()=>{o<2&&((null==t?void 0:t.chat.length)||setTimeout(()=>{S()},500))},[t,o]),(0,i.useEffect)(()=>{if(!h||j)return;let s=new IntersectionObserver(s=>{s[0].isIntersecting&&h&&(w(!0),function(s){if(!h||j)return;let o=s+1,a="";if(e.conversationId)a="/api/chat/history?client=web&conversation_id=".concat(e.conversationId,"&n=").concat(10*o);else{if(!e.publicConversationSlug)return;a="/api/chat/share/history?client=web&public_conversation_slug=".concat(e.publicConversationSlug,"&n=").concat(10*o)}fetch(a).then(e=>e.json()).then(o=>{if(e.setTitle(o.response.slug),o&&o.response&&o.response.chat&&o.response.chat.length>0){if(o.response.chat.length===(null==t?void 0:t.chat.length)){g(!1),w(!1);return}e.setAgent(o.response.agent),n(o.response),s<2&&S(),w(!1)}else{if(o.response.agent&&o.response.conversation_id){let t={chat:[],agent:o.response.agent,conversation_id:o.response.conversation_id,slug:o.response.slug};e.setAgent(o.response.agent),n(t)}g(!1),w(!1)}}).catch(e=>{console.error(e),window.location.href="/"})}(o),d(e=>e+1))},{threshold:1});return x.current&&s.observe(x.current),()=>s.disconnect()},[h,o,j]),(0,i.useEffect)(()=>{g(!0),w(!1),d(0),n(null)},[e.conversationId]),(0,i.useEffect)(()=>{if(e.incomingMessages){let t=e.incomingMessages[e.incomingMessages.length-1];t&&!t.completed&&y(e.incomingMessages.length-1)}M()&&S()},[e.incomingMessages]);let S=()=>{p.current&&p.current.scrollIntoView(!1)},M=()=>{if(!p.current)return!1;let{scrollTop:e,scrollHeight:t,clientHeight:n}=p.current;return e+n>=t-25};return e.conversationId||e.publicConversationSlug?(0,s.jsx)(r.x,{className:"h-[80vh]",children:(0,s.jsx)("div",{ref:m,children:(0,s.jsxs)("div",{className:a().chatHistory,ref:p,children:[(0,s.jsx)("div",{ref:x,style:{height:"1px"},children:j&&(0,s.jsx)(l.l,{message:"Loading Conversation",className:"opacity-50"})}),t&&t.chat&&t.chat.map((e,n)=>(0,s.jsx)(c.Z,{isMobileWidth:b,chatMessage:e,customClassName:"fullHistory",borderLeftColor:"".concat(null==t?void 0:t.agent.color,"-500"),isLastMessage:n===t.chat.length-1},"".concat(n,"fullHistory"))),e.incomingMessages&&e.incomingMessages.map((e,n)=>(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)(c.Z,{isMobileWidth:b,chatMessage:{message:e.rawQuery,context:[],onlineContext:{},created:e.timestamp,by:"you",automationId:""},customClassName:"fullHistory",borderLeftColor:"".concat(null==t?void 0:t.agent.color,"-500")},"".concat(n,"outgoing")),e.trainOfThought&&function(e,t,n,o){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.length-1;return(0,s.jsxs)("div",{className:"".concat(a().trainOfThought," shadow-sm"),children:[!i&&(0,s.jsx)(l.l,{className:"float-right"}),e.map((e,o)=>(0,s.jsx)(c.H,{message:e,primary:o===r&&t&&!i,agentColor:n},"train-".concat(o)))]},o)}(e.trainOfThought,n===v,(null==t?void 0:t.agent.color)||"orange","".concat(n,"trainOfThought"),e.completed),(0,s.jsx)(c.Z,{isMobileWidth:b,chatMessage:{message:e.rawResponse,context:e.context,onlineContext:e.onlineContext,created:e.timestamp,by:"khoj",automationId:"",rawQuery:e.rawQuery},customClassName:"fullHistory",borderLeftColor:"".concat(null==t?void 0:t.agent.color,"-500"),isLastMessage:!0},"".concat(n,"incoming"))]},"incomingMessage".concat(n))),e.pendingMessage&&(0,s.jsx)(c.Z,{isMobileWidth:b,chatMessage:{message:e.pendingMessage,context:[],onlineContext:{},created:new Date().getTime().toString(),by:"you",automationId:""},customClassName:"fullHistory",borderLeftColor:"".concat(null==t?void 0:t.agent.color,"-500"),isLastMessage:!0},"pendingMessage-".concat(e.pendingMessage.length)),t&&(0,s.jsx)("div",{className:"".concat(a().agentIndicator," pb-4"),children:(0,s.jsx)("div",{className:"relative group mx-2 cursor-pointer",children:(0,s.jsx)(_,{name:t&&t.agent&&t.agent.name?t.agent.name:"Agent",link:t&&t.agent&&t.agent.slug?"/agents?agent=".concat(t.agent.slug):"/agents",avatar:(0,f.T)(t.agent.icon,t.agent.color)||(0,s.jsx)(u.v,{}),description:t&&t.agent&&t.agent.persona?t.agent.persona:""})})})]})})}):null}},5506:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var s=n(57437),o=n(11930),a=n.n(o),i=n(2265),c=n(48861),r=n(82697),l=n(58485);n(7395);var u=n(69591),d=n(79306),h=n(23753),g=n(9557);function _(e){let[t,n]=(0,i.useState)(""),[o,c]=(0,i.useState)(!1),[l,u]=(0,i.useState)(null),d=e.setQueryToProcess,g=e.streamedMessages;return((0,i.useEffect)(()=>{t&&(c(!0),d(t))},[t,d]),(0,i.useEffect)(()=>{g&&g.length>0&&g[g.length-1].completed?c(!1):n("")},[g]),e.publicConversationSlug||e.conversationId)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:a().chatBodyFull,children:(0,s.jsx)(r.Z,{publicConversationSlug:e.publicConversationSlug,conversationId:e.conversationId||"",setAgent:u,setTitle:e.setTitle,pendingMessage:o?t:"",incomingMessages:e.streamedMessages})}),(0,s.jsx)("div",{className:"".concat(a().inputBox," shadow-md bg-background align-middle items-center justify-center px-3"),children:(0,s.jsx)(h.Z,{isLoggedIn:e.isLoggedIn,sendMessage:e=>n(e),sendDisabled:o,chatOptionsData:e.chatOptionsData,conversationId:e.conversationId,agentColor:null==l?void 0:l.color,isMobileWidth:e.isMobileWidth,setUploadedFiles:e.setUploadedFiles})})]}):(0,s.jsx)("div",{className:a().suggestions,children:"Whoops, nothing to see here!"})}function f(){let[e,t]=(0,i.useState)(null),[n,o]=(0,i.useState)(!0),[r,h]=(0,i.useState)("Khoj AI - Chat"),[f,m]=(0,i.useState)(void 0),[p,x]=(0,i.useState)([]),[v,y]=(0,i.useState)(""),[j,w]=(0,i.useState)(!1),[b,C]=(0,i.useState)([]),[S,M]=(0,i.useState)(!1),[N,I]=(0,i.useState)(void 0),O=(0,u.k6)(),T=(0,d.G)();async function L(e){if(!e.ok)throw Error(e.statusText);if(!e.body)throw Error("Response body is null");let t=e.body.getReader(),n=new TextDecoder,s="␃\uD83D\uDD1A␗",o="";for(;;){let e;let{done:a,value:i}=await t.read();if(a){y(""),w(!1);break}for(o+=n.decode(i,{stream:!0});-1!==(e=o.indexOf(s));){let t=o.slice(0,e);if(o=o.slice(e+s.length),t){let e=p.find(e=>!e.completed);if(!e){console.error("No current message found");return}(0,g.VK)(t,e),x([...p])}}}}async function B(){if(!v||!f)return;let e="/api/chat?q=".concat(encodeURIComponent(v),"&conversation_id=").concat(f,"&stream=true&client=web");O&&(e+="&region=".concat(O.region,"&country=").concat(O.country,"&city=").concat(O.city,"&timezone=").concat(O.timezone));let t=await fetch(e);try{await L(t)}catch(e){console.log(e)}}return((0,i.useEffect)(()=>{fetch("/api/chat/options").then(e=>e.json()).then(e=>{o(!1),e&&t(e)}).catch(e=>{console.error(e)}),(0,u.EK)(),M(window.innerWidth<786),window.addEventListener("resize",()=>{M(window.innerWidth<786)}),I(window.location.pathname.split("/").pop()||"")},[]),(0,i.useEffect)(()=>{if(v&&!f){fetch("/api/chat/share/fork?public_conversation_slug=".concat(N),{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{m(e.conversation_id)}).catch(e=>{console.error(e)});return}if(v){let e={rawResponse:"",trainOfThought:[],context:[],onlineContext:{},completed:!1,timestamp:new Date().toISOString(),rawQuery:v||""};x(t=>[...t,e]),w(!0)}},[v,f,N]),(0,i.useEffect)(()=>{j&&B()},[j]),(0,i.useEffect)(()=>{(async()=>{if(f){let e={rawResponse:"",trainOfThought:[],context:[],onlineContext:{},completed:!1,timestamp:new Date().toISOString(),rawQuery:v||""};w(!0),x(t=>[...t,e])}})()},[f,v]),n)?(0,s.jsx)(l.Z,{}):N?(0,s.jsxs)("div",{className:"".concat(a().main," ").concat(a().chatLayout),children:[(0,s.jsx)("title",{children:r}),(0,s.jsx)("div",{className:a().sidePanel,children:(0,s.jsx)(c.Z,{conversationId:null!=f?f:null,uploadedFiles:b,isMobileWidth:S})}),(0,s.jsx)("div",{className:a().chatBox,children:(0,s.jsx)("div",{className:a().chatBoxBody,children:(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)(l.Z,{}),children:(0,s.jsx)(_,{conversationId:f,streamedMessages:p,setQueryToProcess:y,isLoggedIn:null!==T,publicConversationSlug:N,chatOptionsData:e,setTitle:h,setUploadedFiles:C,isMobileWidth:S})})})})]}):(0,s.jsx)("div",{className:a().suggestions,children:"Whoops, nothing to see here!"})}},15238:function(e){e.exports={chatHistory:"chatHistory_chatHistory__CoaVT",chatLayout:"chatHistory_chatLayout__ABli_",agentIndicator:"chatHistory_agentIndicator__wOU1f",trainOfThought:"chatHistory_trainOfThought__mMWSR"}},11930:function(e){e.exports={main:"sharedChat_main__7Nayy",suggestions:"sharedChat_suggestions__V8kr_",inputBox:"sharedChat_inputBox__wRW5A",chatBodyFull:"sharedChat_chatBodyFull__O1MOv",chatBody:"sharedChat_chatBody__OnHDL",chatLayout:"sharedChat_chatLayout__gutlc",chatBox:"sharedChat_chatBox__PmAPg",titleBar:"sharedChat_titleBar__vOHp_",chatBoxBody:"sharedChat_chatBoxBody__ef2Nl",agentIndicator:"sharedChat_agentIndicator__ORCl4"}}},function(e){e.O(0,[7849,3630,3170,3954,9001,3062,743,7071,2614,9693,1603,9417,9178,3753,2971,7023,1744],function(){return e(e.s=91955)}),_N_E=e.O()}]);