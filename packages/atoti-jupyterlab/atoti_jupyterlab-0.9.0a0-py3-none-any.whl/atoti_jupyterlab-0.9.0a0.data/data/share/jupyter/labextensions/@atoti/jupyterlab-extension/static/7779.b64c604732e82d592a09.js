/*! For license information please see 7779.b64c604732e82d592a09.js.LICENSE.txt */
(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[7779,4389,6770,9151,5723],{7779:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ln});var i=n(71451),s=n(97872),o=n(10386),r=n(44004),a=n(4749),l=n(47216),d=n(74602),c=n(94692),u=n(30160);const g=[u.toolContentEditor,u.toolFiltersEditor,u.toolStyleEditor].map((e=>{const{shortcut:t,...n}=e;return n})),h="en-US",p={default:"en-US"},m=e=>{if(!e)return h;const t=e.get("locale").composite,n=p[t];return void 0===n?(console.error(`Atoti does not support JupyterLab's ${t} locale, falling back to ${h}.`),h):n},y=async(e,{pluginRegistry:t})=>{const[i,{default:s}]=await Promise.all([(0,u.fetchTranslations)(e),n(20625)(`./${e}.js`)]);return{...i,...(0,u.getPluginsTranslations)(t,e),...(0,u.getToolsTranslations)([...g],e),...(0,c.treeToFlatMap)(s)}};class C{static async create({pluginRegistry:e,settingRegistry:t}){const n=await(t?t.load("@jupyterlab/translation-extension:plugin"):void 0),i=m(n),s=await y(i,{pluginRegistry:e});return new C({initialConfig:{locale:i,messages:s},pluginRegistry:e,translationSettings:n})}_changed=new d.Signal(this);_config;constructor({initialConfig:e,pluginRegistry:t,translationSettings:n}){this._config=e,n&&n.changed.connect((async()=>{const e=m(n),i=await y(e,{pluginRegistry:t});this._config={locale:e,messages:i},this._changed.emit()}))}get changed(){return this._changed}get config(){return this._config}}const f=async e=>{e.theme||(await new Promise((t=>{const n=()=>{e.themeChanged.disconnect(n),t(void 0)};e.themeChanged.connect(n)})),await f(e))};class w{static async create(e){await f(e);const t=()=>!e.theme||e.isLight(e.theme)?u.lightActiveViamTheme:u.darkActiveViamTheme,n=t();return new w({initialTheme:n,syncTheme:t,themeManager:e})}_changed=new d.Signal(this);_theme;constructor({initialTheme:e,syncTheme:t,themeManager:n}){this._theme=e,n.themeChanged.connect((()=>{this._theme=t(),this._changed.emit()}))}get changed(){return this._changed}get theme(){return this._theme}}var v=n(57145),b=n(29012);class S{listeners=new Set;async run(){await Promise.all([...this.listeners].map((async e=>{await e()})))}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}}var k=n(74389),T=n(58997),M=n(38412),x=n(93345),I=n(56155),D=n(5140),Y=n(50892),P=n(63343);const E="Content-Type",W="application/json",_=(e,{requestInit:t={}}={})=>async(n,{body:i,contentType:s=W,method:o,signal:r}={})=>{const a=`${e}${n.startsWith("/")?n:`/${n}`}`,l=await fetch(a,{...t,body:i,headers:{...t.headers,...s?{[E]:s}:void 0},method:o,signal:r});if(!l.ok){const e=await l.json();throw console.error(e),new Error(`Unexpected response status: ${l.status}`)}const d=l.headers.get(E)===W;let c=await(d?l.json():l.text());return d&&"object"==typeof c&&"success"===c.status&&"data"in c&&(c=c.data),c},$=P.PageConfig.getBaseUrl(),L=P.URLExt.join($,"proxy"),R=async(e,{jupyterServerProxyEnabled:t,signal:n})=>{const{hostname:i}=new URL($),s="url"in e?e.url:`${e.https?"https":"http"}://${i}:${e.port}`,o=[];if(t&&!s.startsWith(L)){const{hostname:e,pathname:t,port:n,protocol:r}=new URL(s),a=n||("https:"===r?"443":"80"),l=t&&"/"!==t?[t]:[];o.push(P.URLExt.join(L,a,...l)),e!==i&&o.push(P.URLExt.join(L,`${e}:${a}`,...l))}if(o.push(s),"port"in e){const{hostname:t,protocol:n}=window.location,i=t.split(".");i.length>2&&o.push(`${n}//${[`${i[0]}-${e.port}`,...i.slice(1)].join(".")}`)}for(const e of o)try{const t=_(e);return{sessionUrl:e,versions:await t("versions/rest",{signal:n})}}catch{}throw new Error("Cannot access the session after trying "+(1===o.length?`this URL: ${o[0]}`:`these URLs: ${o.join(", ")}`))},j=(e,t="")=>{if(""===t){const{pathname:t}=new URL(e);return`${e}${""===t||"/"===t?"":"/"}`}return`${e}/${t}`};var A=n(31529);class O{static async create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}){const o="url"in i;o||(e=>{if(!new Headers(e).get("authorization"))throw new Error(`Missing Authorization header in ${JSON.stringify(e)}.`)})(t);const{sessionUrl:r,versions:a}=await R(i,{jupyterServerProxyEnabled:e,signal:s}),l=null===t?void 0:{credentials:"include",headers:t,mode:"cors"},[d,c]=["pivot","content"].map((e=>{const t=[`activeviam/${e}`,e];for(const e of t)if(e in a.apis)return a.apis[e].versions[0];throw new Error(`One of ${t} missing in the server services: ${Object.keys(a.apis)}.`)})),g=(0,u.createAtotiClient)({requestInit:l,serverVersion:a.serverVersion,serviceVersion:d,url:r});await g.loadDataModel({signal:s});const h=o?void 0:(0,u.createContentClient)({requestInit:l,serverVersion:a.serverVersion,serviceVersion:c,url:r}),p=_(r,{requestInit:l});return new O({atotiClient:g,contentClient:h,fetch:p,id:n,isQuerySession:o,versions:a})}atotiClient;contentClient;fetch;id;isQuerySession;versions;_disposed=new d.Signal(this);_isDisposed=!1;subscriberCount=0;stopSyncingDataModel;constructor({atotiClient:e,contentClient:t,fetch:n,id:i,isQuerySession:s,versions:o}){this.atotiClient=e,this.contentClient=t,this.fetch=n,this.stopSyncingDataModel=s?A.noop:(0,l.syncDataModel)(e),this.id=i,this.isQuerySession=s,this.versions=o}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this.atotiClient.disconnect(),this.stopSyncingDataModel(),d.Signal.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}subscribe(){this.subscriberCount++}unsubscribe(){this.subscriberCount--,0===this.subscriberCount&&this.dispose()}}const B=({children:e,description:t,icon:n,id:i})=>{const{formatMessage:s}=(0,Y.useIntl)();return(0,k.Y)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:(0,k.Y)(M.Empty,{description:(0,k.FD)("span",{css:{color:"var(--jp-ui-font-color1)"},children:[(0,k.Y)("span",{css:{fontSize:"var(--jp-ui-font-size2)"},children:s({id:`${i}.title`})}),(0,k.Y)("br",{}),(0,k.Y)("span",{css:{color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size1)"},children:t??s({id:`${i}.description`})})]}),image:n,imageStyle:{fontSize:42,height:60},children:e})})};var F=n(77051);const U=({hasSnapshot:e})=>e?(0,k.Y)(B,{icon:(0,k.Y)(F.CameraOutlined,{}),id:"widget.snapshotSelected"}):(0,k.Y)(B,{icon:(0,k.Y)(F.ApiOutlined,{}),id:"widget.waitingForConnection"}),N=(e,t)=>{const n=(0,x.useCallback)((t=>e?(e.connect(t),()=>{e.disconnect(t)}):A.noop),[e]);return(0,x.useSyncExternalStore)(n,t)},z=(e,{property:t,sender:n})=>N(e,(()=>{if(n)return n[t]})),K=(0,x.createContext)(void 0),H=()=>{const e=(0,x.useContext)(K);if(!e)throw new Error("Missing session clients.");return e},q=(0,x.createContext)(void 0),Q={username:l.anonymousUsername,userRoles:[l.roleAdmin,l.roleUser]},V=({children:e,sessionId:t})=>{const n=H(),i=N(n.changed,(()=>n.get(t))),s=(0,x.useMemo)((()=>{const e={};return i&&(e[l.defaultServerKey]=i.atotiClient),e}),[i]);return i?(0,k.Y)(u.UserProvider,{value:Q,children:(0,k.Y)(u.ClientsProvider,{value:{atoti:s},children:(0,k.Y)(q.Provider,{value:i,children:e})})}):(0,k.Y)(U,{})},J=()=>{const e=(0,x.useContext)(q);if(!e)throw new Error("Missing session client.");return e};class G{_changed=new d.Signal(this);sessionClients={};sessionClientCreations={};get changed(){return this._changed}get(e){return this.sessionClients[e]}async getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}){const o=this.get(n);if(o){const{atotiClient:e}=o;return"disconnected"===e.connectionStatus&&await e.connect(),o}n in this.sessionClientCreations||(this.sessionClientCreations[n]=(async()=>{const o=await O.create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}),r=()=>{Reflect.deleteProperty(this.sessionClients,n),this._changed.emit(),o.disposed.disconnect(r)};o.disposed.connect(r),this.sessionClients[n]=o,Reflect.deleteProperty(this.sessionClientCreations,n),this._changed.emit()})()),await this.sessionClientCreations[n];const r=this.sessionClients[n];if(!r)throw new Error("Missing session client.");return r}}const X=e=>"mapping"in e;var Z=n(92377),ee=n(90147);class te{onChange;index=0;states;constructor(e,t){this.onChange=t,this.states=[e]}get current(){return this.states[this.index]}get canRedo(){return this.index<this.states.length-1}get canUndo(){return this.index>0}set(e){e!==this.current&&(this.index++,this.states.length=this.index,this.states.push(e),this.onChange())}redo(){if(!this.canRedo)throw new Error("Cannot redo");this.index++,this.onChange()}undo(){if(!this.canUndo)throw new Error("Cannot undo");this.index--,this.onChange()}}const ne="atoti",ie="height",se="widget",oe=360,re=e=>e.getMetadata(ne)??void 0,ae=e=>{const t=e[se];return{...e,[se]:t?(0,u.deserializeWidgetState)(t):void 0}},le=e=>{const t=e[se];return{...e,[se]:t?(0,u.serializeWidgetState)(t):void 0}},de=e=>re(e)?.[ie]??oe;class ce{cellModel;_changed=new d.Signal(this);_isDeferredChanged=new d.Signal(this);_isDeferred=!1;_isDisposed=!1;disconnectFromCellMetadataChangedSignal;undoableState;updatingState=!1;widgetPlugins;constructor(e,{widgetPlugins:t}){this.cellModel=e;const n=re(this.cellModel);this.undoableState=new te(n?ae(n):void 0,(()=>{this.updatingState=!0;try{this.current?this.cellModel.setMetadata(ne,le(this.current)):this.cellModel.deleteMetadata(ne)}finally{this.updatingState=!1}this._changed.emit()}));const i=(e,{key:t,newValue:n})=>{t!==ne||this.updatingState||(this.current=((e,t)=>{if(!t)return;const n=ae(t);return e?(i=e,s=n,(0,ee.produce)(i,(e=>{const t=(0,Z.compare)(e,s);(0,Z.applyPatch)(e,t)}))):n;var i,s})(this.current,n))};this.cellModel.metadataChanged.connect(i),this.disconnectFromCellMetadataChangedSignal=()=>{this.cellModel.metadataChanged.disconnect(i)},this.widgetPlugins=t}get defaultWidgetState(){return this.widgetPlugins[0].initialState}get canRedo(){return this.undoableState.canRedo}get canUndo(){return this.undoableState.canUndo}get changed(){return this._changed}get current(){return this.undoableState.current}set current(e){this.undoableState.set(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.disconnectFromCellMetadataChangedSignal(),d.Signal.clearData(this))}get isDeferred(){return this._isDeferred}set isDeferred(e){this._isDeferred=e,this._isDeferredChanged.emit()}get isDeferredChanged(){return this._isDeferredChanged}get isDisposed(){return this._isDisposed}setHeight(e){this.setMetadataProperty(ie,e)}setWidgetState(e){this.setMetadataProperty(se,e)}redo(){this.undoableState.redo()}undo(){this.undoableState.undo()}setMetadataProperty(e,t){const{current:n}=this;this.current={...n,[e]:t}}}const ue=e=>{const t=z(e.isDeferredChanged,{property:"isDeferred",sender:e}),n=(0,x.useCallback)((t=>{e.isDeferred=t}),[e]);return{isDeferred:t,setIsDeferred:n}},ge=e=>{const t=(0,x.useCallback)((t=>{e.setWidgetState(t)}),[e]),{[se]:n}=z(e.changed,{property:"current",sender:e})??{};return{setWidgetState:t,widgetState:n}},he=(0,x.createContext)(void 0),pe=()=>{const e=(0,x.useContext)(he);if(!e)throw new Error("Missing widget state trackers.");return e},me=(0,x.createContext)(void 0),ye=({cellModel:e,children:t,hasSnapshot:n})=>{const i=pe(),s=N(i.created,(()=>i.get(e)));return s?(0,k.Y)(me.Provider,{value:s,children:t}):(0,k.Y)(U,{hasSnapshot:n})},Ce=()=>{const e=(0,x.useContext)(me);if(!e)throw new Error("Missing widget state tracker.");return e};class fe{_created=new d.Signal(this);widgetPlugins;widgetStateTrackers=new WeakMap;constructor({widgetPlugins:e}){this.widgetPlugins=e}get created(){return this._created}get(e){return this.widgetStateTrackers.get(e)}getOrCreate(e){return this.widgetStateTrackers.has(e)||(this.widgetStateTrackers.set(e,new ce(e,{widgetPlugins:this.widgetPlugins})),this._created.emit()),this.get(e)}}const we=(0,x.createContext)(void 0),ve=(0,x.createContext)(!1),be=(0,x.createContext)(void 0),Se=({children:e,value:{intlTracker:t,jupyterLab:n,jupyterServerProxyEnabled:i,notebookTracker:s,pluginRegistry:o,popupContainer:r,sessionClients:a,themeTracker:l,widgetStateTrackers:d}})=>{const c=(0,x.useCallback)((()=>r),[r]),{locale:g,messages:h}=z(t.changed,{property:"config",sender:t}),p=z(l.changed,{property:"theme",sender:l});return(0,k.Y)(M.ConfigProvider,{getPopupContainer:c,children:(0,k.Y)(I.DndProvider,{backend:D.HTML5Backend,children:(0,k.Y)(Y.IntlProvider,{locale:g,messages:h,children:(0,k.Y)(u.ThemeProvider,{css:{height:"100%"},value:p,children:(0,k.Y)(u.PluginsProvider,{value:o,children:(0,k.Y)(u.DataModelClickListenersProvider,{children:(0,k.Y)(we.Provider,{value:n,children:(0,k.Y)(ve.Provider,{value:i,children:(0,k.Y)(be.Provider,{value:s,children:(0,k.Y)(K.Provider,{value:a,children:(0,k.Y)(he.Provider,{value:d,children:e})})})})})})})})})})})},ke=()=>{const e=(0,x.useContext)(we);if(!e)throw new Error("Missing JupyterLab.");return e},Te=()=>(0,x.useContext)(ve),Me=()=>{const e=(0,x.useContext)(be);if(!e)throw new Error("Missing notebook tracker.");return e},xe=(0,x.createContext)(null),Ie=xe.Provider,De=()=>{const e=(0,x.useContext)(xe);if(!e)throw new Error("Missing widget environment.");return e},Ye=(e,t)=>{for(let n=0;n<e.length;n++){const i=e.get(n);if(t(i))return i}},Pe="text/html",Ee=l.version.split(".",1).pop(),We=`application/vnd.atoti.link.v${Ee}+json`,_e=`application/vnd.atoti.widget.v${Ee}+json`,$e=`application/vnd.atoti.convert-mdx-query-result-to-widget.v${Ee}+json`,Le=({children:e})=>{const[t,n]=(0,x.useState)(),i=(0,x.useRef)(null);return(0,x.useEffect)((()=>{const e=i.current;e&&void 0===t&&n(null!==e.closest(".jp-LinkedOutputView"))}),[t]),void 0===t?(0,k.Y)("div",{ref:i}):e(t)};var Re=n(41774),je=n(47355),Ae=n(3978);const Oe=e=>{const{formatMessage:t}=(0,Y.useIntl)(),{widgetKey:n}=(0,u.useSwitchedWidgetState)(e);return t({id:`aui.plugins.widget.${n}.defaultName`})};var Be=n(11527);const Fe="atoti-exclude-from-snapshot",Ue=async({code:e,notebookTracker:t,state:n})=>{const i=t.currentWidget;if(!i)throw new Error("Notebook has no current panel.");const s=i.model;if(!s)throw new Error("Current notebook panel has no model.");const r=i.content;if(s.sharedModel.insertCell(r.activeCellIndex+1,(({code:e,state:t})=>({cell_type:"code",execution_count:null,metadata:{[ne]:le({[se]:t})},outputs:[],source:e}))({code:e,state:n})),r.activeCellIndex++,!r.activeCell||!(0,v.isCodeCellModel)(r.activeCell.model))throw new Error("A code cell has just been inserted and activated, expected the the current active cell to be a code cell.");const a=r.activeCell;return await o.NotebookActions.run(r,i.sessionContext),a},Ne=e=>{const t=z(e.activeCellChanged,{property:"activeCell",sender:e});if(t&&(0,v.isCodeCellModel)(t.model))return t.model},ze=()=>{const e=Me(),t=Ne(e),{cellModel:n}=De();return t===n},Ke=({onChange:e,widgetState:t})=>{if(!e)throw new Error("Missing `onChange` prop.");const n=Oe(t),[i,s]=(0,x.useState)(t.name??n);(0,x.useEffect)((()=>{s(t.name??n)}),[n,t.name]);const o=(0,x.useCallback)((()=>{if(i&&i!==n)e({...t,name:i});else{const{name:i,...o}=t;s(n),e(o)}}),[n,e,s,i,t]);return(0,k.Y)(Ae.TitleInput,{css:{height:"100%",padding:2},isPlaceholder:!t.name,isStrictlySized:!1,value:i,onBlur:o,onChange:s})},He=[],qe=({onChange:e,queryId:t,widgetState:n})=>{const{widgetKey:i}=(0,u.useSwitchedWidgetState)(n),[s]=(0,je.useWidgetPlugins)([i]),o=(0,Re.useTitleBarButtonPlugins)(s.titleBarButtons??He);return ze()?(0,k.Y)("div",{className:Fe,css:{display:"flex",justifySelf:"end"},children:o.map((({Component:i,key:s})=>(0,k.Y)(i,{css:{marginRight:8},queryId:t,widgetState:n,onWidgetChange:e},s)))}):null},Qe=e=>(0,k.FD)("div",{css:{display:"flex",fontSize:16,height:36,justifyContent:"space-between"},children:[(0,k.Y)(Ke,{...e}),(0,k.Y)(qe,{...e})]}),Ve=(0,u.withWidgetLoadingBar)((e=>{const t=(0,x.forwardRef)(((t,n)=>(0,k.FD)("div",{ref:n,css:{height:"100%"},children:[(0,k.Y)(Qe,{...t}),(0,k.Y)("div",{css:{height:"calc(100% - 36px)"},children:(0,k.Y)(e,{...t})})]}))),n=e.displayName??e.name??"Unknown";return t.displayName=`withTitleBar(${n})`,t})(u.Widget));var Je=n(77227);const Ge=({error:e})=>{const t=Ce(),{formatMessage:n}=(0,Y.useIntl)();return(0,k.FD)(B,{description:String(e),icon:(0,k.Y)(F.MehOutlined,{}),id:"widget.errored",children:[(0,k.FD)(M.Button,{danger:!0,onClick:()=>{t.current=void 0},children:[(0,k.Y)(F.ClearOutlined,{})," ",n({id:"widget.reset"})]}),t.canUndo?(0,k.FD)(M.Button,{css:{marginLeft:"4px !important",marginTop:"4px !important"},onClick:()=>{t.undo()},children:[(0,k.Y)(F.UndoOutlined,{})," ",n({id:"aui.plugins.titlebar-button.undo.key"})]}):null]})},Xe=({children:e,widgetLoadingTracker:t})=>{const n=(0,x.useCallback)((async e=>{t&&await t.handleError(e)}),[t]),i=Ce(),s=ge(i);return(0,k.Y)(Je.ErrorBoundary,{FallbackComponent:Ge,resetKeys:[s],onError:n,children:e})},Ze=({children:e})=>{const{formatMessage:t}=(0,Y.useIntl)(),n=ze(),{[l.defaultServerKey]:i}=(0,u.useConnectionStatuses)(),[s,o]=(0,x.useState)(!1),r=(0,x.useCallback)((()=>{o(!0)}),[]),a="disconnected"===i;return(0,x.useEffect)((()=>{o(!a)}),[a]),(0,k.FD)(x.Fragment,{children:[n&&a&&!s?(0,k.Y)("div",{css:{padding:4,position:"absolute",width:"100%",zIndex:1},children:(0,k.Y)(M.Alert,{closable:!0,showIcon:!0,className:Fe,message:t({id:"widget.sessionDisconnected"}),type:"warning",onClose:r})}):null,e]})},et=({children:e,widgetLoadingTracker:t})=>(0,k.Y)(Ze,{children:(0,k.Y)(Xe,{widgetLoadingTracker:t,children:e})}),tt=()=>{const e=(0,x.useRef)(null),{cellModel:{id:t}}=De(),n=Ce(),{isDeferred:i}=ue(n),{setWidgetState:s,widgetState:o=n.defaultWidgetState}=ge(n);return(0,x.useEffect)((()=>{const t=e.current;if(!t)throw new Error("Expected div to have been mounted and ref to have been set.");(e=>{let t=e;for(;t;)if(({parentElement:t}=t),t?.classList?.contains("jp-OutputArea-child"))return void(t.style.height="100%");throw new Error("Expected to find right parent element before exhausting them all.")})(t)}),[]),(0,k.Y)(Ve,{ref:e,isDeferred:i,queryId:t,widgetState:o,onChange:s})},nt=()=>{const{cellModel:e,mimeModel:t,sessionId:n}=De();return(0,k.Y)(ye,{cellModel:e,hasSnapshot:Boolean(t.data[Pe]),children:(0,k.Y)(V,{sessionId:n,children:(0,k.Y)(et,{children:(0,k.Y)(tt,{})})})})};var it=n(62795);class st{widgetId;sessionClient;toldLoadingDone=!1;constructor({sessionClient:e,widgetId:t}){this.sessionClient=e,this.widgetId=t}async done(){if(this.toldLoadingDone||this.sessionClient.isQuerySession)return;this.toldLoadingDone=!0;const e=`${this.sessionClient.versions.apis.atoti.versions[0].restPath}/widgets/${this.widgetId}/loading`;await this.sessionClient.fetch(e,{method:"DELETE"})}async handleError(e){await this.done()}}class ot{_changed=new d.Signal(this);cellModels;messages=new WeakMap;constructor({cellModels:e}){this.cellModels=e}get changed(){return this._changed}get(e){return this.messages.get(e)}register(e){this._changed.emit(),e.registerCommTarget("atoti-widget",((e,{content:{data:t}})=>{const n=t;try{const{cellId:e}=n,t=[...this.cellModels].find((({id:t})=>e===t));if(!t)throw new Error(`Missing model for cell #${e}`);if(!(0,v.isCodeCellModel)(t))throw new Error(`Expected cell #${e} to be a code cell`);const i=Ye(t.outputs,(e=>void 0!==e.data[_e]));if(!i)throw new Error(`Expected cell #${e} to have a widget output`);this.messages.set(i,n),this._changed.emit()}catch(e){console.error(e)}}))}}const rt="atoti-sidebar",at=({jupyterLab:e})=>{e.shell.activateById(rt)};var lt=n(40391),dt=n(35256);const ct=({children:e,collapsedTitle:t,expandedTitle:n,isDisabled:i,isExpanded:s,onToggled:o})=>{const r=(0,u.useTheme)(),a=(0,x.useCallback)((()=>{o&&o(!s)}),[s,o]);return s?(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:{alignItems:"center",backgroundColor:r.alternateBackgroundColor,borderBottom:`1px solid ${r.grayScale[5]}`,cursor:"pointer",display:"flex",height:20,justifyContent:"space-between",padding:8},onClick:a,children:[(0,k.Y)("div",{css:{fontSize:"11px",textTransform:"uppercase",width:"100%"},children:n}),(0,k.Y)("div",{css:{color:r.textColor},children:!i&&(0,k.Y)(F.DoubleLeftOutlined,{})})]}),(0,k.Y)("div",{css:{height:"calc(100% - 20px)"},children:e})]}):(0,k.FD)("div",{css:{height:"100%"},onClick:a,children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:r.alternateBackgroundColor,borderBottom:`1px solid ${r.cellBorderColor}`,borderRight:`1px solid ${r.cellBorderColor}`,display:"flex",height:20,justifyContent:"center"},children:(0,k.Y)("div",{css:{cursor:"pointer"},children:(0,k.Y)(F.DoubleRightOutlined,{})})}),(0,k.Y)("div",{css:{backgroundColor:r.alternateBackgroundColor,borderRight:`1px solid ${r.cellBorderColor}`,cursor:"pointer",height:"100%",textAlign:"center",whiteSpace:"nowrap"},children:t})]})};var ut=n(6934);const{OptGroup:gt,Option:ht}=M.Select,pt=({onChange:e,queryId:t,widgetState:n})=>{const{formatMessage:i}=(0,Y.useIntl)(),s=(0,u.useTheme)(),o=(0,ut.useIsQueryLazyLoaded)({queryId:t,widgetState:n}),r=(e=>{const t=(0,u.useWidgetPlugins)(e),n=(0,x.useMemo)((()=>{const e=[];for(const n of t)(0,ut.isDataVisualizationWidgetPlugin)(n)&&e.push(n);return e}),[t]);return n})((0,u.useWidgetPluginKeys)()),{mapping:a,widgetKey:l}=(0,u.useSwitchedWidgetState)(n),{attributes:d}=r.find((({key:e})=>e===l)),c=(0,x.useMemo)((()=>{const e={};for(const t of Object.values(r)){const r=t.subCategory??"misc";e[r]||=[];const l=t.Icon??F.QuestionOutlined,{maxNumberOfFields:c,status:u}=(0,ut.getSwitchAvailability)(a,d,t),g=o&&!t.lazyLoading||"ok"!==u;e[r].push((0,k.Y)(ht,{disabled:g,value:t.key,children:(0,k.FD)(M.Tooltip,{title:g?(0,k.Y)(ut.WidgetIconTooltip,{isQueryLazyLoaded:o,selectedWidgetState:n,widgetOption:{...t,disabledType:"tooManyNumeric"===u?"numeric":"ordinal",isSwitchDisabled:g,maxNumberOfFields:c}}):void 0,children:[(0,k.Y)(l,{css:{color:s.primaryColor,marginRight:4}})," ",i({id:`aui.plugins.widget.${t.key}.key`})]})},t.key))}return e}),[d,r,i,o,a,s.primaryColor,n]);return(0,k.Y)(M.Select,{css:{height:28,width:"100%"},listHeight:30*Object.keys(r).length,value:l,onChange:t=>{e((0,ee.produce)(n,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t})))},children:Object.entries(c).map((([e,t])=>(0,k.Y)(gt,{label:i({id:`aui.dataVisualization.category.${e}`}),children:t},e)))})},mt=()=>{const e=Ce(),{isDeferred:t,setIsDeferred:n}=ue(e),{formatMessage:i}=(0,Y.useIntl)();return(0,k.Y)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",height:26,justifyContent:"flex-end"},children:(0,k.Y)(M.Checkbox,{checked:t,onChange:e=>{n(e.target.checked)},children:i({id:"sidebar.deferUpdates"})})})},yt=({activeToolKey:e,onActiveToolKeyChanged:t,tools:n})=>(0,k.Y)(M.Tabs,{css:{".ant-tabs-nav-operations":{".ant-tabs-nav-more":{alignItems:"center",display:"flex"},margin:"0 !important",padding:"0 !important"},"div.ant-tabs-tab-btn span.tab-item-label":{display:"none"}},activeKey:e,items:n.map((e=>({key:e.key,label:(0,k.Y)("span",{className:"anticon",css:{marginRight:"0px !important"},children:(0,k.Y)(e.icon,{})})}))),tabBarStyle:{height:20,marginTop:5,paddingLeft:8},type:"card",onTabClick:t}),Ct=({cellId:e})=>{const{formatMessage:t}=(0,Y.useIntl)(),n=(0,u.useTheme)(),i=Ce(),{setWidgetState:s,widgetState:o=i.defaultWidgetState}=ge(i),r=(0,u.useSwitchedWidgetState)(o),[a,d]=(0,x.useState)(240),[c,h]=(0,x.useState)("contentEditor"),{cube:{name:p}}=(0,u.useCube)(r),[m,y]=(0,x.useState)(!0),{component:C}=g.find((({key:e})=>e===c)),f=`1px solid ${n.cellBorderColor}`;return(0,k.FD)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end"},children:[X(r)?(0,k.Y)("div",{css:{borderBottom:f,padding:"6px 8px"},children:(0,k.Y)(pt,{queryId:e,widgetState:r,onChange:s})}):null,(0,k.Y)("div",{css:{borderBottom:f,height:`calc(100% - ${26+(X(r)?41:0)+1}px)`},children:(0,k.FD)(u.Resizable,{minSize:m?100:34,size:m?a??240:34,onResizeEnd:d,children:[(0,k.Y)(ct,{collapsedTitle:(0,k.Y)("div",{css:{backgroundColor:n.alternateBackgroundColor,display:"inline-block",marginTop:70,textTransform:"uppercase",transform:"rotate(-90deg)",width:15},children:t({id:"aui.dataModel"})}),expandedTitle:t({id:"aui.dataModel"}),isExpanded:m,onToggled:y,children:(0,k.Y)("div",{css:{display:"flex",height:"100%",width:"100%"},children:(0,k.Y)(u.DataModelTree,{cubeName:p,marginLeft:8,serverKey:l.defaultServerKey})})}),(0,k.FD)("div",{css:{height:"100%"},children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:n.alternateBackgroundColor,borderBottom:`1px solid ${n.grayScale[5]}`,display:"flex",fontSize:"11px",height:20,padding:8,textTransform:"uppercase"},children:t({id:"aui.tools"})}),(0,k.Y)(yt,{activeToolKey:c,tools:g,onActiveToolKeyChanged:h}),(0,k.Y)("div",{css:{height:"calc(100% - 33px)",padding:"0px 8px"},children:(0,k.Y)(C,{widgetState:r,queryId:e,onWidgetChange:s})})]})]})}),(0,k.Y)(mt,{})]})},ft=()=>{const e=Me(),t=Ne(e),n=(e=>{z(e?.outputs.changed,{property:"length",sender:e?.outputs});const t=e?Ye(e.outputs,(e=>void 0!==e.data[_e])):void 0;if(!t)return;const{data:n}=t;return{hasSnapshot:Pe in n,widgetOutput:n[_e]}})(t);if(!t||!n)return(0,k.Y)(B,{icon:(0,k.Y)(u.IconPuzzle,{}),id:"sidebar.noWidgetSelected"});const{hasSnapshot:i,widgetOutput:s}=n;return(0,k.Y)(ye,{cellModel:t,hasSnapshot:i,children:(0,k.Y)(V,{sessionId:s.sessionId,children:(0,k.Y)(Xe,{children:(0,k.Y)(Ct,{cellId:t.id})})})})},wt="atoti-icon",vt="jp-SideBar-tabIcon",bt=`.${wt}.${vt}`;class St extends dt.Widget{constructor(e){super(),this.id=rt,this.title.caption="Atoti",this.title.iconClass=`${vt} ${wt}`;const t=s.ReactWidget.create((0,k.FD)(x.Fragment,{children:[(0,k.Y)(lt.Global,{styles:{[bt]:{backgroundColor:"var(--md-grey-700)",backgroundImage:"none",maskImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 256 256'%3E%3Cpath fill='%23fff' d='M165.883 208.19h-75.8l-7.342 25.99H30.456l72.467-213.997h49.82l72.759 213.996h-52.267Zm-10.991-38.818-27.21-94.467-26.904 94.467Z'/%3E%3C/svg%3E%0A\");",maskPosition:"center",maskRepeat:"no-repeat",maskSize:"contain"},[`[data-jp-theme-light="false"] ${bt}`]:{backgroundColor:"var(--md-grey-300)"}}}),(0,k.Y)(Se,{value:e,children:(0,k.Y)(ft,{})})]})),{style:n}=t.node;n.height="100%",n.padding="0";const i=new dt.PanelLayout;i.addWidget(t),this.layout=i}}const kt=({widgetLoadingTracker:e,widgetRef:t})=>{const{cellModel:{id:n}}=De(),i=Ce(),{isDeferred:s,setIsDeferred:o}=ue(i),{setWidgetState:r,widgetState:a}=ge(i),d=a??i.defaultWidgetState,c=(p=e,(0,x.useEffect)((()=>()=>{(async()=>{await p.done()})()}),[p]),(0,x.useCallback)((async()=>{await p.done()}),[p])),g=(e=>{const{cellModel:{id:t},mimeModel:n,preSaveSubscribe:i}=De(),s=(0,x.useRef)(!1),o=Ce(),{widgetState:{name:r}={}}=ge(o),a=(0,x.useCallback)((e=>{const{[Pe]:t,...i}=n.data;n.setData({data:e?{...i,[Pe]:`<img height="${e.height}" width="${e.width}" src="${e.src}" />`}:i})}),[n]),{error:d}=(0,u.useQueryResult)({queryId:t,serverKey:l.defaultServerKey});return(0,x.useEffect)((()=>{let t=!1;const n=i((async()=>{let n;if(s.current&&!d&&e.current)try{const t=Date.now(),{clientHeight:i,clientWidth:s}=e.current;n={height:i,src:await(async e=>await(0,Be.domToPng)(e,{filter:e=>!(e=>e.nodeType===e.ELEMENT_NODE)(e)||!e.classList.contains(Fe),scale:window.devicePixelRatio??1}))(e.current),width:s};const o=Date.now();console.debug(`Snapshotted widget "${r}" in ${(o-t)/1e3} seconds.`)}catch(e){throw new Error("Failed to snapshot widget",{cause:e})}t||a(n)}));return()=>{t=!0,n()}}),[d,r,i,a,e]),(0,x.useCallback)((()=>{s.current=!0}),[])})(t),h=(0,x.useCallback)((()=>{c(),g()}),[c,g]);var p;return(e=>{const t=ke();(0,x.useEffect)((()=>{e&&at({jupyterLab:t})}),[e,t])})(void 0===a),(e=>{(0,x.useEffect)((()=>()=>{e(!1)}),[e])})(o),(()=>{const e=J();(0,x.useEffect)((()=>(e.subscribe(),()=>{e.unsubscribe()})),[e])})(),(0,k.Y)(Ve,{isDeferred:s,queryId:n,widgetState:d,onLoaded:h,onChange:r})};var Tt=n(8598);const Mt=":",xt=`atoti${Mt}`,It=e=>void 0!==e,Dt=(...e)=>{if(!window.__UNSTABLE_DATA_TEST_IDS_ENABLED__)return;const t=e.at(-1);if((0,A.isPlainObject)(t)){const n=t["data-testid"],i=e.slice(0,-1).filter(It);if(n){const e=n.replace(xt,"");return`${xt}${[...i.filter(It),e].join(Mt)}`}return`${xt}${i.join(Mt)}`}return`${xt}${e.filter(It).join(Mt)}`},Yt="atoti-resize-handle",Pt=(0,x.forwardRef)((({children:e},t)=>{const n=Ce(),{height:i,setHeight:s}=(e=>{const t=(0,x.useCallback)((t=>{e.setHeight(t)}),[e]),{height:n=oe}=z(e.changed,{property:"current",sender:e})??{};return{height:n,setHeight:t}})(n),{widgetState:{name:o}={}}=ge(n),r=(0,u.useTheme)();return(0,k.Y)(lt.ClassNames,{children:({css:n})=>(0,k.Y)(Tt.Resizable,{handleClasses:{bottom:`${Yt} ${n({backgroundColor:r.grayScale[6],borderRadius:2,borderTop:"unset",height:"4px !important",marginBottom:6,marginLeft:"calc(50% - 16px)",opacity:.4,width:"32px !important"})}`},size:{height:i,width:"100%"},enable:{bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1},css:{[`&:hover .${Yt}`]:{display:"inherit"},overflow:"hidden",paddingBottom:8},onResizeStop:(e,t,n,o)=>{s(i+o.height)},children:(0,k.Y)("div",{ref:t,css:{height:"100%"},"data-testid":Dt("Widget",o),children:e})})})})),Et=({html:e})=>{const t=(0,Y.useIntl)(),{cellModel:n}=De(),i=(e=>re(e)?.[se]?.name??void 0)(n);return(0,k.Y)("div",{dangerouslySetInnerHTML:{__html:e},css:{cursor:"help"},"data-testid":Dt("WidgetSnapshot",i),title:t.formatMessage({id:"widget.snapshotSelected.description"})})},Wt=()=>{const e=(0,x.useRef)(null),{cellModel:t,mimeModel:n,sessionId:i}=De(),s=(()=>{const e=Te(),t=H(),{cellModel:n,mimeModel:i,sessionId:s,sessionLocation:o,widgetComm:r}=De(),a=pe(),l=((e,t)=>N(e.changed,(()=>e.get(t))))(r,i),{error:d,result:c}=(0,it.useAsyncAbortable)((async i=>{if(!l)return;const{sessionHeaders:r,widgetId:d}=l,c=await t.getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:r,sessionId:s,sessionLocation:o,signal:i});return a.getOrCreate(n),new st({sessionClient:c,widgetId:d})}),[n,e,t,s,o,l,a]);return d??c})(),o=pe().get(t);return s instanceof Error?(0,k.Y)("div",{css:{height:de(t)},children:(0,k.Y)(B,{description:s.message,icon:(0,k.Y)(F.DisconnectOutlined,{}),id:"widget.connectionFailed"})}):s&&o?(0,k.Y)(ye,{cellModel:t,children:(0,k.Y)(Pt,{ref:e,children:(0,k.Y)(V,{sessionId:i,children:(0,k.Y)(et,{widgetLoadingTracker:s,children:(0,k.Y)(kt,{widgetLoadingTracker:s,widgetRef:e})})})})}):n.data[Pe]?(0,k.Y)(Et,{html:n.data[Pe]}):(0,k.Y)("div",{css:{height:de(t)},children:(0,k.Y)(U,{})})},_t=()=>(0,k.Y)(Le,{children:e=>e?(0,k.Y)(nt,{}):(0,k.Y)(Wt,{})});class $t extends o.NotebookTools{cellModels;cleanUpFunctions=[];preSaveSubscribe;root;sharedContext;widgetComm;constructor({cellModels:e,preSaveSubscribe:t,sharedContext:n,widgetComm:i}){super({tracker:n.notebookTracker}),this.cellModels=e,this.preSaveSubscribe=t,this.root=(0,T.H)(this.node),this.sharedContext=n,this.widgetComm=i}async renderModel(e){const t=((e,{cellModels:t})=>{for(const n of t)if((0,v.isCodeCellModel)(n)&&Ye(n.outputs,(t=>t===e)))return n;throw new Error(`Could not find matching cell for model: ${JSON.stringify(e)}`)})(e,{cellModels:this.cellModels}),n=e.data[_e],{sessionId:i,sessionLocation:s}=n;this.root.render((0,k.Y)(Se,{value:this.sharedContext,children:(0,k.Y)(Ie,{value:{cellModel:t,mimeModel:e,preSaveSubscribe:this.preSaveSubscribe,sessionId:i,sessionLocation:s,widgetComm:this.widgetComm},children:(0,k.Y)(_t,{})})})),this.cleanUpFunctions.push((()=>{this.root.unmount()}))}handleEvent(e){if(e instanceof MouseEvent&&!e.shiftKey&&e.target){const t=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.clientX,clientY:e.clientY,shiftKey:!0});e.stopPropagation(),e.preventDefault(),t.initEvent(t.type,!0,!0),e.target.dispatchEvent(t)}}onAfterAttach(){const e={capture:!0};this.node.addEventListener("contextmenu",this,e),this.cleanUpFunctions.push((()=>{this.node.removeEventListener("contextmenu",this,e)}))}onBeforeDetach(){for(const e of this.cleanUpFunctions)e()}}class Lt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){const n=(e=>{let{save:t}=e;t=t.bind(e);const n=new S;return e.save=async()=>{try{await n.run()}catch(e){console.error("Pre save hook failed to run",e)}await t()},n.subscribe.bind(n)})(t),{content:i,model:s}=e;if(null===s)throw new Error("Session model should not be null at this time");const{cells:o}=s,r=new ot({cellModels:o});i.rendermime.addFactory({createRenderer:()=>new $t({cellModels:o,preSaveSubscribe:n,sharedContext:this.sharedContext,widgetComm:r}),defaultRank:0,mimeTypes:[_e],safe:!1});const{sessionContext:a}=t,l=(e,{newValue:t})=>{t&&r.register(t)};a.kernelChanged.connect(l);const d=((e,{cellModels:t})=>(n,i)=>{if("idle"===i)for(const n of[...t].filter((t=>{const n=e.get(t);return n?.current&&(0,v.isCodeCellModel)(t)&&t.outputs.length>0&&!Ye(t.outputs,(e=>"error"===e.type||void 0!==e.data[_e]))})))e.get(n).current=void 0})(this.sharedContext.widgetStateTrackers,{cellModels:o});return a.statusChanged.connect(d),new b.DisposableDelegate((()=>{a.kernelChanged.disconnect(l),a.statusChanged.disconnect(d)}))}}const Rt="convert-mdx-query-result-to-widget",jt=`atoti:${Rt}`,At=".jp-Notebook .jp-CodeCell .dataframe",Ot=e=>{const{activeCell:t}=e,n=t&&(0,v.isCodeCellModel)(t.model)&&Ye(t.model.outputs,(e=>void 0!==e.data[$e]));return n?n.data[$e]:void 0},Bt=P.URLExt.join(P.PageConfig.getBaseUrl(),"server-proxy","servers-info"),Ft=async()=>{try{if((await fetch(Bt)).ok)return!0}catch{}return!1},Ut=({output:{path:e,sessionLocation:t}})=>{const n=Te(),{error:i,result:s}=(0,it.useAsyncAbortable)((async e=>{const{sessionUrl:i}=await R(t,{jupyterServerProxyEnabled:n,signal:e});return i}),[n,t]);if(void 0!==i)return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:i.message});if(void 0===s)return null;const o=j(s,e);return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:(0,k.Y)("pre",{children:(0,k.Y)("a",{css:{":hover":{color:"var(--jp-content-link-color)",textDecoration:"underline"},color:"var(--jp-content-link-color)"},"data-testid":Dt("Link"),href:o,target:"_blank",rel:"noopener noreferrer",children:o})})})};class Nt extends o.NotebookTools{root;sharedContext;constructor(e){super({tracker:e.notebookTracker}),this.root=(0,T.H)(this.node),this.sharedContext=e}async renderModel(e){this.root.render((0,k.Y)(Se,{value:this.sharedContext,children:(0,k.Y)(Ut,{output:e.data[We]})}))}onBeforeDetach(){this.root.unmount()}}class zt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){return e.content.rendermime.addFactory({createRenderer:()=>new Nt(this.sharedContext),defaultRank:0,mimeTypes:[We],safe:!1}),new b.DisposableSet}}var Kt=n(23446),Ht=n(46475);const qt="open-drillthrough",Qt={key:qt,translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"}},useMenuItem:e=>{const{selection:t,widgetState:n}=e,{cube:i}=(0,u.useCube)(n),{formatMessage:s}=(0,Y.useIntl)(),o=ke(),r=Me(),{mimeModel:a}=De(),{widgetCreationCode:d}=a.data[_e],c=(0,x.useMemo)((()=>{if((0,Ht.canOpenDrillthroughOnSelection)(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,Kt.isTotal)((0,u.getHierarchy)(e,i),e)))}),[i,t]),g=(0,x.useMemo)((()=>{if(!c)return;const e=c.filter((e=>"Measures"!==e.dimensionName));return s({id:`aui.plugins.menu-item.${qt}.openDrillthrough`},{member:e.length>0?(0,Kt.getTupleCaption)(e,{captionForTotals:s({id:"aui.total"}),cube:i,hasOnlyCaptionForLeafLevels:!0,separator:", "}):void 0})}),[s,c,i]),{execute:h,loading:p}=(0,it.useAsyncCallback)((async()=>{if(g&&c&&n.query.mdx){const e=(0,Ht.getDrillthroughWidgetFilters)({sourceWidgetFilters:n.filters,tuple:c}),t={...u.pluginWidgetDrillthroughTable.initialState,filters:e,initialCubeName:i.name,query:{...u.pluginWidgetDrillthroughTable.initialState.query,mdx:(0,ut.getDefaultMdxDrillthrough)(i.name)},serverKey:l.defaultServerKey};at({jupyterLab:o}),await Ue({code:d,notebookTracker:r,state:t})}}));if(c&&n.query.mdx)return{disabled:p,icon:(0,k.Y)(u.IconDrillthrough,{css:{marginRight:8}}),label:g,onClick:h}}},{Link:Vt,Text:Jt}=M.Typography,Gt="save-widget-in-app",Xt={key:Gt,translations:{"en-US":{errorMessage:"Widget could not be saved in app",querySessionWidgetsCannotBeSavedInApp:"Query session widgets cannot be saved in app",saveWidgetInApp:"Save widget in app",successDescription:"Go to <a>the app</a>, create or open a dashboard, and open the <b>Insert > <i>icon</i> Saved widgets</b> menu to find your widget.",successMessage:"Widget saved in app"}},useMenuItem:e=>{const{notification:t}=M.App.useApp(),{formatMessage:n,locale:i,messages:s}=(0,Y.useIntl)(),{atotiClient:{url:o},contentClient:r,isQuerySession:a}=J(),{widgetState:d}=e,c=Oe(d),{execute:g,loading:h}=(0,it.useAsyncCallback)((async()=>{if(!r)throw new Error("Missing content client on local sessions.");const{name:e,widgetKey:a,...g}=(0,u.serializeWidgetState)(d),h=[l.roleAdmin];try{await r.createFile({content:g,metaData:{name:e??c,version:0,widgetKey:a},owners:h,pathToParentFolder:[],readers:h,type:"widget"});const l=j(o);t.success({description:(0,k.Y)(Y.IntlProvider,{locale:i,messages:s,children:(0,k.Y)(Y.FormattedMessage,{id:`aui.plugins.menu-item.${Gt}.successDescription`,values:{a:e=>(0,k.Y)(Vt,{href:l,target:"_blank",rel:"noopener noreferrer",children:e}),b:e=>(0,k.Y)(Jt,{strong:!0,children:e}),i:()=>(0,k.Y)(u.IconPuzzle,{})}})}),message:n({id:`aui.plugins.menu-item.${Gt}.successMessage`})})}catch(e){console.error(e),t.error({description:String(e),message:n({id:`aui.plugins.menu-item.${Gt}.errorMessage`})})}})),p=a||h,m=a?n({id:`aui.plugins.menu-item.${Gt}.querySessionWidgetsCannotBeSavedInApp`}):void 0;return{disabled:p,icon:(0,k.Y)(F.DeliveredProcedureOutlined,{}),label:n({id:`aui.plugins.menu-item.${Gt}.saveWidgetInApp`}),onClick:g,title:m}}},Zt=e=>(0,A.keyBy)(e,"key"),en=["undo","redo"],tn=(e,{notebookTracker:t,widgetStateTrackers:n})=>()=>{const{disabledTextColor:i}=(0,u.useTheme)(),s=Ne(t),o=N(n.created,(()=>s&&n.get(s))),{formatMessage:r}=(0,Y.useIntl)();z(o?.changed,{property:"current",sender:o});let a=!1;o&&(a="undo"===e?o.canUndo:o.canRedo);const l=(0,x.useCallback)((()=>{a&&o&&("undo"===e?o.undo():o.redo())}),[a,o]),[d,c]=(0,x.useState)(!1),g=(0,x.useCallback)((()=>{c(!0)}),[]),h=(0,x.useCallback)((()=>{c(!1)}),[]),p=r(a?{id:`aui.plugins.titlebar-button.${e}.key`}:{id:`aui.plugins.titlebar-button.${e}.nothingToUndoRedo`}),m="undo"===e?F.UndoOutlined:F.RedoOutlined;return(0,k.Y)(M.Tooltip,{placement:"bottom",title:p,open:d,children:(0,k.Y)(m,{css:{color:a?void 0:i,cursor:a?void 0:"not-allowed !important",padding:"0px 4px"},onClick:l,onMouseEnter:g,onMouseLeave:h})})},nn=[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable,u.pluginWidgetTable,u.pluginWidgetKpi,u.pluginWidgetPlotlyLineChart,u.pluginWidgetPlotlyAreaChart,u.pluginWidgetPlotlyStackedAreaChart,u.pluginWidgetPlotly100StackedAreaChart,u.pluginWidgetPlotlyStackedColumnChart,u.pluginWidgetPlotlyClusteredColumnChart,u.pluginWidgetPlotly100StackedColumnChart,u.pluginWidgetPlotlyColumnsAndLinesChart,u.pluginWidgetPlotlyStackedBarChart,u.pluginWidgetPlotlyClusteredBarChart,u.pluginWidgetPlotly100StackedBarChart,u.pluginWidgetPlotlyPieChart,u.pluginWidgetPlotlyDonutChart,u.pluginWidgetPlotlyScatterPlot,u.pluginWidgetPlotlyRadarChart,u.pluginWidgetPlotlyWaterfallChart,u.pluginWidgetPlotlyBulletChart,u.pluginWidgetPlotlyGaugeChart,u.pluginWidgetPlotlyTreeMap,u.pluginWidgetDrillthroughTable];u.pluginWidgetDrillthroughTable.cellStyle=u.pluginCellStyleDrillthroughTable.key,u.pluginWidgetDrillthroughTable.contextMenuItems=[u.pluginMenuItemSortDrillthroughTableAscendingly.key,u.pluginMenuItemSortDrillthroughTableDescendingly.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportDrillthroughToCsv.key];const sn=nn.filter((({key:e})=>e.startsWith("plotly"))),on=new Set(["bar","column","line"]);for(const e of sn)e.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Qt.key,u.pluginMenuItemSortChartAscendingly.key,u.pluginMenuItemSortChartDescendingly.key,u.pluginMenuItemRemoveSort.key,...e.subCategory&&on.has(e.subCategory)?[u.pluginMenuItemShowHideChartTotals.key]:[],u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportToCsv.key];u.pluginWidgetPivotTable.cell=u.pluginCellPivotTable.key,u.pluginWidgetPivotTable.cellStyle=u.pluginCellStylePivotTable.key,u.pluginWidgetTable.cell=u.pluginCellTable.key,u.pluginWidgetTable.cellStyle=u.pluginCellStyleTable.key,u.pluginWidgetTreeTable.cell=u.pluginCellTreeTable.key,u.pluginWidgetTreeTable.cellStyle=u.pluginCellStylePivotTable.key;const rn=[u.pluginMenuItemFilterOnSelection.key,Qt.key,u.pluginMenuItemRemoveSort.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemHideColumns.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable])e.contextMenuItems=[u.pluginMenuItemSortPivotTableAscendingly.key,u.pluginMenuItemSortPivotTableDescendingly.key,...rn];u.pluginWidgetTable.contextMenuItems=[u.pluginMenuItemSortTableAscendingly.key,u.pluginMenuItemSortTableDescendingly.key,...rn],u.pluginWidgetKpi.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Qt.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of nn)e.contextMenuItems.push(Xt.key),e.titleBarButtons=[...en];const an={async activate(e,t,n,i,s,o){window.localStorage.getItem("_atotiEnableTestIds")===JSON.stringify(!0)&&(window.__UNSTABLE_DATA_TEST_IDS_ENABLED__=!0);const r=e,{docRegistry:d,shell:c}=r;console.debug(`Activating Atoti Python API extension ${l.version} (relying on Atoti UI ${a.atotiUIVersion})`);const g=new fe({widgetPlugins:nn}),h=(({notebookTracker:e,widgetStateTrackers:t})=>en.map((n=>({Component:tn(n,{notebookTracker:e,widgetStateTrackers:t}),key:n,translations:{"en-US":{key:"undo"===n?"Undo":"Redo",nothingToUndoRedo:"Nothing to "+("undo"===n?"undo":"redo")}}}))))({notebookTracker:t,widgetStateTrackers:g}),p=(({undoRedoTitleBarButtonPlugins:e,widgetPlugins:t})=>({cell:Zt([u.pluginCellPivotTable,u.pluginCellTable,u.pluginCellTreeTable]),"cell-style":Zt([u.pluginCellStyleDrillthroughTable,u.pluginCellStylePivotTable,u.pluginCellStyleTable]),"menu-item":Zt([u.pluginMenuItemCopyQuery,u.pluginMenuItemExportDrillthroughToCsv,u.pluginMenuItemExportToCsv,u.pluginMenuItemFilterOnSelection,Qt,Xt,u.pluginMenuItemRemoveSort,u.pluginMenuItemHideColumns,u.pluginMenuItemShowHideChartTotals,u.pluginMenuItemShowHideTotals,u.pluginMenuItemSortDrillthroughTableAscendingly,u.pluginMenuItemSortDrillthroughTableDescendingly,u.pluginMenuItemSortChartAscendingly,u.pluginMenuItemSortChartDescendingly,u.pluginMenuItemSortPivotTableAscendingly,u.pluginMenuItemSortPivotTableDescendingly,u.pluginMenuItemSortTableAscendingly,u.pluginMenuItemSortTableDescendingly]),"titlebar-button":Zt(e),widget:Zt(t)}))({undoRedoTitleBarButtonPlugins:h,widgetPlugins:nn}),[m,y,f]=await Promise.all([C.create({pluginRegistry:p,settingRegistry:o}),Ft(),w.create(n)]),v=(()=>{const e=document.createElement("div");return document.body.append(e),e})(),b=new G,S={intlTracker:m,jupyterLab:r,jupyterServerProxyEnabled:y,notebookTracker:t,pluginRegistry:p,popupContainer:v,sessionClients:b,themeTracker:f,widgetStateTrackers:g},k=new St(S);c.add(k,"left",{rank:700}),s&&s.add(k,"atoti-sidebar"),d.addWidgetExtension("Notebook",new Lt(S)),d.addWidgetExtension("Notebook",new zt(S)),(({commandPalette:e,intlTracker:t,jupyterLab:n,notebookTracker:i,sessionClients:s,widgetStateTrackers:o})=>{n.commands.addCommand(jt,{async execute(){const{mdx:e,sessionId:t,widgetCreationCode:r}=Ot(i),a={...u.pluginWidgetPivotTable.initialState,serverKey:l.defaultServerKey},d=await Ue({code:r,notebookTracker:i,state:a}),c=s.get(t);if(!c)throw new Error("The execution of the created cell should have created the corresponding SessionClient.");const g=o.get(d.model);if(!g)throw new Error("The execution of the created cell should have created the corresponding WidgetStateTracker.");const h=await(async e=>e.dataModel?e.dataModel:new Promise((t=>{const n=e.subscribeToDataModel((()=>{const{dataModel:i}=e;i&&(n(),t(i))}))})))(c.atotiClient),{widgetStateDerivedFromMdx:p}=(0,ut.deriveStateFromMdx)({dataModels:{[l.defaultServerKey]:h},mdx:(0,u.parse)(e),widgetPlugin:u.pluginWidgetPivotTable,widgetState:a});g.setWidgetState(p),at({jupyterLab:n})},isVisible:()=>void 0!==Ot(i),label:()=>(0,Y.createIntl)(t.config).formatMessage({id:`commands.${Rt}.caption`})}),n.contextMenu.addItem({command:jt,selector:At}),n.contextMenu.addItem({selector:At,type:"separator"}),e&&e.addItem({category:"Notebook Cell Operations",command:jt})})({commandPalette:i,intlTracker:m,jupyterLab:r,notebookTracker:t,sessionClients:b,widgetStateTrackers:g})},autoStart:!0,id:"atoti",optional:[s.ICommandPalette,i.ILayoutRestorer,r.ISettingRegistry],requires:[o.INotebookTracker,s.IThemeManager]},ln=an},20625:(e,t,n)=>{var i={"./en-US.js":[12024,2024]};function s(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((()=>n(s)))}s.keys=()=>Object.keys(i),s.id=20625,e.exports=s},74389:(e,t,n)=>{"use strict";n.d(t,{FD:()=>a,FK:()=>o,Y:()=>r});var i=n(65723),s=n(42369),o=(n(93345),n(77619),n(4674),n(21880),n(48785),i.Fragment);function r(e,t,n){return s.h.call(t,"css")?i.jsx(s.E,(0,s.c)(e,t),n):i.jsx(e,t,n)}function a(e,t,n){return s.h.call(t,"css")?i.jsxs(s.E,(0,s.c)(e,t),n):i.jsxs(e,t,n)}},58997:(e,t,n)=>{"use strict";var i=n(7628);t.H=i.createRoot,i.hydrateRoot},62921:(e,t,n)=>{"use strict";var i=n(93345),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var i,o={},d=null,c=null;for(i in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:s,type:e,key:d,ref:c,props:o,_owner:a.current}}t.Fragment=o,t.jsx=d,t.jsxs=d},65723:(e,t,n)=>{"use strict";e.exports=n(62921)}}]);