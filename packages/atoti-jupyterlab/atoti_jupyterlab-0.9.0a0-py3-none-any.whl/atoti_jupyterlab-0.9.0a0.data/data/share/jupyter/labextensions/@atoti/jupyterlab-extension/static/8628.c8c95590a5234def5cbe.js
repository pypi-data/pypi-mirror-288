/*! For license information please see 8628.c8c95590a5234def5cbe.js.LICENSE.txt */
"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[8628,4389,6770,9151,5723],{8233:(e,t,r)=>{r.d(t,{L:()=>i});const i=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},39166:(e,t,r)=>{r.d(t,{S:()=>i});const i=r(8233).L.map((e=>e.toLowerCase()))},58563:(e,t,r)=>{r.d(t,{n:()=>n});var i=r(76174);function n(e){const t=(0,i.s)(e);if(0===t.length)return-1;if(t[0].length<2)return 0;const r=t[0].slice(t[0].length-2);return"arguments"===r[0]?r[1]:0}},40940:(e,t,r)=>{r.d(t,{o:()=>l});var i=r(74389),n=r(90923),a=r(93345),o=r(3978);const{useToken:s}=n.theme,l=(0,a.forwardRef)((({levelName:e,style:t,children:r},n)=>{const l=(0,a.useRef)(null),{token:d}=s(),c=(0,o.useHasOverflow)(l);return(0,i.FD)("div",{ref:n,style:{...t,position:"relative",display:"inline-flex",alignItems:"center",paddingTop:`${d.paddingXS}px`,border:`1px solid ${d.colorBorder}`,borderRadius:`${d.borderRadius}px`},children:[(0,i.Y)(o.Tooltip,{title:e,trigger:c?["hover"]:[],children:(0,i.Y)("span",{ref:l,css:{position:"absolute",top:"0px",transform:"translateY(-55%)",width:"min-content",maxWidth:"80%",left:d.marginSM,paddingInline:`${d.paddingXS}px`,backgroundColor:d.colorBgBase,fontSize:10,lineHeight:1.26,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:e})}),r]})}))},68628:(e,t,r)=>{r.r(t),r.d(t,{EmptyWidget:()=>He,FiltersBar:()=>be,FiltersEditor:()=>It,InvalidMdxTypeError:()=>er,IsContextMenuOpenProvider:()=>Se,MdxInconsistentWithDashboardOrPageFiltersError:()=>tr,MenuWithItems:()=>Ne,ResizableEditor:()=>Ge,SavedWidgetsPanel:()=>$r,StandardWidgetList:()=>Jr,Widget:()=>je,WidgetErrorFallback:()=>Xr,WidgetIconTooltip:()=>Sr,WidgetInDashboard:()=>ze,WidgetLoadingBar:()=>ni,WidgetLoadingOverlay:()=>Dr,WidgetLoadingOverlayProvider:()=>kr,deriveMappingFromMdx:()=>wr,deriveStateFromMdx:()=>br,deserializeWidgetState:()=>wt,driveFiltersFromState:()=>me,getAttributeType:()=>$e,getDefaultMdxDrillthrough:()=>Xe,getDefaultMdxSelect:()=>Je,getKpiPropertyCaption:()=>xr,getSafeMapping:()=>Cr,getSwitchAvailability:()=>Be,getTargetCube:()=>ce,isAllMeasuresInMapping:()=>Pe,isCompositeHierarchyInMapping:()=>Qt,isDataVisualizationWidgetPlugin:()=>Ae,isDataVisualizationWidgetState:()=>qe,isHierarchyInMapping:()=>Gt,isKpiPropertyInMapping:()=>_t,isMappingEmpty:()=>Qe,isMeasureInMapping:()=>Ut,isNamedSetInMapping:()=>Ht,isWidgetInDashboard:()=>ke,isWidgetWithQueryState:()=>Z,serializeWidgetState:()=>dt,stringifyWidgetMdx:()=>lt,updateQueryContextEntry:()=>ti,useContextualizedQuery:()=>Et,useCube:()=>ue,useFilteredQuery:()=>Lt,useFilters:()=>ve,useIsContextMenuOpen:()=>Ce,useIsQueryLazyLoaded:()=>Ie,useIsQuerySuspended:()=>qt,useMdxInViews:()=>ee,useQueryContexts:()=>$t,useStringifiedQuery:()=>Rt,useSuspendedQueryResult:()=>Vt,useSwitchedWidgetState:()=>Ve,useWidgetName:()=>bt,useWidgetQueryResult:()=>jt,withLoadingOverlay:()=>li,withStateCleanup:()=>zt,withWidgetLoadingBar:()=>oi,withWidgetQueryErrorBoundary:()=>ei,withoutIrrelevantRenders:()=>si});var i=r(40570),n=r(93345),a=r.n(n),o=r(47355),s=r(74389),l=r(95846),d=r(3978),c=r(90147),u=r(52970),p=r(90225),h=r(44603),g=r(32555),m=r(39980),y=r(50224),f=r(56349),v=r(89953),w=r(95889),b=r(63719),x=r(92673),S=r(70070);const C=a().forwardRef(((e,t)=>(0,s.Y)(S.A,{...e,ref:t,icon:x.A})));var M=r(20952);const N=a().forwardRef(((e,t)=>(0,s.Y)(S.A,{...e,ref:t,icon:M.A})));var k=r(90923),D=r(46102),Y=r(21733),T=r(38527),O=r(53211),K=r(69915),I=r(1635),F=r(69319),P=r(86867),L=r(11253),$=r(17794),W=r(88654),E=r(40940);const R=({cube:e,filter:t,onFilterChanged:r})=>{const[i,a]=(0,n.useState)(!1),[o,l]=(0,n.useState)(!1),{formatMessage:c}=(0,w.useIntl)(),u=(0,Y.Y)({cube:e,filter:t}),{useToken:p}=k.theme,{token:h}=p(),g=(0,n.useMemo)((()=>{switch(t.type){case"existenceOfValue":return{element:(0,s.Y)(T.N,{doesExist:t.doesExist,onChange:e=>r({...t,doesExist:e})}),caption:c({id:"aui.filters.existenceOfValue."+(t.doesExist?"exist":"doesNotExist")})};case"topBottomMembers":const i=(0,D.q)({dimensionName:t.dimensionName,hierarchyName:t.hierarchyName},e),n=Object.values(i.levels),a=i.levels[t.levelName].index;let o=c({id:`aui.filters.topBottomMode.${t.topBottomMode}`});return a>1&&"ofEachParent"===t.scope&&(o+=` ${c({id:"aui.filters.in-each"})} ${n[a-1].caption}`),{element:(0,s.Y)(O.c,{topBottomMode:t.topBottomMode,scope:t.scope,levels:n,levelIndex:a,onTopBottomModeChange:e=>r({...t,topBottomMode:e}),onScopeChange:e=>r({...t,scope:e})}),caption:o};case"lowerOrGreaterValue":return{element:(0,s.Y)(K.X,{lowerOrGreaterMode:t.lowerOrGreaterMode,lowerOrGreaterLimit:t.lowerOrGreaterLimit,onModeChange:e=>r({...t,lowerOrGreaterMode:e}),onLimitChange:e=>r({...t,lowerOrGreaterLimit:e})}),caption:`${c({id:`aui.filters.lowerOrGreaterMode.${t.lowerOrGreaterMode}`})} ${t.lowerOrGreaterLimit}`};case"valuesRange":return{element:(0,s.Y)(I.s,{isBetween:t.isBetween,lowerLimit:t.lowerLimit,upperLimit:t.upperLimit,onIsBetweenChange:e=>r({...t,isBetween:e}),onLowerLimitChange:e=>r({...t,lowerLimit:e}),onUpperLimitChange:e=>r({...t,upperLimit:e})}),caption:`${c({id:"aui.filters.betweenMode."+(t.isBetween?"isBetween":"isNotBetween")})} ${t.lowerLimit} ${c({id:"aui.and"})} ${t.upperLimit}`};case"captionsContaining":return{element:(0,s.Y)(F.g,{containingMode:t.containingMode,token:t.token,onContainingModeChange:e=>r({...t,containingMode:e}),onTokenChange:e=>r({...t,token:e})}),caption:`${c({id:`aui.filters.containingMode.${t.containingMode}`})} "${t.token}"`};case"lowerOrGreaterCaptions":return{element:(0,s.Y)(P.s,{lowerOrGreaterMode:t.lowerOrGreaterMode,token:t.token,onLowerOrGreaterModeChange:e=>r({...t,lowerOrGreaterMode:e}),onTokenChange:e=>r({...t,token:e})}),caption:`${c({id:`aui.filters.alphabeticallyBeforeOrAfterMode.${t.lowerOrGreaterMode}`})} "${t.token}"`};case"captionsRange":return{element:(0,s.Y)(L.$,{isBetween:t.isBetween,lowerToken:t.lowerToken,upperToken:t.upperToken,onIsBetweenChange:e=>r({...t,isBetween:e}),onLowerTokenChange:e=>r({...t,lowerToken:e}),onUpperTokenChange:e=>r({...t,upperToken:e})}),caption:`${c({id:"aui.filters.alphabeticallyBetweenMode."+(t.isBetween?"isBetween":"isNotBetween")})} "${t.lowerToken}" ${c({id:"aui.and"})} "${t.upperToken}"`};case"recentDates":return{element:(0,s.Y)($.T,{numberOfRecentDates:t.numberOfRecentDates,onNumberOfRecentDatesChange:e=>r({...t,numberOfRecentDates:e})}),caption:`${c({id:"aui.filters.recentDates"})} ${t.numberOfRecentDates}`};default:throw new Error(`Filter not supported by ${R.name}`)}}),[e,t,r,c]),m="topBottomMembers"===t.type,y="measureName"in t,f={keepThe:c({id:"aui.filters.keepThe"}),whose:y?`${c({id:"aui.filters.whose"})} ${t.measureName}`:"",that:y?"":c({id:"aui.that"}),limit:m?t.limit:"",members:c({id:"aui.filters.members"}),of:c({id:"aui.filters.of"})},v="recentDates"===t.type?(0,s.FD)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,s.FD)("div",{style:{display:"flex",alignItems:"center"},children:[(0,s.Y)(d.Text,{small:!0,children:f.keepThe}),(0,s.Y)(d.Text,{small:!0,children:" "}),g.element,(0,s.Y)(d.Text,{small:!0,children:" "}),f.members]}),(0,s.FD)(d.Text,{small:!0,children:[f.of," ",t.levelName]})]}):(0,s.FD)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,s.FD)("div",{style:{display:"flex",alignItems:"center"},children:[(0,s.Y)(d.Text,{small:!0,children:f.keepThe}),m?(0,s.Y)(k.InputNumber,{type:"number",min:1,style:{width:100,margin:"0 8px"},value:t.limit,onChange:e=>{null!==e&&r({...t,limit:e})}}):(0,s.Y)(d.Text,{small:!0,children:" "}),(0,s.FD)(d.Text,{small:!0,children:[t.levelName," ",f.that]})]}),y&&(0,s.Y)("div",{children:(0,s.Y)(d.Text,{small:!0,children:f.whose})}),(0,s.Y)("div",{style:{display:"flex"},children:g.element})]}),b="recentDates"===t.type?(0,s.FD)("span",{children:[f.keepThe," ",g.caption," ",f.members," ",(0,s.Y)("br",{}),f.of," ",t.levelName]}):(0,s.FD)("span",{children:[f.keepThe," ",f.limit," ",t.levelName,y?(0,s.FD)(s.FK,{children:[(0,s.Y)("br",{}),f.whose,(0,s.Y)("br",{})]}):(0,s.FD)(s.FK,{children:[" ",f.that,(0,s.Y)("br",{})]}),g.caption]});return(0,s.Y)(E.o,{levelName:t.levelName,children:(0,s.Y)(d.Popover,{open:i,placement:"bottomLeft",trigger:"click",showArrow:!1,overlayStyle:{padding:0},onOpenChange:e=>{e&&l(!1),a(e)},content:v,children:(0,s.Y)(d.Tooltip,{title:b,open:o&&!i,onOpenChange:l,children:(0,s.FD)("span",{role:"button",style:{cursor:"pointer",padding:"0px 5px",display:"flex",alignItems:"center",gap:"4px",height:"100%"},children:[(0,s.Y)(d.Text,{small:!0,ellipsis:!0,style:{maxWidth:194},children:u}),(0,s.Y)(W.A,{style:{color:h.colorTextQuaternary}})]})})})})};var B=r(31529),A=(r(17628),function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.addEventListener.apply(e,t)}),q=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.removeEventListener.apply(e,t)},V=["mousedown","touchstart"];var j=r(75994),z=r(67252),U=r(63976),_=r(7296),G=r(72956),H=r(6748),Q=r(63555),J=r(71684),X=r(36260);function Z(e){return"query"in e}function ee({dashboardState:e,pageKey:t,widgetState:r}){const i=(0,y.W)(e,t),a={dashboard:e?(0,B.flatMap)(e.pages,(({content:e})=>Object.values(e))):[],page:i?Object.values(i.content):[],widget:[r]},o=(0,B.mapValues)(a,(e=>e.filter((e=>Z(e)&&Boolean(e.query.mdx))).map((({query:e})=>e.mdx)))),s=(0,n.useRef)(o);return["dashboard","page","widget"].some((e=>o[e].length!==s.current[e].length||o[e].some(((t,r)=>t!==s.current[e][r]))))&&(s.current=o),s.current}const te=e=>{const{cube:t,filters:r,section:i,filterIndexWithinSection:a,isHierarchyVirtual:o,serverKey:l,onFilterChanged:d,searchValue:u,widgetState:p,dashboardState:h,pageKey:g,filter:m}=e,y=(0,v.DP)(),{formatMessage:f}=(0,w.useIntl)(),b=(0,z.$)(m,t),x=ee({dashboardState:h,pageKey:g,widgetState:p})[i],[S,C]=(0,n.useReducer)(U.k9,b),M=(0,n.useMemo)((()=>(0,_.f)({filtersBySection:r,position:{sectionName:i,tileIndex:a},cube:t})),[r,i,a,t]),N=(0,n.useCallback)((e=>{C({type:"virtualHierarchyMemberSelected",selectedMemberNamePaths:e});const t=(0,c.produce)(m,(t=>{t.members=e}));d(t)}),[m,d]),D=(0,n.useCallback)((({membersTree:e,expansionAction:t})=>{C({type:"memberExpanded",membersTree:e,expansionAction:t})}),[C]),Y=(0,n.useCallback)((({searchTree:e,previousSelectedPaths:t,newSelectedPaths:r,isHierarchySlicing:i})=>{const n=(0,H.g0)({searchTree:e,previousSelectedPaths:t,newSelectedPaths:r,isHierarchySlicing:i}),a=(0,Q.p)({action:n,previousSelectedMemberNamePaths:m.members}),o={...m,members:a};d(o)}),[m,d]),T=(0,n.useCallback)((e=>{const t=(0,c.produce)(m,(t=>{t.members=e}));d(t)}),[m,d]);return(0,s.FD)("div",{css:{width:"100%",height:350,backgroundColor:y.white,padding:"0 8px"},children:[(0,s.Y)("div",{style:{height:"calc(350px - 35px)"},children:o?(0,s.Y)(J.y,{...S,serverKey:l,selectedMemberNamePaths:m.members,cubeName:t.name,dimensionName:m.dimensionName,hierarchyName:m.hierarchyName,onSelectionChanged:N,onLevelIndexChanged:e=>{C({type:"levelIndexChanged",levelIndex:e})},filters:M}):(0,s.Y)(X.C,{...S,isSearchVisible:!1,searchValue:u,selectedMemberNamePaths:m.members,serverKey:l,cubeName:t.name,dimensionName:m.dimensionName,hierarchyName:m.hierarchyName,onMemberSelected:({membersTree:e,nodePaths:t})=>{const r=(0,G.G)(t,e),i={...m,members:r};d(i)},onMemberExpanded:D,onSearchResultSelected:Y,onMemberRemovedInTooltip:T,hasCheckbox:()=>!0,isAllMemberSelected:!1,mdxInView:x,filters:M})}),(0,s.Y)(k.Checkbox,{css:{borderTop:`1px solid ${y.grayScale[5]}`,width:"100%",paddingTop:5,marginTop:5},checked:m.isExclusionFilter,onChange:e=>{const t={...m,isExclusionFilter:e.target.checked};d(t)},children:f({id:"aui.filters.excludeFilter"})})]})},{Text:re}=k.Typography,{useToken:ie}=k.theme,ne=e=>{const{formatMessage:t}=(0,w.useIntl)(),r=(0,v.DP)(),{cube:a,filters:o,serverKey:l,onFilterChanged:u,section:p,dashboardState:h,pageKey:g,widgetState:m,filter:y,filterIndexWithinSection:f}=e,[x,S]=(0,n.useState)(),{token:C}=ie(),M=(0,D.q)(y,a),N=(0,n.useCallback)((e=>{const t=(0,c.produce)(y,(t=>{t.members.splice(e,1)}));u(t)}),[y,u]),Y=y.members.map(((e,t)=>({key:t,value:{namePath:e,index:t}}))),[T,O]=(0,n.useState)(!1),K=(0,n.useRef)(null),I=(0,n.useRef)(null);!function(e,t,r){void 0===r&&(r=V);var i=(0,n.useRef)(t);(0,n.useEffect)((function(){i.current=t}),[t]),(0,n.useEffect)((function(){for(var t=function(t){var r=e.current;r&&!r.contains(t.target)&&i.current(t)},n=0,a=r;n<a.length;n++){var o=a[n];A(document,o,t)}return function(){for(var e=0,i=r;e<i.length;e++){var n=i[e];q(document,n,t)}}}),[r,e])}(I,(()=>{O(!1),S(void 0)}));const[F,P]=(0,d.usePopupSize)(K,`${y.dimensionName}-${y.hierarchyName}`),L=y.members.length>0?y.members[0].length-1:0,$=Object.keys(M.levels)[L];return(0,s.FD)(E.o,{ref:I,levelName:$||M.caption,children:[y.isExclusionFilter&&(0,s.Y)(d.Tooltip,{trigger:["hover"],title:t({id:"aui.excluded"}),children:(0,s.Y)(b.IconExclude,{"data-testid":"exclude-icon",style:{marginLeft:C.marginSM,opacity:0===y.members.length?"0.4":"initial"}})}),(0,s.Y)(i.ClassNames,{children:({css:e})=>(0,s.Y)(k.Select,{showArrow:!0,bordered:!1,className:e`
              .ant-select-selection-overflow-item-rest {
                .ant-select-selection-item {
                  height: 20px;
                  background: ${r.grayScale[1]};
                }
              }
            `,style:{minWidth:0===y.members.length?100:void 0,width:"max-content"},open:T,onClick:()=>O((e=>!e)),placeholder:M.caption,popupMatchSelectWidth:!1,searchValue:x,mode:"tags",value:Y,maxTagCount:2,onSearch:S,tagRender:({value:e})=>{const{namePath:t,index:r}=e,i=M.slicing?t:t.slice(1),n=i.length>2;return(0,s.Y)(k.Tag,{closable:!0,onClose:()=>{N(r)},style:{display:"inline-flex"},children:(0,s.Y)("span",{css:{maxWidth:"130px",display:"inline-flex",flexWrap:"nowrap",gap:2,"span:last-child":{flexShrink:3},"span:not(:last-child)":{flexShrink:5}},children:(0,B.flatMap)((n?[i[0],(0,s.Y)(d.Tooltip,{style:{flexShrink:0},title:i.slice(1,-1).join(" / "),children:"…"}),i.at(-1)]:i).map((e=>["string"==typeof e?(0,s.Y)(re,{ellipsis:{tooltip:e},children:e}):e,"/"]))).slice(0,-1)})},i.join("/"))},dropdownRender:()=>(0,s.FD)("div",{ref:K,onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{width:P,display:"inline-flex",gap:6},children:[(0,s.Y)(te,{cube:a,filters:o,section:p,filterIndexWithinSection:f,onFilterChanged:u,isHierarchyVirtual:Boolean(M.virtual),serverKey:l,searchValue:x,widgetState:m,dashboardState:h,pageKey:g,filter:y}),(0,s.Y)(j.A,{onResize:F})]})})})]})};var ae=r(65001),oe=r(59003),se=r(59949),le=r(20629),de=r(83164);function ce({dataModels:e,serverKey:t,cubeName:r,lastUsedCube:i}){const n=Object.keys(e);if(0===n.length)throw new h.d({existingServerKeys:n});if(t&&!n.includes(t))throw new h.d({serverKey:t,existingServerKeys:n});if(t&&r){const i=e[t];return{cube:(0,de.W)(i,r),dataModel:i,serverKey:t}}if(t&&!r){const r=e[t],i=function({serverKey:e,dataModel:t}){const r=Object.values(t.catalogs).find((({cubes:e})=>Object.values(e).length>0));if(void 0===r)throw new le.F(e);return Object.values(r.cubes)[0]}({serverKey:t,dataModel:r});return{serverKey:t,dataModel:r,cube:i}}if(!t&&r){const t=function({cubeName:e,dataModels:t}){const r=[];for(const i in t)for(const n of Object.values(t[i].catalogs))for(const t in n.cubes){if(t===e)return i;r.push(t)}throw new se.N(e,r)}({cubeName:r,dataModels:e});return ce({dataModels:e,serverKey:t,cubeName:r})}if(i)try{return ce({dataModels:e,serverKey:i.serverKey,cubeName:i.cubeName})}catch(e){if(!(e instanceof h.d||e instanceof se.N))throw e}return ce({dataModels:e,serverKey:n[0]})}function ue({initialCubeName:e,serverKey:t,...r}){const[i]=(0,ae.v)("lastUsedCube");return ce({cubeName:Z(r)&&r.query.mdx?(0,oe.z)(r.query.mdx):e,serverKey:t,dataModels:(0,p.W)(),lastUsedCube:i})}const pe=(0,n.lazy)((async()=>{const{FiltersBarDateRangePicker:e}=await r.e(1864).then(r.bind(r,81864));return{default:e}})),he=e=>{const t=(0,v.DP)(),{formatMessage:r}=(0,w.useIntl)(),{cube:a,serverKey:o}=ue(e.widgetState),l=(0,n.useRef)(null),{width:u}=(0,d.useDebouncedComponentSize)(l),p=e.filters[e.section],[{isLeftScrollArrowVisible:h,isRightScrollArrowVisible:g},m]=(0,n.useState)({isLeftScrollArrowVisible:!1,isRightScrollArrowVisible:!1}),y=`1px solid ${t.grayScale[5]}`,f={display:"flex",alignItems:"center",height:"100%",background:t.grayScale[3],borderLeft:y,borderRight:y},x={fontSize:16,margin:6,marginTop:8},S={height:"100%",minWidth:24,zIndex:2,background:t.grayScale[0],position:"absolute",display:"flex",justifyContent:"center"},M=(0,n.useCallback)((()=>{if(l.current){const{scrollLeft:e,scrollWidth:t,clientWidth:r}=l.current,i=e>0,n=e+r<t;h===i&&g===n||m({isLeftScrollArrowVisible:i,isRightScrollArrowVisible:n})}}),[h,g]),k=(t,r)=>{const i=(0,c.produce)(p,(e=>{e[r]=t}));e.onFiltersChanged(i)},D=e=>{l.current?.scrollBy({left:"left"===e?-60:60})};(0,n.useEffect)((()=>{M()}),[u,M]);const Y=p.filter((({isPinned:e})=>e));return 0===Y.length?null:(0,s.FD)("div",{style:{display:"flex",alignItems:"stretch",overflow:"hidden",position:"relative"},css:i.css`
        .left-scroll-arrow,
        .right-scroll-arrow {
          visibility: collapse;
        }

        :hover {
          .left-scroll-arrow {
            visibility: ${h?"visible":"collapse"};
          }
          .right-scroll-arrow {
            visibility: ${g?"visible":"collapse"};
          }
        }
      `,children:[e.isIconVisible&&"dashboard"===e.section&&(0,s.Y)(d.Tooltip,{mouseLeaveDelay:0,placement:"bottom",title:r({id:"aui.filters.section.dashboardFilters"}),children:(0,s.Y)("div",{style:f,children:(0,s.Y)(b.IconDashboardFilters,{style:x})})}),e.isIconVisible&&"page"===e.section&&(0,s.Y)(d.Tooltip,{mouseLeaveDelay:0,placement:"bottom",title:r({id:"aui.filters.section.pageFilters"}),children:(0,s.Y)("div",{style:f,children:(0,s.Y)(b.IconPageFilters,{style:x})})}),(0,s.FD)("div",{style:{display:"flex",overflow:"hidden",alignItems:"center"},ref:l,onScroll:M,onWheel:e=>{l.current?.scrollBy({left:e.deltaY<0||e.deltaX<0?-20:20})},children:[(0,s.Y)("div",{className:"left-scroll-arrow",style:{...S,boxShadow:`5px 0 2px -1px ${t.grayScale[5]}`},onClick:()=>{D("left")},children:(0,s.Y)(C,{})}),(0,s.Y)("div",{style:{display:"flex",gap:"6px",height:"32.5px",margin:"0px 6px"},children:Y.map((t=>{const r=p.indexOf(t),i=`${t.dimensionName}-${t.hierarchyName}-${t.type}-${r}`;switch(t.type){case"members":return(0,s.Y)(ne,{cube:a,serverKey:o,filters:e.filters,filterIndexWithinSection:r,section:e.section,onFilterChanged:e=>k(e,r),widgetState:e.widgetState,dashboardState:e.dashboardState,pageKey:e.pageKey,filter:t},i);case"dateRange":return(0,s.Y)(n.Suspense,{fallback:(0,s.Y)("div",{}),children:(0,s.Y)(pe,{filter:t,onFilterChanged:e=>k(e,r)},i)},i);case"topBottomMembers":case"lowerOrGreaterValue":case"valuesRange":case"lowerOrGreaterCaptions":case"captionsRange":case"captionsContaining":case"existenceOfValue":case"recentDates":return(0,s.Y)(R,{cube:a,filter:t,onFilterChanged:e=>k(e,r)},i);default:return null}}))}),(0,s.Y)("div",{className:"right-scroll-arrow",style:{...S,boxShadow:`-5px 0 2px -1px ${t.grayScale[5]}`,right:0},onClick:()=>{D("right")},children:(0,s.Y)(N,{})})]})]})};var ge=r(60015);function me(e){Z(e)&&(delete e.areFiltersDrivenByMdx,e.query?.mdx&&(e.query.mdx=(0,ge.D)(e.query.mdx)))}var ye=r(64759);const fe=[];function ve(e,t,r){const[i,,]=(0,ye.J)("canUseUserFilters"),[a]=(0,ae.v)("userFilters"),o=a&&i?a:fe,s=(0,n.useMemo)((()=>t?.filters||fe),[t]),l=(0,n.useMemo)((()=>(0,y.W)(t,r)?.filters||fe),[t,r]),d=(0,n.useMemo)((()=>e?.filters||fe),[e?.filters]);return(0,n.useMemo)((()=>({user:o,dashboard:s,page:l,widget:d})),[s,l,o,d])}function we(e){return"dashboardState"in e&&Boolean(e.dashboardState)&&Boolean(e.pageKey)&&Boolean(e.leafKey)}const be=e=>{const t=(0,v.DP)(),r=we(e)?(0,g.B)(e.dashboardState,e.pageKey,e.leafKey):e.widgetState,i=(0,p.W)(),{dashboardState:a,pageKey:o,leafKey:l,onDashboardChanged:d}={dashboardState:void 0,pageKey:void 0,leafKey:void 0,onDashboardChanged:void 0,...e},w=ve(r,a,o),b=(0,n.useMemo)((()=>e.filterTypes.map((e=>({section:e,filters:w[e]})))),[w,e.filterTypes]),x=(0,n.useMemo)((()=>b.filter((({filters:e})=>e.some((({isPinned:e})=>e)))).length),[b]),S=x>1;return x>0&&r?(0,s.Y)("div",{css:{display:"flex",overflow:"hidden",alignItems:"center",...!e.filterTypes.includes("widget")&&{background:t.grayScale[1],borderBottom:`1px solid ${t.grayScale[5]}`}},children:b.map((({section:t},n)=>(0,s.Y)("div",{style:{height:44,display:"flex",alignItems:"stretch",overflow:"hidden"},children:(0,s.Y)(u.ErrorBoundary,{resetKeys:[i],fallbackRender:({error:e})=>{if(e instanceof h.d)return null;throw e},children:(0,s.Y)(he,{isIconVisible:S,section:t,filters:w,onFiltersChanged:r=>((t,r)=>{if(we(e)){if(a&&o&&l&&d){const e=(0,c.produce)(a,(e=>{if("dashboard"===r&&(e.filters=t,(0,m.y)(e,me)),"page"===r){const r=(0,y.W)(e,o);r&&(r.filters=t,(0,f.T)(r,me))}if("widget"===r){const r=(0,g.B)(e,o,l);r&&(r.filters=t,me(r))}}));d(e)}}else{const r=(0,c.produce)(e.widgetState,(e=>{e.filters=t,me(e)}));e.onWidgetChanged(r)}})(r,t),widgetState:r,dashboardState:a,pageKey:o})})},n)))}):null},xe=(0,n.createContext)(!1),Se=xe.Provider;function Ce(){return(0,n.useContext)(xe)}var Me=r(83020);const Ne=e=>{const{keys:t,actionProps:r,closeContextMenu:i,...a}=e,o=(0,Me.uC)(t),[l,d]=(0,n.useState)([]),c=(0,n.useRef)(!1),u=[],p=[];for(const e of o){!1===e.doesContextMenuCloseOnClick&&p.push(e.key);const t=e.useMenuItem(r);t&&u.push({key:e.key,...t})}return(0,s.Y)(k.Menu,{openKeys:l,onOpenChange:e=>{0!==e.length||!0!==c.current?d(e):c.current=!1},onClick:e=>{p.some((t=>e.keyPath.includes(t)))?c.current=!0:i?.()},...a,items:u})};function ke(e){return"dashboardState"in e}function De(e){return()=>e}const Ye=[],Te=e=>{const{widgetPlugin:t,onChange:r,isSelected:a,...o}=e,[c,u]=(0,n.useState)(!1),p=(t.useOnDataModelNodeClicked??De)(e.widgetState);(0,l.gO)((e=>{if(a){const t=p(e);r(t)}}));const h=t?.contextMenuItems??Ye,g={...o,onWidgetChange:r},{leafKey:m,pageKey:y,dashboardState:f,onDashboardChange:v}=ke(e)?e:{leafKey:void 0,pageKey:void 0,dashboardState:void 0,onDashboardChange:void 0},w=Z(e.widgetState)&&(0,s.Y)("div",{style:{flexGrow:0,marginRight:2,marginLeft:2,paddingLeft:14},children:(0,s.Y)(be,{dashboardState:f,leafKey:m,pageKey:y,filterTypes:["widget"],onDashboardChanged:v,widgetState:e.widgetState,onWidgetChanged:e.onChange})});return(0,s.Y)(Se,{value:c,children:(0,s.Y)(d.Dropdown,{destroyPopupOnHide:!0,onOpenChange:u,dropdownRender:()=>(0,s.Y)(Ne,{keys:h,actionProps:g,css:{maxWidth:600},closeContextMenu:()=>u(!1)},e.widgetState.widgetKey),trigger:["contextMenu"],children:(0,s.FD)("div",{css:i.css`
            height: 100%;
            display: flex;
            flex-direction: column;
          `,children:[w,(0,s.Y)("div",{css:{flexGrow:1,minHeight:0},children:(0,s.Y)(t.Component,{...e})})]})})})};var Oe=r(23446),Ke=r(36539);function Ie({queryId:e,widgetState:t}){const r=(0,Ke.J)({queryId:e,serverKey:t&&Z(t)?t.serverKey:void 0});return!(!r?.data||!(0,Oe.isCellSet)(r.data))&&r.data.axes.some((({range:e})=>e&&!e.entireAxis))}var Fe=r(50122);const Pe=e=>"allMeasures"===e.type,Le={primaryNumeric:"numeric",primaryOrdinal:"ordinal",secondaryNumeric:"numeric",secondaryOrdinal:"ordinal",subplot:"ordinal"};function $e(e){return Le[e]}const We=(e,t,r)=>{for(let i=0;i<t.length&&0!==r.length;i++){const n=t[i],a=n.maxNumberOfFields||1/0;for(;e[n.name].length<a&&r.length>0;){const t=r.shift();t&&e[n.name].push(t)}}};function Ee(e,t){return t.doesSupportMeasuresRedirection?e:e.filter((e=>!Pe(e)))}function Re(e,t){const r=t.attributes??{},i=(0,B.mapValues)(r,(()=>[])),n=function(e){const t=Object.entries(e).map((([e,t])=>({...t,name:e}))),r=(0,B.groupBy)(t,(e=>$e(e.role)));return(0,B.mapValues)(r,(e=>(0,B.groupBy)(e,"role")))}(r);return Object.entries(e).forEach((([e,r])=>{const a=[],o=n?.[e]||[];if(Object.entries(r).forEach((([e,r])=>{const n=[],s=o?.[e]||[];!function({mapping:e,attributes:t,fields:r,unmappedFields:i,widgetPlugin:n}){r.forEach(((r,a)=>{const o=Ee(r,n),s=t[a];if(s){const t=s.maxNumberOfFields||1/0;o.forEach((r=>{e[s.name].length<t?e[s.name].push(r):i.push(r)}))}else i.push(...o)}))}({mapping:i,attributes:s,fields:r,unmappedFields:n,widgetPlugin:t}),n.length>0&&We(i,s,a),a.push(...n)})),a.length>0&&We(i,(0,B.flatten)(Object.values(o)),a),a.length>0)throw new Error(`The chosen widget type does not support the current mapping: too many chosen ${e} fields.`)})),i}function Be(e,t,r){const i=Object.entries(e).reduce(((e,[i,n])=>{const a=$e(t[i].role),o=Ee(n,r);return{...e,[a]:e[a]+o.length}}),{numeric:0,ordinal:0}),n=r.attributes||{},a=Object.values(n).reduce(((e,t)=>{const r=$e(t.role);return{...e,[r]:e[r]+(t.maxNumberOfFields||1/0)}}),{numeric:0,ordinal:0});return i.numeric>a.numeric?{status:"tooManyNumeric",maxNumberOfFields:a.numeric}:i.ordinal>a.ordinal?{status:"tooManyOrdinal",maxNumberOfFields:a.ordinal}:{status:"ok"}}const Ae=e=>"dataVisualization"===e.category,qe=(e,t)=>{if(e.widgetKey!==t.key)throw new Error(`Expected widgetPlugin's key to be ${e.widgetKey} but was ${t.key}`);return Ae(t)};function Ve(e,t){const[r]=(0,o.useWidgetPlugins)(e?[e.widgetKey]:[]),i=e&&qe(e,r)?e.switchedTo:void 0,a=Ie({queryId:t,widgetState:e}),[s]=(0,o.useWidgetPlugins)(i?[i]:[]);return(0,n.useMemo)((()=>{const t=void 0!==s?.lazyLoading;if(!(e&&qe(e,r)&&Ae(r)&&s&&Ae(s))||a&&!t)return e;const i=function(e,t,r){const i=e.mapping,n=t.attributes||{},a=r.attributes||{},o=t.doesSupportMeasuresRedirection,s=r.doesSupportMeasuresRedirection,l=Re(function(e,t){const r={};return Object.entries(t).forEach((([t,i])=>{const n=$e(i.role);(0,B.defaultsDeep)(r,{[n]:{[i.role]:[]}}),r[n][i.role].push(e[t]||[])})),r}(i,n),r);if(o&&!s){const e=(0,B.findKey)(l,(e=>e.some(Pe)));e&&(l[e]=l[e].filter((e=>!Pe(e))))}else if(!o&&s){const t=e.query.mdx,r="ROWS"===(t&&(0,Fe.Y)(t))?"primaryOrdinal":"secondaryOrdinal",i=(0,B.findKey)(a,(e=>e.role===r));i&&l[i].push({type:"allMeasures"})}return l}(e,r,s);return(0,c.produce)(e,(e=>{e.widgetKey=s.key,Reflect.deleteProperty(e,"switchedTo"),e.mapping=i}))}),[s,r,e,a])}const je=e=>{const{onSelectionChange:t}=e,[r,a]=(0,n.useState)(e.widgetState),s=e.onChange?e.widgetState:r,l=e.onChange??a,d=Ve(s),[c]=(0,o.useWidgetPlugins)([d.widgetKey]),[u,p]=(0,n.useState)(void 0),h=(0,n.useCallback)((e=>{p(e),t&&t(e)}),[p,t]);return(0,i.createElement)(Te,{...e,widgetState:d,widgetPlugin:c,selection:u,onSelectionChange:h,onChange:l,key:d.widgetKey})},ze=e=>{const t=e.widgetState.widgetKey,[r]=(0,o.useWidgetPlugins)([t]);return(0,i.createElement)(Te,{...e,widgetPlugin:r,key:t})},Ue={whenInRows:{paddingRight:8}},_e={whenInRows:{paddingLeft:8,paddingTop:2}},Ge=e=>(0,s.Y)(d.DynamicResizable,{widthThreshold:400,firstChildStyle:Ue,secondChildStyle:_e,children:e.children}),He=()=>{const e=(0,v.DP)();return(0,s.FD)("div",{css:i.css`
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      `,children:[(0,s.FD)("svg",{viewBox:"64 64 896 896",width:"64",height:"64",fill:"currentColor",children:[(0,s.Y)("path",{d:"M134.4 269.5l-1.9 1.8c-14.3 14.1-14.2 32.7-14.2 39.7.4 149.2.4 300.9.4 447.7v99.6a44.7 44.7 0 0044.6 44.7l184.1 1c16.5-.7 31.7-8.1 41.7-21.2a52.4 52.4 0 009.4-45.7A120.8 120.8 0 00388 811c-.8-1.3-1.5-2.7-2.2-4.1-5.5-10-10.3-18.7-11.5-26.5-3.2-21.2 3.7-42.3 18.1-55 9.2-8.2 20.8-12.3 34.3-12.3a82.6 82.6 0 0122.7 3.5c18.2 5.1 26.9 19.4 30.5 27.5a59.4 59.4 0 01-.8 50c-1.3 2.9-3 5.9-4.7 9.1-5.3 9.7-11.2 20.7-14.7 34.2a52.7 52.7 0 0051.1 65.9h66c36.6 0 73.8.1 110.5.5h1.6c7.1 0 23.3-.8 36.2-12.7l-57.1-60v.5l-91.9-.3c-10.8 0-21.6 0-32.3-.3H541c.9-1.5 1.9-3.3 2.8-5.2a130.6 130.6 0 001.9-111c-14.9-33.3-42.8-57.9-76.6-67.5a156 156 0 00-42.4-6.2 128.8 128.8 0 00-26.5 2.7 120.9 120.9 0 00-55.5 27.6c-32.6 28.9-48.5 74.9-41.5 120 2.4 15.4 14 40.6 14 40.6H190.7v-72.6c0-140.7 0-286.1-.4-429.4h1.3l-57.2-60.2",fill:"currentColor"}),(0,s.Y)("path",{d:"M924.9 566a50.6 50.6 0 00-.5-6.8c-6.8-43.6-31.6-79.1-67.9-97.3s-76.4-16.7-113.4 2.7l-1.2.6c.1-21.4.1-42.8 0-63.7 0-29.9 0-60.8.3-91.1.1-7.2.3-26.2-14.2-40.7s-33.3-14.1-39.6-14.1c-31.9.4-64.6.4-96.1.4h-52.2c.8-1.4 1.6-3 2.4-4.6 19-39.5 19-83 .2-119.6s-51.7-59.3-92-66.2a47.1 47.1 0 00-7.4-.6h-28.9a48.7 48.7 0 00-7.6.6c-42.3 7.2-74.1 30.3-91.8 66.9-19.9 41-19.9 81.1.1 119l3.6 6.6c-49 .2-99.2.3-148.5-.3-5.8-.1-23-.3-36.8 12l57.3 60.2c50.1.5 100.5.2 149.4 0h7.7c7.2-.1 26.2-.1 41.1-16a44.6 44.6 0 0011.5-24.8c3.5-28.3-8.3-48.2-16.9-62.8-1.8-3-3.5-5.9-4.9-8.6-9.1-17.3-8.8-33.9 1-54 7.3-15.2 18.4-23.3 36.8-26.8h23.9c17.1 3.5 30.6 13.2 38.1 27.7 8.4 16.3 8 36.4-1.1 55.3a97.3 97.3 0 01-4.8 8.5c-5.4 9.2-12.7 21.7-15 39.7-.9 6.9-3.6 27.7 11.3 44.4 6.4 7.2 18.2 15.9 37.7 15.6 28.5-.2 57.5-.2 85.6-.2 25.5 0 51.7 0 77.9-.2-.2 24.7-.2 49.5-.2 73.6.1 31.8.1 64.7-.3 96.9-.3 18.3 5.3 32.4 16.6 42s25.6 12.5 43.1 9.4 29-10.5 39.1-16.5l8.4-4.9c16.4-8.5 33.3-9.3 47.6-2.1s25.2 22.8 28.7 42.3V594c-3.9 20.1-14.6 35.7-29.7 42.9s-31.2 5.7-47.6-3.5l-4.8-2.7c-15.1-8.6-35.7-20.3-62.3-18.4a44.3 44.3 0 00-20.8 6.9c-21.2 13.8-20.3 44.5-20 46.9 0 .2.1.4.1.6v8.3c-.3 51.4-.5 104.4 0 157l57 60 1.3-1.2c14.3-14.3 14-33.4 14-39.6-.6-51.6-.5-104-.3-155.1 37 20.8 78.8 22.9 114.5 5.7s62.5-53.5 69.9-98.1a45.6 45.6 0 00.6-7.5z",fill:e.primaryColor})]}),(0,s.Y)("h4",{className:"ant-typography",css:i.css`
          font-size: 14px;
          line-height: 22px;
          font-weight: 400;
          color: rgba(0, 0, 0, 0.85);
          margin: 0px;
        `,children:"Drag widget to dashboard."})]})},Qe=e=>!e||Object.values(e).every((e=>!e||e.every(Pe))),Je=e=>({axes:[],cellProps:["VALUE","FORMATTED_VALUE","BACK_COLOR","FORE_COLOR","FONT_FLAGS"],elementType:"Select",from:{cubeName:e,elementType:"From"},slicerAxis:null,withClause:[]}),Xe=e=>({select:Je(e),elementType:"Drillthrough",columns:[]});var Ze=r(37025),et=r(59621);class tt extends Error{mappingType;attributeName;constructor(e,t){super(`Can not serialize the "${t}" field with "${e}" type in mapping. Available types are: 'allMeasures', 'measure', 'gluedHierarchy', 'hierarchy', 'kpiProperty'.`),this.mappingType=e,this.attributeName=t}}const rt=e=>"mapping"in e,it=e=>{const t=(0,et.hD)(e.dimensionName,e.hierarchyName,e.levelName);return e.expandedDownTo?`${t} => ${(0,et.hD)(e.dimensionName,e.hierarchyName,e.expandedDownTo)}`:t};var nt=r(67737);function at(e){return"style"in e}var ot=r(94241),st=r(89801);function lt(e){const t={...e,filters:e.filters?.map(ot.V)};return void 0===t.filters&&delete t.filters,Z(t)&&Z(e)&&e.query.mdx&&(t.query={...e.query,mdx:(0,st.A)(e.query.mdx)}),t}function dt(e){return lt(function(e){return rt(e)?(0,c.produce)(e,(e=>{const{mapping:t}=e;return Object.entries(t).forEach((([t,r])=>{const i=r.map((e=>{if(void 0===e.type)return e;switch(e.type){case"compositeHierarchy":return e.hierarchies.map(it).join(" => ");case"hierarchy":return it(e);case"allMeasures":return"ALL_MEASURES";case"measure":return(0,et.hD)("Measures",e.measureName);case"kpiProperty":{const{kpiName:t,propertyName:r,underlyingMeasureName:i}=e;return(0,Ze.L)({kpiName:t,kpiPropertyName:r,underlyingMeasureName:i})}case"namedSet":return(0,et.hD)(e.name);default:throw new tt(e.type,t)}}));e.mapping[t]=i})),e})):e}(function(e){if(!at(e))return e;const t=e.style?.tupleImpactingRowStyle;if(!t)return e;const r={...e.style,tupleImpactingRowStyle:t.map((({dimensionName:e,hierarchyName:t,namePath:r})=>(0,nt.t)({dimensionName:e})?(0,et.hD)(e,...r):(0,et.hD)(e,t,...r)))};return{...e,style:r}}(e)))}var ct=r(8233),ut=r(39166),pt=r(7994),ht=r(84028);class gt extends Error{attributeName;serializedMappingField;constructor(e,t){super(`Can not deserialize the "${t}" field with stringified value "${e}" in mapping.`),this.attributeName=t,this.serializedMappingField=e}}const mt=/^\[.*\]$/,yt=e=>"mapping"in e;var ft=r(41140),vt=r(82966);function wt(e){const t=function(e){return yt(e)?(0,c.produce)(e,(e=>{const t=e.mapping;return Object.entries(t).forEach((([t,r])=>{const i=r.map((e=>{if("ALL_MEASURES"===e)return{type:"allMeasures"};if(e.startsWith("[Measures]."))return{type:"measure",measureName:(0,ht._)(e)[1]};if(e.startsWith("KPI")){const t=function(e){const t=new Error(`Unable to parse string "${e}" as a KPI property.`),r=e.indexOf("(");let i=1,n=r+1;for(;i>0&&n<e.length;)"("===e[n]&&i++,")"===e[n]&&i--,n++;if(i>0)throw t;const a=n-1,o=e.slice(0,r),s=e.slice(r+1,a),l=e.slice(a+3),d=ct.L.find(((e,t)=>ut.S[t]===o.toLowerCase()));if(!d)throw t;return{kpiName:s,kpiPropertyName:d,underlyingMeasureName:l}}(e);return{type:"kpiProperty",propertyName:t.kpiPropertyName,kpiName:t.kpiName,underlyingMeasureName:t.underlyingMeasureName}}if(e.indexOf(" => ")>-1){const t=e.split(" => "),r=[];for(let e=0;e<t.length;e++){const[i,n,a]=(0,ht._)(t[e]),o=r.at(-1);(0,pt.q)({dimensionName:i,hierarchyName:n},o)?o.expandedDownTo=a:r.push({dimensionName:i,hierarchyName:n,levelName:a})}return 1===r.length?{type:"hierarchy",...r[0]}:{type:"compositeHierarchy",hierarchies:r}}if(mt.test(e)){const t=(0,ht._)(e);if(1===t.length)return{type:"namedSet",name:t[0]};const[r,i,n]=t;return{levelName:n,dimensionName:r,hierarchyName:i,type:"hierarchy"}}throw new gt(e,t)}));e.mapping[t]=i})),e})):e}(function(e){const t={...e,filters:e.filters?.map(ft.w)};return void 0===t.filters&&delete t.filters,Z(e)&&Z(t)&&e.query.mdx&&(t.query={...e.query,mdx:(0,vt.q)(e.query.mdx)}),t}(function(e){if(!at(e))return e;const t=e.style?.tupleImpactingRowStyle;if(!t)return e;const r={...e.style,tupleImpactingRowStyle:t.map((e=>{const t=(0,ht._)(e);return 2===t.length&&"Measures"===t[0]?{dimensionName:"Measures",hierarchyName:"Measures",namePath:[t[1]]}:{dimensionName:t[0],hierarchyName:t[1],namePath:t.slice(2)}}))};return{...e,style:r}}(e)));return t}function bt(e){const{formatMessage:t}=(0,w.useIntl)();return e.name??t({id:`aui.plugins.widget.${e.widgetKey}.defaultName`})}var xt=r(4654),St=r(87974),Ct=r(65161),Mt=r(74928),Nt=r(46447),kt=r(36335),Dt=r(35236);const Yt=[],Tt=({dragItem:e})=>e&&((0,Nt.a)(e)||(0,St.x)(e)||(0,Ct.G)(e)||(0,kt.Y)(e)||(0,Mt.f)(e));function Ot(e,t){e.filters=t,me(e)}const Kt=e=>{const{widgetState:t,onWidgetChange:r}=e,{cube:i,serverKey:a}=ue(t),o=(0,xt.M)(e),{dashboardState:d,leafKey:u,pageKey:p,onDashboardChange:h}=o?e:{},[v,w]=(0,n.useState)(),b=ee({dashboardState:d,pageKey:p,widgetState:t}),[x]=(0,ye.J)("canUseUserFilters"),[S,C]=(0,ae.v)("userFilters"),M=S??Yt,N=ve(t,d,p),k=({serverKey:e,cubeName:t,dimension:r,hierarchy:i,position:n})=>{w({serverKey:e,cubeName:t,hierarchyCoordinates:{dimensionName:r.name,hierarchyName:i.name},position:n,levelIndex:i.slicing?0:1,type:"create-filter"})},D=(0,n.useCallback)((({serverKey:e,cubeName:t,dimension:r,position:i})=>{const n=r.hierarchies[r.defaultHierarchy];k({serverKey:e,cubeName:t,dimension:r,hierarchy:n,position:i})}),[]),Y=(0,n.useCallback)(((e,t)=>{const r=N.widget.length;switch(e.type){case"dimension":D({serverKey:e.serverKey,cubeName:e.cubeName,dimension:e.dimension,position:{sectionName:"widget",tileIndex:r}}),t.preventDefault();break;case"hierarchy":case"level":k({serverKey:e.serverKey,cubeName:e.cubeName,dimension:e.dimension,hierarchy:e.hierarchy,position:{sectionName:"widget",tileIndex:r}}),t.preventDefault()}}),[N.widget.length,D]);(0,l.z4)(Y);const T=["widget"];return o&&T.unshift("dashboard","page"),x&&T.unshift("user"),(0,s.Y)(Dt.l,{areCubeFiltersVisible:!0,serverKey:a,cubeName:i.name,filters:N,onFiltersChange:e=>{if(x&&e.user!==M&&C(e.user),d&&h){const t=(0,c.produce)(d,(t=>{e.dashboard!==d.filters&&(t.filters=e.dashboard,(0,m.y)(t,me));const r=(0,y.W)(t,p);if(r&&r.filters!==e.page&&(r.filters=e.page,(0,f.T)(r,me)),u){const r=(0,g.B)(t,p,u);r&&Ot(r,e.widget)}return t}));return void h(t)}const i=(0,c.produce)(t,(t=>{Ot(t,e.widget)}));r(i)},canDrop:Tt,popoverConfiguration:v,onPopoverConfigurationChanged:w,mdxInViews:b,visibleSectionNames:T})},It=e=>{const{widgetState:t,queryType:r="select",...i}=e;return Z(t)?(0,s.Y)(Kt,{widgetState:t,queryType:r,...i}):null};var Ft=r(28388),Pt=r(11343);function Lt(e,t,{cube:r,areFiltersDrivenByMdx:i}){return(0,n.useMemo)((()=>{if(!e.mdx||i)return e;const n=t.reduce(((e,t)=>{const i=(0,Ft.l)(t,r);return i&&e.push({mdx:i,nonVisualTotals:t.nonVisualTotals}),e}),[]);return{...e,mdx:(0,Pt._)(e.mdx,{filters:n,cube:r})}}),[e,t,r,i])}function $t(e,t,r){const[i]=(0,ye.J)("canUseUserQueryContext"),[a]=(0,ae.v)("userQueryContext"),o=t?.queryContext,s=(0,y.W)(t,r)?.queryContext,l=e.queryContext;return(0,n.useMemo)((()=>({...o?{dashboard:o}:{},...s?{page:s}:{},...l?{widget:l}:{},...i&&a?{user:a}:{}})),[a,o,s,l,i])}const Wt=e=>e.reduce(((e,{key:t,value:r})=>({...e,[t]:r})),{});function Et(e,t,r){const i=$t(e,t,r),{query:a}=e,o=(0,n.useMemo)((()=>Wt([...i.user||[],...i.dashboard||[],...i.page||[],...i.widget||[]])),[i]);return(0,n.useMemo)((()=>({...a,context:o})),[a,o])}function Rt(e){return(0,n.useMemo)((()=>{if(e.mdx)return{...e,mdx:(0,st.A)(e.mdx,{indent:!0})}}),[e])}var Bt=r(2688),At=r(96678);function qt({isDeferred:e,pageKey:t}){const r=(0,At.g)(),i=Boolean(t&&r&&t!==r);return e||i}function Vt({serverKey:e,queryId:t,query:r,pageKey:i,isDeferred:a}){const o=(0,Bt.mF)(e),s=qt({isDeferred:a,pageKey:i});return(0,n.useEffect)((()=>{if(!o||!t||!s)return;const e=o.getQuery(t);e&&"realTime"===e.updateMode&&o.setQuery(t,{...e,updateMode:"once"})}),[t,s,o]),(0,Ke.J)({serverKey:e,queryId:t,query:s?void 0:r})}function jt({serverKey:e,queryId:t,widgetState:r,dashboardState:i,pageKey:a,cube:o,queryRanges:s,isDeferred:l}){const d=Et(r,i,a),c=ve(r,i,a),u=Lt(d,(0,n.useMemo)((()=>[...c.user,...c.dashboard,...c.page,...c.widget]),[c]),{cube:o,areFiltersDrivenByMdx:r.areFiltersDrivenByMdx});return Vt({serverKey:e,queryId:t,query:Rt((0,n.useMemo)((()=>({...u,ranges:s})),[u,s])),pageKey:a,isDeferred:l})}function zt({cleanedUpProperty:e,getTrigger:t}){return r=>i=>(0,s.Y)(r,{...i,onWidgetChange:r=>{const n=t(r)!==t(i.widgetState)?(0,c.produce)(r,(t=>{delete t[e]})):r;i.onWidgetChange(n)}})}const Ut=e=>"measure"===e.type;function _t(e){return"kpiProperty"===e.type}const Gt=e=>"hierarchy"===e.type,Ht=e=>"namedSet"===e.type,Qt=e=>"compositeHierarchy"===e.type;var Jt=r(31152),Xt=r(23472),Zt=r(10070);class er extends Error{constructor(e){super(`Expected an MdxSelect or an MdxDrillthrough, but received an MDX of type "${e.elementType}".`)}}class tr extends Error{constructor(){super("The provided MDX is incompatible with the dashboard or page filters.")}}var rr=r(8449),ir=r(10506),nr=r(23107),ar=r(74741),or=r(48076),sr=r(46199),lr=r(58563);class dr extends Error{}var cr=r(12893),ur=r(45455);const pr=({dimensionName:e,hierarchyName:t,levelName:r})=>(0,et.hD)(e,t,r),hr=({levels:e,expansionChains:t,cube:r})=>{const i=[],n=e.slice(),a=t.slice();for(;n.length>0;){const t=n.shift(),o=(0,B.remove)(a,(([e])=>(0,cr.M)(e,t)));if(o.length>1)throw new dr(`The level ${pr(t)} belongs to several expansion chains: ${JSON.stringify(o.map((e=>e.map(pr))),null,2)}`);if(0===o.length)i.push({type:"hierarchy",...t});else{const a=[t];o[0].slice(1).forEach((t=>{if(!(0,B.remove)(n,(e=>(0,cr.M)(e,t)))[0]){const r=pr(t),i=JSON.stringify(e.map(pr));throw new dr(`The level ${r} is in an expansion chain, but does not contribute to the axis dimensionality: ${i}.`)}const i=a.at(-1);if((0,pt.q)(i,t)){const e=(0,ur.r)(t,r).name;i.expandedDownTo=e}else a.push(t)})),i.push(a.length>1?{type:"compositeHierarchy",hierarchies:a}:{type:"hierarchy",...a[0]})}}if(a.length>0)throw new dr(`Some expansion chains are incompatible with the levels used on the axis:\n      Incompatible expansion chains: ${JSON.stringify(a.map((e=>e.map(pr))))}\n      Levels used on axis: ${JSON.stringify(e.map(pr))}\n      `);return i},gr=(e,t)=>(0,cr.M)(e.at(-1),t.fromLevel)?"right":!!(0,cr.M)((0,B.first)(e),t.toLevel)&&"left";function mr(e,t=[]){if(0===e.length)return t;if(0===t.length){const r=e.pop();t.push([r.fromLevel,r.toLevel])}for(let r=0;r<e.length;r++){const i=e[r];for(const n of t){const a=gr(n,i);if(a)return e.splice(r,1),"right"===a?n.push(i.toLevel):n.unshift(i.fromLevel),mr(e,t)}}return[...t,...mr(e)]}function yr(e){return mr(e.slice())}const fr=(e,t)=>(0,B.uniqWith)(e.map((({tupleCoordinates:e,toLevel:r})=>{const i=e.at(-1);if((0,nt.t)(i))throw new dr("'Expand by' under a measure is not supported.");const{dimensionName:n,hierarchyName:a,namePath:o}=i,s=(0,D.q)({dimensionName:n,hierarchyName:a},t),l=o.length-1;return{fromLevel:{dimensionName:n,hierarchyName:a,levelName:Object.keys(s.levels)[l]},toLevel:r}})),B.isEqual),vr=["value","goal","start","expiry","status","trend"];function wr({mdx:e,cube:t,widgetPlugin:r}){const{attributes:i,doesSupportMeasuresRedirection:n}=r;if(!i)throw new Error("Cannot derive a mapping from Mdx for a widget plugin which does not define attributes.");if(!e)return r.initialState.mapping;const a=function({mdx:e,cube:t,shouldIncludeAllMeasures:r=!0}){const[i,n]=["ROWS","COLUMNS"].map((r=>{const i=(e?.axes||[]).find((({name:e})=>e.toUpperCase()===r));if(void 0===i)return[];const n=(0,ir.u)(i,{cube:t}).filter((e=>(0,D.q)(e,t).slicing||"ALL"!==e.levelName));try{const e=(0,nr.P)(i,t),r=yr(fr(e,t));return hr({levels:n,expansionChains:r,cube:t})}catch(e){if(e instanceof dr)return n.map((e=>({...e,type:"hierarchy"})));throw e}})),a=(0,ar.d)(e),o=(0,or.E)(e),s=a.map((e=>{const r=(0,et.hD)("Measures",e),i=!1===(0,rr.D)(e,t)?.visible;let n;const a=o[e]?.properties.find((({name:e})=>"MEMBER_CAPTION"===e||"CAPTION"===e))?.expression;if(void 0!==a&&(0,sr.z)(a)&&(n=a.value),i)for(const i of Object.values(t.kpis))for(const t of vr)if(i[t]===r)return[{type:"kpiProperty",kpiName:i.name,propertyName:`KPI${(0,B.capitalize)(t)}`,underlyingMeasureName:e}];return n?[{measureName:e,type:"measure",caption:n}]:[{measureName:e,type:"measure"}]}));if(r)if(0===a.length)n.unshift({type:"allMeasures"});else{const t=(0,Fe.Y)(e),r=(0,lr.n)(e.axes.find((e=>e.name===t)));("ROWS"===t?i:n).splice(r,0,{type:"allMeasures"})}return{numeric:{primaryNumeric:s},ordinal:{primaryOrdinal:[i],secondaryOrdinal:[n]}}}({mdx:e,cube:t,shouldIncludeAllMeasures:n});return Re(a,r)}function br({widgetState:e,mdx:t,dashboardState:r,pageKey:i,leafKey:n,dataModels:a,widgetPlugin:o,lastUsedCube:s,shouldRemoveFiltersFromQuery:l}){const d=void 0!==r;if(d&&(void 0===i||void 0===n))throw new Error("Must pass a page key and leaf key along with the dashboard state.");if("Select"!==t.elementType&&"Drillthrough"!==t.elementType)throw new er(t);const{serverKey:u,cube:p}=function({dataModels:e,lastUsedCube:t,mdx:r,widgetState:i}){const n=r?(0,oe.z)(r):void 0;if(i.serverKey&&n)try{const t=i.serverKey;return{serverKey:t,dataModel:e[t],cube:(0,de.W)(e[t],n)}}catch(r){if(r instanceof se.N)return ce({serverKey:void 0,dataModels:e,cubeName:n,lastUsedCube:t});throw r}return ce({dataModels:e,serverKey:i.serverKey,cubeName:n,lastUsedCube:t})}({dataModels:a,widgetState:e,lastUsedCube:s,mdx:t}),h=(0,Zt.g)(t,{cube:p});let g=0;if(d){const e=[...r.filters??[],...r.pages[i].filters??[]];if(g=e.length,!e.every(((e,t)=>{if(!h[t])return!1;const{mdx:r,nonVisualTotals:i}=h[t],n=(0,Jt.H)(r,{cube:p,nonVisualTotals:i});return"custom"===e.type?"custom"===n.type&&(0,B.isEqual)(e.mdx,r):(0,B.isEqual)((0,B.omit)(e,["isExclusionFilter","isPinned"]),(0,B.omit)(n,["isExclusionFilter","isPinned"]))&&Boolean(n.isExclusionFilter)===Boolean(e.isExclusionFilter)&&Boolean(n.isPinned)===Boolean(e.isPinned)})))throw new tr}const m=(0,c.produce)(e,(e=>{Z(e)&&t&&("Drillthrough"===t.elementType&&function(e,t){const r=e.query.mdx;if("Drillthrough"!==r?.elementType)return;const i=(0,Xt.S)(t),n=(0,Xt.S)(r);(0,B.isEqual)(i,n)||delete e.shouldUseDefaultColumns}(e,t),l??1?e.query.mdx=(0,Pt._)(t,{filters:[],cube:p}):(e.query.mdx=t,e.areFiltersDrivenByMdx=!0)),e.filters=(d&&g?h.slice(g):h).map((({mdx:e,nonVisualTotals:t})=>(0,Jt.H)(e,{cube:p,nonVisualTotals:t}))),e.serverKey=u,qe(e,o)&&"Select"===t.elementType&&(e.mapping=wr({widgetPlugin:o,mdx:t,cube:p}))})),y=d?(0,c.produce)(r,(e=>{e.pages[i].content[n]=m})):void 0;return{widgetStateDerivedFromMdx:m,dashboardStateDerivedFromMdx:y}}function xr({kpiName:e,propertyName:t}){return`${e} ${t.slice(3)}`}const Sr=({isQueryLazyLoaded:e,selectedWidgetState:t,widgetOption:r})=>{const{formatMessage:i}=(0,w.useIntl)(),a=void 0===t?"":t.name??i({id:`aui.plugins.widget.${Z(t)&&!t.widgetKey.startsWith("drillthrough")?t.switchedTo??t.widgetKey:t.widgetKey}.defaultName`}),o=i({id:`aui.plugins.widget.${r.key}.key`}),l=void 0!==r.lazyLoading;return(0,s.Y)(n.Fragment,{children:i({id:"aui.dataVisualization.switchDisabled"},{maxNumberOfFields:r.maxNumberOfFields,nameOfSelectedWidget:a,nameOfTargetWidgetPlugin:o,reason:e&&!l?"lazyLoading":"tooManyFields",type:r.disabledType})})};function Cr(e,t){return(0,B.mapValues)(t,((t,r)=>e[r]??[]))}const Mr=e=>{const t=(0,v.DP)(),{formatMessage:r}=(0,w.useIntl)(),[a,o]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e.isLoading){const t=setTimeout((()=>{o(!0)}),e.timeBeforeContinueLoadingButtonAppears??2e4);return()=>{clearTimeout(t)}}o(!1)}),[e.isLoading,e.timeBeforeContinueLoadingButtonAppears]),a?(0,s.Y)(n.Fragment,{children:(0,s.Y)("div",{css:i.css`
          background: transparent;
          position: absolute;
          width: 100%;
          z-index: 3;
          display: flex;
          justify-content: center;
        `,children:(0,s.FD)("div",{css:i.css`
            background: ${t.backgroundColor};
            width: calc(100% - 4px);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 8px;
            padding-bottom: 8px;
          `,children:[(0,s.Y)(d.Text,{style:{marginBottom:8},children:r({id:"aui.longLoading"})}),(0,s.Y)(k.Button,{type:"primary",onClick:()=>o(!1),children:r({id:"aui.continueLoading"})})]})})}):null},Nr=(0,n.createContext)(Mr),kr=Nr.Provider,Dr=(0,n.forwardRef)(((e,t)=>{const r=(0,n.useContext)(Nr)??Mr;return(0,s.FD)("div",{ref:t,className:e.className,css:{height:"100%",position:"relative",padding:"0px 2px 3px"},children:[(0,s.Y)(r,{...e}),e.children]})}));var Yr=r(51710),Tr=r(83507),Or=r(78724),Kr=r(75112),Ir=r(97958),Fr=r(62740),Pr=r(28770),Lr=r(73974);const $r=()=>{const e=(0,v.DP)(),{formatMessage:t}=(0,w.useIntl)(),r=(0,Yr.wA)(),i=(0,Bt.MC)(),a=(0,Yr.d4)(Tr.wW),o=(0,Or.R)(),l=(0,Yr.d4)((e=>(0,Kr.L)(e,o))),d=(0,y.W)(a,o),c=(0,n.useCallback)((async(e,t)=>({...wt({...t,...await i.fetchFile({id:e,type:"widget",withMetaData:!1})}),id:e})),[i]),u=(0,n.useCallback)(((e,t)=>({type:"WIDGET",getState:()=>c(e,t)})),[c]);if(!a||void 0===o||void 0===l||void 0===d)return null;const p=e.isDark?b.IconNoSavedWidgetDarkTheme:b.IconNoSavedWidget;return(0,s.FD)("div",{style:{backgroundColor:e.backgroundColor,height:"100%",display:"flex",flexDirection:"column"},children:[(0,s.Y)("div",{style:{padding:"4px 12px",borderBottom:`1px solid ${e.grayScale[3]}`,height:26,color:e.textColor,fontWeight:"bold",fontSize:"12px"},children:t({id:"aui.dataVisualization.savedWidgets"})}),(0,s.Y)("div",{style:{flexGrow:1,minHeight:0},children:(0,s.Y)(Lr.$,{hasGhostActions:!0,contentType:"widget",emptyListMessage:t({id:"aui.dataVisualization.noSavedWidgets"}),EmptyListIcon:p,hasFolderTitle:!0,getDragItem:u,onFileOpened:async(e,t)=>{const i=await c(e,t),n=(0,Ir.U)(d.layout,l),s=(0,Fr.QD)({dashboardState:a,initialWidgetState:i,layoutPath:n,pageKey:o,side:"left"}),u=`${(0,Pr.U)(d.layout)+1}`;r({type:"dashboardUpdated",dashboardState:s,newSelectedWidget:{leafKey:u,pageKey:o}})},mode:"panel",style:{borderTop:`1px solid ${e.grayScale[5]}`}})})]})};var Wr=r(83913);const Er=a().forwardRef(((e,t)=>(0,s.Y)(S.A,{...e,ref:t,icon:Wr.A})));var Rr=r(29410),Br=r(71930);const Ar=a().forwardRef(((e,t)=>(0,s.Y)(S.A,{...e,ref:t,icon:Br.A})));var qr=r(10228),Vr=r(10528),jr=r(56155),zr=r(65038),Ur=r(17264),_r=r(65591);const Gr=(0,n.forwardRef)((({isActive:e,title:t,isDisabled:r,tooltip:n,widget:a,handleClick:o},l)=>{const c=(0,v.DP)();return(0,s.Y)(d.Tooltip,{placement:"top",trigger:["hover"],title:n,children:(0,s.Y)(s.FK,{children:(0,s.Y)(k.Button,{css:i.css`
              justify-content: center !important;
              align-items: center !important;
              border-color: ${e?c.grayScale[7]:c.grayScale[5]} !important;
            `,disabled:r,style:{height:18,width:40,display:"flex",fontSize:11},onClick:e=>{o&&a&&(o(a),e.stopPropagation())},type:e?"primary":"default",children:(0,s.Y)("span",{style:{height:"inherit"},ref:l,children:t})})})})})),Hr=({widgetAddButtonRef:e,widgetSwitchButtonRef:t,...r})=>{const i=(0,v.DP)(),{formatMessage:a}=(0,w.useIntl)(),o=(0,n.useRef)(null),l=(0,d.useHasOverflow)(o),[,c]=(0,jr.useDrag)({type:"WIDGET",item:{state:r.widget.initialState}}),u=r.widget.key===r.selectedWidgetKey,p=r.widget.initialState?.name||r.widget.initialState&&a({id:`aui.plugins.widget.${r.widget.key}.key`}),h=r.widget.Icon||zr.A;return(0,s.Y)("div",{ref:c,css:{backgroundColor:u?i.selectionColor:i.grayScale[1],height:26,cursor:"pointer",padding:"4px 4px 4px 0px",margin:1,outline:r.isActive?`${i.primaryColor} solid 1px`:void 0,display:"flex",alignItems:"center",flexWrap:"wrap",".drag-icon":{color:i.grayScale[6],opacity:0,":hover":{color:i.grayScale[8]}},":hover":{".drag-icon":{opacity:1}},...r.style},onClick:r.onClick,children:(0,s.Y)(d.Tooltip,{title:r.title,trigger:r.isActive?[]:["hover"],placement:"right",children:(0,s.Y)(d.Tooltip,{placement:"left",trigger:r.isCollapsed||l?["hover"]:[],title:p,children:(0,s.FD)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,s.FD)("div",{style:{height:18,display:"flex",justifyContent:"center",alignItems:"center",minWidth:0},children:[(0,s.Y)(b.IconDrag,{className:"drag-icon",style:{cursor:"grab",fontSize:12,flexShrink:0}}),(0,s.Y)(h,{css:{color:i.primaryColor,flexShrink:0},width:25,height:18}),!r.isCollapsed&&(0,s.Y)("div",{css:{marginLeft:"7px",whiteSpace:"nowrap",minWidth:0},ref:o,children:(0,s.Y)(_r.h,{caption:p,searchValue:r.searchValue,captionStyle:{color:i.textColor,overflow:l?"hidden":"initial",textOverflow:"ellipsis"}})})]}),(0,s.FD)("div",{style:{display:"flex",alignItems:"center"},children:[r.isActive&&!r.isCollapsed&&(0,s.FD)("div",{style:{width:85,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.Y)(Gr,{ref:t,isActive:r.isSwitchButtonSelected,title:a({id:"aui.switch"}),isDisabled:Boolean(r.title)||!Ae(r.widget)||u,tooltip:r.title??(!Ae(r.widget)||u?a({id:"aui.dataVisualization.switchDisabled"},{nameOfTargetWidgetPlugin:p,nameOfSelectedWidget:a({id:`aui.plugins.widget.${r.selectedWidgetKey}.key`}),reason:u?"alreadySelected":"nonDataVisualization"}):"Enter")}),(0,s.Y)(Gr,{ref:e,widget:r.widget,title:a({id:"aui.add"},{contentType:"other"}),handleClick:r.handleWidgetAddedToPage,isActive:!r.isSwitchButtonSelected,tooltip:(Vr.P?"Cmd":"Ctrl")+" + Enter"})]}),u&&!r.isCollapsed&&(0,s.Y)(Ur.A,{style:{color:i.primaryColor,paddingLeft:5}})]})]})})})})},Qr=({direction:e,onClick:t})=>{const r=(0,v.DP)();return(0,s.Y)("div",{className:`scroll-arrow-${e}`,css:i.css`
        position: absolute;
        top: ${"top"===e?"0px":"auto"};
        bottom: ${"bottom"===e?"0px":"auto"};
        width: 49px;
        height: 30px;
        background-color: ${r.white};
        box-shadow: 0 0 3px ${r.grayScale[5]};
        border-radius: ${"top"===e?"0px 0px 4px 4px":"4px 4px 0px 0px"};
        display: none;
        align-items: center;
        justify-content: center;
      `,onClick:()=>t(e),children:"top"===e?(0,s.Y)(Er,{style:{fontSize:14}}):(0,s.Y)(W.A,{style:{fontSize:14}})})},Jr=({isCollapsed:e})=>{const t=(0,v.DP)(),{formatMessage:r,locale:a}=(0,w.useIntl)(),l=(0,n.useRef)(null),u=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,Yr.d4)(Tr.wW),g=(0,Or.R)(),m=(0,o.useWidgetPluginKeys)(),f=(0,o.useWidgetPlugins)(m),b=(0,Yr.wA)(),x=(0,Yr.d4)((e=>(0,Kr.L)(e,g))),[S,C]=(0,n.useState)(),[M,N]=(0,n.useState)(!0),{height:D}=(0,d.useDebouncedComponentSize)(l),[Y,T]=(0,n.useState)({top:!1,bottom:!1}),[O,K]=(0,n.useState)(),I=(0,n.useCallback)((()=>{if(!l.current)return;const{scrollTop:e,scrollHeight:t}=l.current,r=t>D;T({top:r&&e>0,bottom:r&&e<t-D})}),[l,D]);(0,n.useEffect)((()=>{I()}),[I]);const F=void 0===g||void 0===x?void 0:`${g}/${x}`,P=h&&void 0!==g&&void 0!==x?h.pages[g].content[x]:void 0,{widgetKey:L}=P||{},$=(0,n.useMemo)((()=>L?f.find((({key:e})=>e===L)):null),[L,f]),W=$&&qe(P,$)&&P.switchedTo||L,E=(0,n.useMemo)((()=>P&&$&&Ae($)?P.mapping:null),[P,$]),R=Ie({queryId:F,widgetState:P}),A=(0,n.useMemo)((()=>{const e=[];return Object.values(f).forEach((t=>{const r=void 0!==t.lazyLoading;if(null!==E&&$&&Ae($)&&Ae(t)&&(!R||r)){const{status:r,maxNumberOfFields:i}=Be(E,$.attributes,t),n="ok"!==r;e.push({...t,isSwitchDisabled:n,...n&&{maxNumberOfFields:i,disabledType:"tooManyNumeric"===r?"numeric":"ordinal"}})}else e.push({...t,isSwitchDisabled:!0})})),e}),[$,f,E,R]),q=e=>{P&&!e.isSwitchDisabled&&(e=>{if(h&&void 0!==g&&void 0!==x){const t=(0,c.produce)(h,(t=>{(0,B.set)(t,["pages",g,"content",x],e)}));b({type:"dashboardUpdated",dashboardState:t})}})((0,c.produce)(P,(t=>{e.key===t.widgetKey?Reflect.deleteProperty(t,"switchedTo"):t.switchedTo=e.key})))},V=(0,n.useMemo)((()=>S?(0,qr.$)(A,S,{keys:[`translations.${a}.key`],threshold:.4}):void 0),[S,A,a]);(0,n.useLayoutEffect)((()=>{K(void 0)}),[V,W,A]);const j=(0,n.useCallback)((e=>{if(h&&g&&x){const t=(0,y.W)(h,g);if(t){const r=(0,Ir.U)(t.layout,x),i=(0,Fr.QD)({dashboardState:h,initialWidgetState:e.initialState,layoutPath:r,pageKey:g,side:"left"}),n=`${(0,Pr.U)(t.layout)+1}`;b({type:"dashboardUpdated",dashboardState:i,newSelectedWidget:{leafKey:n,pageKey:g}})}}}),[h,g,x,b]),z=e=>{l.current&&l.current.scrollTo({top:l.current.scrollTop+("top"===e?-1:1)*D,behavior:"smooth"})};return(0,s.FD)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},onKeyDown:t=>{const r=V??A;if("ArrowDown"===t.key||"ArrowUp"===t.key){const e=(({activeRowIndex:e,key:t,optionsLength:r})=>"ArrowDown"===t&&e<r?e+1:"ArrowUp"===t&&e>0?e-1:e)({activeRowIndex:void 0!==O?O:r.findIndex((e=>e.key===W)),key:t.key,optionsLength:r.length-1});e!==O&&K(e)}if("Enter"===t.key&&void 0!==O){const e=(V??A)[O];e&&(M&&!t[Vr.P?"metaKey":"ctrlKey"]?e.key!==W&&q(e):j(e))}!e&&"ArrowRight"===t.key&&M&&N(!1),e||"ArrowLeft"!==t.key||M||N(!0)},css:i.css`
        :hover {
          .scroll-arrow-top {
            display: ${Y.top&&e?"flex":"none"};
          }
          .scroll-arrow-bottom {
            display: ${Y.bottom&&e?"flex":"none"};
          }
        }
      `,children:[(0,s.Y)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:6,height:32,flexShrink:0},children:(0,s.Y)(k.Input,{autoFocus:!0,allowClear:!0,value:S,onChange:e=>{C(e.target.value)},prefix:e?(0,s.Y)("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:22},children:(0,s.Y)(Rr.A,{})}):(0,s.Y)(Rr.A,{}),placeholder:r({id:"aui.search.widget"}),style:{height:20,borderRadius:e?8:2,fontSize:11}})}),(0,s.Y)("div",{css:{position:"relative",flexGrow:1,overflow:"hidden"},children:(0,s.FD)("div",{ref:l,className:e?"aui-invisible-scrollbars":"",style:{display:"flex",flexDirection:"column",borderTop:`1px solid ${t.grayScale[4]}`,outline:"none",overflow:"auto",height:"100%"},tabIndex:0,onClick:e=>{e.stopPropagation()},onScroll:I,onBlur:e=>{e.relatedTarget?.contains(p.current)||e.relatedTarget?.contains(u.current)?l.current?.focus():K(void 0)},children:[(0,s.Y)(Qr,{direction:"top",onClick:z}),(0,s.Y)(Qr,{direction:"bottom",onClick:z}),(V??A).map(((r,i)=>{const n=(V??A)[i+1],a=!n||["category","subCategory"].some((e=>r[e]!==n[e]));return(0,s.Y)(Hr,{widgetAddButtonRef:p,widgetSwitchButtonRef:u,style:{borderBottom:a?`1px solid ${t.grayScale[4]}`:void 0},onClick:()=>{q(r)},widget:r,handleWidgetAddedToPage:j,isCollapsed:e,searchValue:S,isActive:O===i,selectedWidgetKey:W,isSwitchButtonSelected:M,title:void 0!==P&&Ae(r)&&r.isSwitchDisabled?(0,s.Y)(Sr,{isQueryLazyLoaded:R,selectedWidgetState:P,widgetOption:r}):void 0},r.key)}))]})}),(0,s.Y)("div",{onClick:e=>{b({type:"widgetPanelClosed"}),e.stopPropagation()},style:{borderTop:`1px solid ${t.grayScale[4]}`,width:"100%",height:40,backgroundColor:t.grayScale[1],cursor:"pointer",flexShrink:0},children:(0,s.Y)(d.Tooltip,{trigger:["hover"],placement:"top",title:r({id:"aui.hideWidgets"}),children:(0,s.Y)("div",{css:i.css`
              height: 28px;
              width: 40px;
              border-radius: 2px;
              margin: 4px 0px 0px calc(100% - 45px);
              background-color: ${t.grayScale[1]};
              :hover {
                background-color: ${t.grayScale[5]};
              }
              display: flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
            `,children:(0,s.Y)(Ar,{rotate:90,style:{fontSize:16}})})})})]})};function Xr(e){const{error:t,onLoaded:r}=e,i=(0,Bt.d5)();(0,n.useEffect)((()=>{r?.()}),[r]);const{formatMessage:a}=(0,w.useIntl)();let o,l,c=t.message??t.stack,u="error";return(t instanceof se.N||t instanceof h.d)&&Object.values(i).some((e=>e.isDataModelLoading))?(u="info",c=a({id:"aui.dataVisualization.loadingDataModels"})):t instanceof se.N&&(o=b.IconCubeError,c=a({id:"aui.error.cubeNotFoundMessage"},{cubeName:t.cubeName}),l=a({id:"aui.error.cubeNotFound"})),(0,s.Y)(d.ErrorPlaceholder,{Icon:o,title:l,message:c,type:u})}function Zr(e){if(!(e.error instanceof Oe.QueryError))throw e.error;return(0,s.Y)(Xr,{...e})}function ei(e){const t=t=>(0,s.Y)(u.ErrorBoundary,{fallbackRender:e=>(0,s.Y)(Zr,{...e,...t}),resetKeys:[t.queryResult],children:(0,s.Y)(e,{...t})});return t.displayName=`withWidgetQueryErrorBoundary(${e.displayName})`,t}function ti(e,t){const r=e.findIndex((({key:e})=>e===t.key));-1===r?e.push(t):e[r]=t}var ri=r(74113);const ii="\nposition: absolute;\nborder-radius: 2px;\nheight: 3px;\nz-index: 2;\n",ni=()=>{const e=(0,v.DP)();return(0,s.Y)("div",{css:i.css`
        ${ii}
        width: calc(100% - 4px);
        background-color: ${e.isDark?e.grayScale[5]:"#f5f9ff"};
      `,children:(0,s.Y)("div",{css:i.css`
          ${ii}
          background-color: ${(0,ri.j)(e.primaryColor,.5)};
          animation: loadingBar 0.9s linear infinite;
          @keyframes loadingBar {
            0% {
              left: 0%;
              right: 100%;
              width: 0%;
            }
            50% {
              left: 0%;
              right: 0%;
              width: 100%;
            }

            100% {
              left: 100%;
              right: 0%;
              width: 0%;
            }
          }
        `})})},ai=700;function oi(e){const t=(0,n.forwardRef)(((t,r)=>{const[i,a]=(0,n.useState)(!1),{queryId:o,widgetState:l}=t,d=Z(l)?l.serverKey:void 0,c=(0,Ke.J)({queryId:o,serverKey:d});return(0,n.useEffect)((()=>{if(c.isLoading){const e=setTimeout((()=>{a(!0)}),ai);return()=>{clearTimeout(e)}}a(!1)}),[c.isLoading]),(0,s.FD)(s.FK,{children:[i&&(0,s.Y)(ni,{}),(0,s.Y)(e,{ref:r,...t})]})}));return t.displayName=`withWidgetLoadingBar(${e.displayName})`,t}function si(e){const t=t=>{const r=(0,n.useRef)((0,s.Y)("div",{}));return t.queryResult.isLoading||(r.current=(0,s.Y)(e,{...t})),r.current},r=e.displayName||e.name||"Unknown";return t.displayName=`withoutIrrelevantRenders(${r})`,t}function li(e){const t=t=>(0,s.Y)(Dr,{isLoading:t.queryResult.isLoading,style:{...t.style,height:"100%"},children:(0,s.Y)(e,{...t})}),r=e.displayName||e.name||"Unknown";return t.displayName=`withLoadingOverlay(${r})`,t}},92673:(e,t,r)=>{r.d(t,{A:()=>i});const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"}},20952:(e,t,r)=>{r.d(t,{A:()=>i});const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"}},83913:(e,t,r)=>{r.d(t,{A:()=>i});const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"}},71930:(e,t,r)=>{r.d(t,{A:()=>i});const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"}},74389:(e,t,r)=>{r.d(t,{FD:()=>s,FK:()=>a,Y:()=>o});var i=r(65723),n=r(42369),a=(r(93345),r(77619),r(4674),r(21880),r(48785),i.Fragment);function o(e,t,r){return n.h.call(t,"css")?i.jsx(n.E,(0,n.c)(e,t),r):i.jsx(e,t,r)}function s(e,t,r){return n.h.call(t,"css")?i.jsxs(n.E,(0,n.c)(e,t),r):i.jsxs(e,t,r)}},17628:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var i,n,a;if(Array.isArray(t)){if((i=t.length)!=r.length)return!1;for(n=i;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((i=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(n=i;0!=n--;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=i;0!=n--;){var o=a[n];if(!("_owner"===o&&t.$$typeof||e(t[o],r[o])))return!1}return!0}return t!=t&&r!=r}},62921:(e,t,r)=>{var i=r(93345),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var i,a={},d=null,c=null;for(i in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:n,type:e,key:d,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=d,t.jsxs=d},65723:(e,t,r)=>{e.exports=r(62921)}}]);