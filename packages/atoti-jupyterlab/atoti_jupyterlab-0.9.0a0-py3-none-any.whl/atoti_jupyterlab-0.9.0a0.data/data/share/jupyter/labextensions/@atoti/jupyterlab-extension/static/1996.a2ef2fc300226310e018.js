"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[1996],{51996:(e,t,r)=>{r.r(t),r.d(t,{DataModelLoadingError:()=>w,QueryError:()=>N,QueryTimeoutError:()=>L,addMissingTotalRows:()=>ee,createAtotiClient:()=>_,forEachCell:()=>Q,getAxisLength:()=>F,getCellSetMetaData:()=>A,getHierarchyIndicesInCellSet:()=>W,getMembersByHierarchy:()=>j,getMissingTotals:()=>X,getQueryTotalsMetaData:()=>de,getSortedTupleKey:()=>K,getTuple:()=>O,getTupleCaption:()=>G,getTupleKey:()=>B,getVisibleCubeDrillthroughColumns:()=>D,isCellSet:()=>y,isErrorInQueryResultOfType:()=>R,isTotal:()=>V,isTupleExpanded:()=>Y,trimTrailingTotals:()=>J});var s=r(4749),a=r(7961),i=r(44898);class n extends a.d{_unsafeWebSocket;pingPeriod;pingIntervalId;webSocketUrl;constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:s,pingPeriod:a}){super({url:e,serverVersion:t,serviceVersion:r,requestInit:s}),this.pingPeriod=a||6e4,this.webSocketUrl=((e,t)=>{const[r,s]=e.split("://"),{wsPath:a}=t;return"https"===r?`wss://${s}${a}`:`ws://${s}${a}`})(e,r)}get webSocket(){if(!this._unsafeWebSocket)throw new Error("The WebSocket connection has not been established yet.");return this._unsafeWebSocket}async ping(e){await(0,i.h)(this.url,this.serviceVersion,{...this.requestInit,...e})}async openWebSocket(){this._unsafeWebSocket||(await this.ping({credentials:"include"}),this.pingIntervalId=window.setInterval((()=>{this.ping({credentials:"include"})}),this.pingPeriod),this._unsafeWebSocket=new WebSocket(this.webSocketUrl))}closeWebSocket(){this._unsafeWebSocket&&(this._unsafeWebSocket.readyState!==WebSocket.CLOSED&&this._unsafeWebSocket.close(),this._unsafeWebSocket=void 0),this.pingIntervalId&&clearInterval(this.pingIntervalId)}}var o=r(64740),c=r(4181),u=r(39166),l=r(89801),d=r(84028),h=r(59621),m=r(49640),b=r(90147),p=r(31529),g=r(61051);function y(e){return"cells"in e}function f(e){return"success"===e.status}class v extends Error{queryId;constructor(e){super(`No query exists for id: "${e}".`),this.queryId=e}}const S={connectionStatus:"disconnected",connectionStatusSubscribers:[],dataModelSubscribers:[],isDataModelLoading:!1,calculatedMembers:{},calculatedMembersSubscribers:{},drillthroughColumns:{},drillthroughColumnsSubscribers:{},nextQueryId:0,_map:{}};class w extends Error{serverUrl;constructor(e,t){super(`Could not load the data model from ${e}`,t),this.serverUrl=e}}var q=r(90857);async function M({url:e,pivotServiceVersion:t,requestInit:r,mdxDefinitionStatement:s,owners:a,readers:i}){await(0,q.K)(`${e}${t.restPath}/cube/configuration/execute`,{...r,method:"POST",headers:{"Content-Type":"application/json",...r?.headers},body:JSON.stringify({statement:s,owners:a,readers:i})})}var x=r(40253);async function C({cubeName:e,serverUrl:t,pivotServiceVersion:r,options:s}){const{restPath:a}=r;return(await(0,q.K)(`${t}${a}/cube/configuration/calculatedMembers/${e}`,s)).json()}async function k({serverUrl:e,pivotServiceVersion:t,options:r}){const{restPath:s}=t;return(await(0,q.K)(`${e}${s}/cube/discovery`,r)).json()}async function E({url:e,pivotServiceVersion:t,cubeName:r,requestInit:s}){const{restPath:a}=t;return(await(0,q.K)(`${e}${a}/cube/query/mdx/drillthroughheaders`,{...s,method:"POST",headers:{"Content-Type":"application/json",...s?.headers},body:`{"mdx": "DRILLTHROUGH SELECT FROM [${r}]"}`})).json()}function I(e,t){const r=e.name.identifiers[0];return r.value===t?e:(0,b.produce)(e,(e=>{e.name.identifiers.unshift({elementType:"Identifier",quoting:r.quoting,value:t})}))}class T extends n{state=S;constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:a,pingPeriod:i}){super({url:e,serverVersion:t,serviceVersion:r,requestInit:{...a,headers:{...a?.headers,"x-activeui-version":s.atotiUIVersion}},pingPeriod:i})}static create({url:e,serviceVersion:t,serverVersion:r,requestInit:s,pingPeriod:a}){const i=new T({url:e,serverVersion:r,serviceVersion:t,requestInit:s,pingPeriod:a});return i.connect(),i}async connect(){if("connected"===this.connectionStatus)return;const e=new Promise((e=>{const t=this.subscribeToConnectionStatus((()=>{e(),t()}))}));if("disconnected"===this.connectionStatus){this.dispatch({type:"webSocketOpening"});try{await this.openWebSocket(),this.webSocket.addEventListener("open",(()=>{this.dispatch({type:"webSocketOpened"})})),this.webSocket.addEventListener("message",(e=>{const t=JSON.parse(e.data);this.dispatch({type:"webSocketMessageReceived",message:t})})),this.webSocket.addEventListener("close",(()=>{this.disconnect()})),this.webSocket.addEventListener("error",(()=>{this.dispatch({type:"webSocketErrored"})}))}catch(e){if(this.disconnect(),e instanceof o.h)return;throw e}}return e}disconnect(){"disconnected"!==this.connectionStatus&&(this.closeWebSocket(),this.dispatch({type:"webSocketClosed"}))}dispatch(e){const[t,r]=function(e,t){const{state:r,sideEffects:s}=(0,b.produce)({state:e,sideEffects:[]},(({state:r,sideEffects:s})=>{switch(t.type){case"queryRegistered":{const{id:e,mdx:a,context:i,ranges:n,updateMode:o="once"}=t;if(void 0!==r._map[e]?.query)throw new Error(`Cannot register a query for id: "${e}", because a query is already registered with this id.`);const c=r.nextQueryId.toString();r.nextQueryId+=1;const u=r._map[e]?.querySubscribers??[],l=r._map[e]?.queryResultSubscribers??[],d={mdx:a,context:i,ranges:n,updateMode:o};return r._map[e]={queryVersion:c,queryResult:{isLoading:!0},query:d,querySubscribers:u,queryResultSubscribers:l},void s.push({type:"webSocketSendMessage",message:{action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:c,mdxQuery:{mdx:a,context:i},ranges:n}}})}case"queryUpdated":{const{id:a,mdx:i,context:n,ranges:o,updateMode:c}=t,u=e._map[a]?.query,l=r._map[a]?.query;if(!u||!l)throw new v(a);const d=i&&(u.mdx!==i||!(0,p.isEqual)(u.context,n)),h=o&&!(0,p.isEqual)(u.ranges,o),m=c&&u.updateMode!==c;if(!d&&!h&&!m)return;const b=e._map[a].queryForCurrentResult?.mdx===i&&(0,p.isEqual)(e._map[a].queryForCurrentResult?.context,n)&&(0,p.isEqual)(e._map[a].queryForCurrentResult?.ranges,o);if(d||h)if(b)r._map[a].queryResult.isLoading=!1,r._map[a].query=e._map[a].queryForCurrentResult,r._map[a].queryVersion=e._map[a].queryVersionForCurrentResult;else{const e=r.nextQueryId.toString();r.nextQueryId+=1,r._map[a].queryVersion=e,r._map[a].queryResult={...r._map[a].queryResult,isLoading:!0},i&&d?(l.mdx=i,l.context=n,o&&h&&(l.ranges=o),s.push({type:"webSocketSendMessage",message:{action:"UPDATE",data:{streamId:a,queryId:e,mdxQuery:{mdx:i,context:n},ranges:o}}})):o&&h&&(l.ranges=o,s.push({type:"webSocketSendMessage",message:{action:"RANGE_UPDATE",data:{streamId:a,queryId:e,ranges:o}}}))}if(c&&m){r._map[a].query.updateMode=c;const e="once"===c;s.push({type:"webSocketSendMessage",message:{action:e?"PAUSE":"RESUME",data:a}})}return}case"queryRefreshed":{const e=t.id,a=r._map[e]?.query;if(!a)throw new v(e);return r._map[e].queryResult.isLoading=!0,void s.push({type:"webSocketSendMessage",message:{action:"REFRESH",data:e}})}case"queryUnregistered":if(void 0!==r._map[t.id]){const e=r._map[t.id].query,a=r._map[t.id].querySubscribers,i=r._map[t.id].queryResultSubscribers;a&&a.length>0||i&&i.length>0?r._map[t.id]={querySubscribers:a,queryResultSubscribers:i}:Reflect.deleteProperty(r._map,t.id),void 0!==e&&s.push({type:"webSocketSendMessage",message:{action:"UNREGISTER",data:t.id}})}return;case"webSocketOpening":return void(r.connectionStatus="connecting");case"webSocketOpened":r.connectionStatus="connected";for(const e in r._map){const t=r._map[e].query;if(t){const a=r._map[e].queryVersion;if(void 0===a)throw new Error(`Query with id ${e} is defined in the client state, but has no associated query version.`);const{mdx:i,context:n,updateMode:o,ranges:c}=t,u={action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:a,mdxQuery:{mdx:i,context:n},ranges:c}};s.push({type:"webSocketSendMessage",message:u})}}return;case"webSocketClosed":case"webSocketErrored":return void(r.connectionStatus="disconnected");case"subscribedToConnectionStatus":return void r.connectionStatusSubscribers.push(t.callback);case"unsubscribedFromConnectionStatus":return void(0,p.pull)(r.connectionStatusSubscribers,t.callback);case"subscribedToQuery":return void 0===r._map[t.id]&&(r._map[t.id]={querySubscribers:[]}),void 0===r._map[t.id]?.querySubscribers&&(r._map[t.id].querySubscribers=[]),void r._map[t.id].querySubscribers.push(t.callback);case"subscribedToQueryResult":return void 0===r._map[t.id]&&(r._map[t.id]={queryResultSubscribers:[]}),void 0===r._map[t.id]?.queryResultSubscribers&&(r._map[t.id].queryResultSubscribers=[]),void r._map[t.id].queryResultSubscribers.push(t.callback);case"unsubscribedFromQuery":return void(0,p.pull)(r._map[t.id].querySubscribers,t.callback);case"unsubscribedFromQueryResult":return void(0,p.pull)(r._map[t.id].queryResultSubscribers,t.callback);case"webSocketMessageReceived":{const{message:s}=t;if(void 0===e._map[s.streamId]||s.queryId!==e._map[s.streamId].queryVersion)return;r._map[s.streamId].queryForCurrentResult=e._map[s.streamId].query,r._map[s.streamId].queryVersionForCurrentResult=e._map[s.streamId].queryVersion;const a={isLoading:!1};return f(s)?(a.data=function(e,t){if(f(t))switch(t.type){case"cellData":if(void 0===e)throw new Error("Should have existing data to update.");if(!y(e))throw new Error("Received a Cellset update from Atoti Server about a query whose last result was a DrillthroughResult. This is not supported.");return(0,b.produce)(e,(e=>{e.epoch=t.data.epoch;const r=new Map;e.cells.forEach((({ordinal:e},t)=>{r.set(e,t)}));let s=!1;t.data.cells.forEach((t=>{const a=r.get(t.ordinal);void 0===a?(e.cells.push(t),s=!0):e.cells[a]=t})),s&&(e.cells=(0,p.sortBy)(e.cells,"ordinal"))}));case"drillthroughUpdateData":if(void 0===e)throw new Error("Received a Drillthrough update from Atoti Server about a query without a prior full drillthrough result. This is not supported.");if(y(e))throw new Error("Received a Drillthrough update from Atoti Server about a query whose last result was a Cellset. This is not supported.");return(0,b.produce)(e,(e=>{e.epoch=t.data.epoch;const{addedOrUpdatedRows:r,removedRows:s}=t.data;if(r&&(0,g.u)(r).forEach((t=>{e.result.rows[t]=r[t]})),s){s.sort();for(let t=s.length-1;t>=0;t--)e.result.rows.splice(s[t],1)}}));case"cellSetData":return{...t.data,cells:(0,p.sortBy)(t.data.cells,"ordinal")};case"drillthroughData":return t.data;default:throw new Error(`Unexpected Atoti Server client message type: "${t.type}". Valid types are ["cellData", "drillthroughUpdateData", "cellSetData", "drillthroughData"]`)}}(e._map[s.streamId].queryResult.data,s),a.error=void 0):a.error=s.error,void(r._map[s.streamId].queryResult=a)}case"dataModelLoadingStarted":r.isDataModelLoading=!0;break;case"dataModelLoadingErrored":r.isDataModelLoading=!1,r.dataModelLoadingError=t.error,r.dataModel=void 0;break;case"dataModelLoaded":r.isDataModelLoading=!1,r.dataModel=t.dataModel,r.dataModelLoadingError=void 0;break;case"subscribedToDataModel":r.dataModelSubscribers.push(t.callback);break;case"unsubscribedFromDataModel":(0,p.pull)(r.dataModelSubscribers,t.callback);break;case"drillthroughColumnsLoading":(0,p.set)(r,["drillthroughColumns",t.cubeName,"isLoading"],!0);break;case"drillthroughColumnsLoaded":r.drillthroughColumns[t.cubeName]={isLoading:!1,drillthroughColumns:t.drillthroughColumns,error:t.error};break;case"subscribedToDrillthroughColumns":t.cubeName in r.drillthroughColumnsSubscribers||(r.drillthroughColumnsSubscribers[t.cubeName]=[]),r.drillthroughColumnsSubscribers[t.cubeName].push(t.callback);break;case"unsubscribedFromDrillthroughColumns":(0,p.pull)(r.drillthroughColumnsSubscribers[t.cubeName],t.callback);break;case"calculatedMembersLoading":(0,p.set)(r,["calculatedMembers",t.cubeName,"isLoading"],!0);break;case"calculatedMembersLoaded":r.calculatedMembers[t.cubeName]={isLoading:!1,calculatedMembers:t.calculatedMembers,error:t.error};break;case"subscribedToCalculatedMembers":t.cubeName in r.calculatedMembersSubscribers||(r.calculatedMembersSubscribers[t.cubeName]=[]),r.calculatedMembersSubscribers[t.cubeName].push(t.callback);break;case"unsubscribedFromCalculatedMembers":(0,p.pull)(r.calculatedMembersSubscribers[t.cubeName],t.callback);break;default:throw new Error(`Unexpected Atoti Server client reducer event type: "${t.type}". Valid types are ["queryRegistered", "queryUpdated", "queryRefreshed", "queryUnregistered", "webSocketOpening", "webSocketOpened", "webSocketClosed", "webSocketErrored", "subscribedToQuery", "unsubscribedFromQuery", "subscribedToQueryResult", "unsubscribedFromQueryResult", "subscribedToConnectionStatus", "unsubscribedFromConnectionStatus", "webSocketMessageReceived", "dataModelLoadingStarted", "dataModelLoaded", "subscribedToDataModel", "unsubscribedFromDataModel", "drillthroughColumnsLoaded", "subscribedToDrillthroughColumns", "unsubscribedFromDrillthroughColumns", "calculatedMembersLoaded", "subscribedToCalculatedMembers", "unsubscribedFromCalculatedMembers"]`)}}));return[r,s]}(this.state,e);r.forEach((e=>{if("webSocketSendMessage"!==e.type)throw new Error(`Unexpected Atoti client sideEffect type: ${e.type}. Valid types are ["webSocketSendMessage"]`);"connected"===t.connectionStatus&&this.webSocket.send(JSON.stringify(e.message))}));const s=this.state._map,a=this.connectionStatus,i=this.isDataModelLoading,n=this.dataModel,o=this.dataModelLoadingError,c=this.state.calculatedMembers,u=this.state.drillthroughColumns;this.state=t;for(const e in t._map){const{query:t,queryResult:r,querySubscribers:a,queryResultSubscribers:i}=this.state._map[e]||{},{query:n,queryResult:o}=s[e]||{};t!==n&&a?.forEach((e=>{e()})),r!==o&&i?.forEach((e=>{e()}))}this.connectionStatus!==a&&t.connectionStatusSubscribers.forEach((e=>{e()})),this.isDataModelLoading===i&&this.dataModel===n&&this.dataModelLoadingError===o||t.dataModelSubscribers.forEach((e=>{e()}));for(const e in this.state.drillthroughColumns){const t=this.state.drillthroughColumns[e],r=u[e],{drillthroughColumns:s,isLoading:a}=t;s===r?.drillthroughColumns&&a===r?.isLoading||this.state.drillthroughColumnsSubscribers[e]?.forEach((e=>{e()}))}for(const e in this.state.calculatedMembers){const t=this.state.calculatedMembers[e],r=c[e],{calculatedMembers:s,isLoading:a}=t;s===r?.calculatedMembers&&a===r?.isLoading||this.state.calculatedMembersSubscribers[e]?.forEach((e=>{e()}))}}register(e,t){this.dispatch({type:"queryRegistered",id:e,...t})}update(e,t){this.dispatch({type:"queryUpdated",id:e,...t})}setQuery(e,t){void 0!==this.state._map[e]?.query?this.update(e,t):this.register(e,t)}get connectionStatus(){return this.state.connectionStatus}subscribeToConnectionStatus(e){return this.dispatch({type:"subscribedToConnectionStatus",callback:e}),()=>{this.dispatch({type:"unsubscribedFromConnectionStatus",callback:e})}}getQuery(e){return this.state._map[e]?.query}subscribeToQuery(e,t){return this.dispatch({type:"subscribedToQuery",id:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromQuery",id:e,callback:t})}}getQueryResult(e){return this.state._map[e]?.queryResult}subscribeToQueryResult(e,t){return this.dispatch({type:"subscribedToQueryResult",id:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromQueryResult",id:e,callback:t}),0===this.state._map[e].queryResultSubscribers?.length&&this.dispatch({type:"queryUnregistered",id:e})}}refreshQuery(e){this.dispatch({type:"queryRefreshed",id:e})}async loadDataModel({signal:e}={}){this.dispatch({type:"dataModelLoadingStarted"});try{const t=await async function(e){switch((0,x.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await k(e)).data}(e);default:return k(e)}}({serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:e}}),r=(0,c.v)(t);this.__UNSAFE_setDataModel__(r)}catch(e){this.__UNSAFE_setDataModel__(void 0,new w(this.url,{cause:e}))}}get dataModel(){return this.state.dataModel}get isDataModelLoading(){return this.state.isDataModelLoading}get dataModelLoadingError(){return this.state.dataModelLoadingError}get drillthroughColumns(){return this.state.drillthroughColumns}get calculatedMembers(){return this.state.calculatedMembers}__UNSAFE_setDataModel__(e,t){e?this.dispatch({type:"dataModelLoaded",dataModel:e}):t&&this.dispatch({type:"dataModelLoadingErrored",error:t})}subscribeToDataModel(e){return this.dispatch({type:"subscribedToDataModel",callback:e}),()=>{this.dispatch({type:"unsubscribedFromDataModel",callback:e})}}async loadDrillthroughColumns(e,{signal:t}={}){const r=this.state.drillthroughColumns[e];if(r&&r.isLoading)return;let s,a;this.dispatch({type:"drillthroughColumnsLoading",cubeName:e});try{a=await async function(e){switch((0,x.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await E(e)).data}(e);default:return E(e)}}({url:this.url,pivotServiceVersion:this.serviceVersion,cubeName:e,requestInit:{...this.requestInit,signal:t}})}catch(e){s=(0,m.$)(e),console.error(s)}this.dispatch({type:"drillthroughColumnsLoaded",cubeName:e,drillthroughColumns:a,error:s})}subscribeToDrillthroughColumns(e,t){return this.dispatch({type:"subscribedToDrillthroughColumns",cubeName:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromDrillthroughColumns",cubeName:e,callback:t})}}async loadCalculatedMembers(e,{signal:t}={}){const r=this.state.calculatedMembers[e];if(r&&r.isLoading)return;let s,a;this.dispatch({type:"calculatedMembersLoading",cubeName:e});try{a=await async function(e){switch((0,x.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await C(e)).data}(e);default:return C(e)}}({cubeName:e,serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:t}})}catch(e){s=(0,m.$)(e),console.error(s)}this.dispatch({type:"calculatedMembersLoaded",cubeName:e,calculatedMembers:a,error:s})}subscribeToCalculatedMembers(e,t){return this.dispatch({type:"subscribedToCalculatedMembers",cubeName:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromCalculatedMembers",cubeName:e,callback:t})}}async createCalculatedMember({formula:e,cubeName:t,owners:r,readers:s}){const a=I(e,t),i=`CREATE ${(0,l.A)(a)}`;await M({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:i,owners:r,readers:s}),await this.loadCalculatedMembers(t)}async deleteCalculatedMember({memberUniqueName:e,cubeName:t}){const r=(0,d._)(e),s=`DROP MEMBER ${r[0]===t?e:(0,h.hD)(t,...r)}`;await M({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:s}),await this.loadCalculatedMembers(t)}async updateCalculatedMember({formula:e,cubeName:t,owners:r,readers:s}){const a=I(e,t),i=`UPDATE ${(0,l.A)(a)}`;await M({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:i,owners:r,readers:s}),await this.loadCalculatedMembers(t)}async createKpi({kpi:e,cubeName:t,owners:r,readers:s}){let a=`CREATE KPI ${(0,h.hD)(t,e.name)} AS ${e.value}`;u.S.map((e=>e.slice(3))).forEach((t=>{const r=t;e[r]&&(a=`${a}, ${r.toUpperCase()}=${e[r]}`)})),await M({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:a,owners:r,readers:s})}async deleteKpi({kpiName:e,cubeName:t}){const r=`DROP KPI ${(0,h.hD)(t,e)}`;await M({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:r})}}function _({url:e,serverVersion:t,serviceVersion:r,requestInit:s,pingPeriod:a}){return T.create({url:e,serverVersion:t,serviceVersion:r,requestInit:s,pingPeriod:a})}class N extends Error{errorChain;stackTrace;constructor({errorChain:e,stackTrace:t}){const r=`${(0,p.map)(e,"message").join("\n")}\n${t}`;super(e[0].message,{cause:r}),this.errorChain=e,this.stackTrace=t}}class L extends N{}function R(e,t){return e.errorChain.some((e=>e.type===t))}function D(e,t,{signal:r}={}){const{drillthroughColumns:s,isLoading:a}=e.drillthroughColumns[t]??{};return!a&&s?Promise.resolve(s.filter((e=>e.visible))):new Promise(((s,a)=>{const i=e.subscribeToDrillthroughColumns(t,(()=>{const{drillthroughColumns:r,error:n,isLoading:o}=e.drillthroughColumns[t];o||(i(),n?a(n):s(r?.filter((e=>e.visible))))}));e.loadDrillthroughColumns(t,{signal:r}),r&&(r.onabort=()=>{i(),a(r.reason)})}))}function V(e,t){return!e.slicing&&1===t.namePath.length}var P=r(67737),U=r(46102),$=r(20428);const F=e=>{const{range:t}=e;return t&&!t.entireAxis?t.axisLength:e.positions.length};function A(e,t){const r=[],s={};let a,i=0;for(const s of e.axes){const e=[],n=Object.values(s.hierarchies);for(let r=0;r<n.length;r++){const{dimension:o,hierarchy:c}=n[r];if((0,P.t)(n[r]))a=s,i=r;else{const a=(0,U.q)({dimensionName:o,hierarchyName:c},t),i=Object.values(a.levels).slice(a.slicing?0:1,s.maxLevelPerHierarchy[r]).map((({name:e,index:t})=>({dimensionName:o,hierarchyName:c,levelName:e,hierarchyIndex:r,levelIndex:t})));e.push(...i)}}for(const{hierarchyIndex:t,levelIndex:a,...i}of e){const e=s.positions.every((e=>{if(a<e[t].namePath.length){const r=e[t].namePath[a];return!isNaN(r)}return!0}));r.push({...i,isNumeric:e})}}const n=e.axes.find((({id:e})=>e===$.U.columns));if(a&&n&&[$.U.rows,$.U.columns].includes(a.id)){const t=F(n);for(const r of e.cells){const e=Math.floor(r.ordinal/t),n=r.ordinal%t,o=(a.id===$.U.columns?n:e)-(a.range?.from??0),c=a.positions[o][i].namePath[0],u=!1!==s[c]?.isNumeric&&!isNaN(r.value);s[c]={isNumeric:u}}}return{levels:r,measures:Object.entries(s).map((([e,{isNumeric:t}])=>({measureName:e,isNumeric:t})))}}const W=(e,t)=>{const r={};return e.axes.forEach(((e,s)=>{-1!==e.id&&(void 0===t||0===e.id&&t.axisNames.includes("COLUMNS")||1===e.id&&t.axisNames.includes("ROWS"))&&e.hierarchies.forEach((({dimension:e,hierarchy:t},a)=>{r[(0,h.hD)(e,t)]={dimensionName:e,hierarchyName:t,axisIndex:s,hierarchyIndex:a}}))})),r},O=({columnIndex:e,data:t,hierarchyIndicesInCellSet:r,rowIndex:s})=>{const a=[];let i=!1;return Object.values(r).forEach((({dimensionName:r,hierarchyName:n,axisIndex:o,hierarchyIndex:c})=>{const u=t.axes[o],l=u.range?.from||0,d=(0===u.id?e:s)-l;u.positions[d]&&(i=!0,void 0!==u.positions[d][c]&&a.push({dimensionName:r,hierarchyName:n,...u.positions[d][c]}))})),i?a:null},Q=(e,t,r)=>{const[s,a]=[$.U.columns,$.U.rows].map((t=>{const r=e.axes.find((({id:e})=>e===t));return r?.positions.length??1}));let i=0;for(let n=0;n<a;n++)for(let a=0;a<s;a++){let o=null;const c=e.cells[i],u=n*s+a;c?.ordinal===u&&(i+=1,o=c),r({cell:o,cellIndex:o?i-1:null,columnIndex:a,tuple:O({columnIndex:a,data:e,hierarchyIndicesInCellSet:t,rowIndex:n}),rowIndex:n})}},j=e=>(0,p.zipWith)(...e.positions,((...e)=>(0,p.uniqBy)(e,(e=>(0,h.hD)(...e.namePath))))).map(((t,r)=>({axisId:e.id,hierarchy:e.hierarchies[r],members:t}))),H=e=>e.map((({dimensionName:e,hierarchyName:t,namePath:r})=>e===t&&(0,P.t)({dimensionName:e})?(0,h.hD)("Measures",r[0]):(0,h.hD)(e,t,...r))),B=e=>H(e).join(",")||"Total",K=e=>H(e.map((({dimensionName:e,hierarchyName:t,member:r})=>({dimensionName:e,hierarchyName:t,...r})))).sort().join(",")||"Total";function G(e,{cube:t,captionForTotals:r,separator:s=" ",hasOnlyCaptionForLeafLevels:a=!1}){if(0===e.length)return r;let i=!1;const n=(0,p.flatten)(e.map((({dimensionName:e,hierarchyName:r,...s})=>{if(void 0===s)return"";const n=s.namePath??s.path,o=s.captionPath;if((0,P.t)({dimensionName:e}))return o;const c=(0,U.q)({dimensionName:e,hierarchyName:r},t);return c.slicing||1!==n.length?a?o.at(-1):c.slicing?o:o.slice(1):(i=!0,[])})));return(i?[...n,r]:n).join(s)}var z=r(42710);function J(e,t,r){const s=(0,p.findLastIndex)(e,(e=>(0,P.t)(e)?!r?.doesConsiderMeasuresAsTotals:!V((0,U.q)(e,t),e)));return e.slice(0,s+1)}const Y=(e,{cube:t,expandedTuples:r})=>{if(0===e.length||0===r.length)return!1;const s=J(e,t);return r.some((e=>(0,z.w)(s,e.tupleCoordinates)))};function Z(e,{rowIndexOnScreen:t,rowIndexInData:r,numberOfMissingTotalRowsAbove:s}){if(e)for(let a=0;a<=s;a++)e[t+a]=r}const X=(e,t,{hierarchies:r,maxLevelPerHierarchy:s,cube:a})=>{const i=[];let[n,o]=((e,t,r)=>{if(!e)return[0,0];for(let s=0;s<r.length;s++)for(let a=0;a<r[s];a++){const r=e[s];if(t[s].namePath[a]!==r.namePath[a])return[s,a]}return[r.length-1,r.at(-1)??0]})(e,t,s);const c=((e,t)=>J(e,t).length)(t,a);for(;n<c;){const e=t[n];for(;o<e.namePath.length&&(n!==c-1||o!==e.namePath.length-1);){const r=[...t.slice(0,n),{...e,namePath:e.namePath.slice(0,o+1),captionPath:e.captionPath.slice(0,o+1)}],s=(0,P.t)(e)?null:(0,U.q)(e,a);s&&r.every((e=>V(s,e)))||i.push(r),o++}if(n++,n<r.length){const e=r[n];o=null===e||e.slicing?0:1}}return i};function ee(e,{cube:t,rowIndexMapping:r}){return t?(0,b.produce)(e,(s=>{const a=s.axes.find((({id:e})=>e===$.U.rows));if(!a)return;const i=a.range?.from??0,n=function(e,t){if(!t||0===e)return 0;let r=t.length-1,s=t[r];const a=e;for(;r>=0&&(s=t[r])&&s>a;)r-=s-a;return r+(e-s)}(i,r);let o=n-i;a.range&&n>0&&(a.range.from+=o,r&&r.length<a.range.from-1&&function(e,t){const r=e.length-1,s=r-e[r];let a=e.length-s;for(;e.length<t+s;)e.push(a),a++}(r,a.range.from));const c=a.hierarchies.map((({dimension:e,hierarchy:r})=>(0,P.t)({dimension:e})?null:(0,U.q)({dimensionName:e,hierarchyName:r},t))),u=[];let l=0,d=0;for(;l<a.positions.length;){const[e,s]=[l-1,l].map((e=>{if(-1!==e)return a.positions[e].map(((e,t)=>{const{dimension:r,hierarchy:s}=a.hierarchies[t];return{dimensionName:r,hierarchyName:s,...e}}))})),o=a.range&&a.range.from>0&&0===l?[]:X(e,s,{cube:t,hierarchies:c,maxLevelPerHierarchy:a.maxLevelPerHierarchy});if(a.positions.splice(l,0,...o),Z(r,{rowIndexInData:i+d,rowIndexOnScreen:n+l,numberOfMissingTotalRowsAbove:o.length}),o.length>0){const e=a.range?a.range.from:0;u.push(...(0,p.range)(e+l,e+l+o.length))}l+=o.length+1,d+=1}!function(e,t){if(!e||t>=e.length-1)return;let r=t;for(;e[r+1]>e[r]+1;)e.splice(r+1,0,e[r]+1),r++}(r,n+l-1);const h=e.axes.find((({id:e})=>e===$.U.columns)),m=h?h.positions.length:0;s.cells.forEach((e=>{const t=Math.floor(e.ordinal/m);for(;u.length>0&&t+o>=u[0];)o+=1,u.shift();e.ordinal+=o*m})),a.range&&(a.range.to+=o,a.range.axisLength+=o)})):e}var te=r(12893),re=r(73939),se=r(14141),ae=r(33601),ie=r(58563),ne=r(54235),oe=r(36824),ce=r(90414);function ue(e,{cube:t,levelCoordinates:r}){return(0,se.T)(e,(e=>{if(!(0,ce.k)(e,"Members")||!(0,oe.E)(e.arguments[0]))return!1;const s=(0,ne.t)(e.arguments[0],{cube:t});return"level"===s.type&&(0,te.M)(s,r)}))?.path}var le=r(34357);function de(e,{cube:t,hiddenGrandTotalsContextValue:r,hiddenSubTotalsContextValue:s}){const a={},i=r?r.split(","):[],n=(s?s.split(","):[]).map((e=>{const[t,r,s]=(0,d._)(e);return{dimensionName:t,hierarchyName:r,levelName:s}}));return e?.axes.forEach((e=>{const r=function(e,t){const r=(0,ae.l)(e,t),s=[],a=[],i=[];if(0===r.length&&-1!==(0,ie.n)(e))return{levelsWithToggleableTotals:s,levelsWithHiddenTotals:a,deepLevelsExpressedWithMembers:i,isGrandTotalHidden:!1,isGrandTotalToggleable:!1};let n=!0,o=!1,c=!1;for(let e=r.length-1;e>=0;e--){const{path:u,match:l,...d}=r[e];e===r.length-1||s.unshift(d),c&&a.unshift(d);const h=(0,U.q)(d,t),m=(0,re.Z)({...d,cube:t});if(m>0){const e=ue(l,{cube:t,levelCoordinates:d});if(void 0!==e){o=!0;const t=[...u,...e];i.unshift({...d,pathWithinAxis:t}),c=!0}}const b=Object.values(h.levels).slice(h.slicing?0:1,m).reverse();for(const e of b){const t={...d,levelName:e.name};s.unshift(t),c&&a.unshift(t)}if(h.slicing){n=!1,o=!0;break}}return{levelsWithToggleableTotals:(0,p.uniqWith)(s,te.M),levelsWithHiddenTotals:(0,p.uniqWith)(a,te.M),deepLevelsExpressedWithMembers:i,isGrandTotalToggleable:n,isGrandTotalHidden:o}}(e,t),s=r.isGrandTotalHidden||i.includes(String((0,le.x)(e.name))),o=(0,p.intersectionWith)(r.levelsWithToggleableTotals,[...r.levelsWithHiddenTotals,...n],te.M);a[e.name]={...r,isGrandTotalHidden:s,levelsWithHiddenTotals:o}})),a}},7961:(e,t,r)=>{r.d(t,{d:()=>s});class s{url;serverVersion;serviceVersion;requestInit;constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:s}){this.url=e,this.serviceVersion=r,this.serverVersion=t,this.requestInit=s}}},85440:(e,t,r)=>{r.d(t,{v:()=>s});class s extends Error{static status=400;response;constructor(e){const{url:t}=e;super(`400: Bad request error on: ${t||"unspecified URL"}.`),this.name="BadRequestError",this.response=e}}},34816:(e,t,r)=>{r.d(t,{H:()=>s});class s extends Error{static status=403;expirationDate;constructor(e){super(`Your license expired on ${e.toLocaleDateString()}. Please contact ActiveViam.`),this.name="ExpiredLicenseError",this.expirationDate=e}}},6457:(e,t,r)=>{r.d(t,{q:()=>s});class s extends Error{static status=403;response;constructor(e){const{url:t}=e;super(`403: Access to: ${t||"unspecified URL"} is forbidden.`),this.name="ForbiddenError",this.response=e}}},80986:(e,t,r)=>{r.d(t,{P:()=>s});class s extends Error{static status=500;response;constructor(e){const{url:t}=e;super(`500: Internal server error on: ${t||"unspecified URL"}.`),this.name="InternalServerError",this.response=e}}},64740:(e,t,r)=>{r.d(t,{h:()=>s});class s extends Error{url;constructor(e,t){super(`No response received from: ${e||"unspecified URL"}.`,t),this.name="NoResponseError",this.url=e}}},1877:(e,t,r)=>{r.d(t,{C:()=>s});class s extends Error{static status=404;response;constructor(e){const{url:t}=e;super(`404: The resource at ${t||"unspecified URL"} was not found.`),this.name="ResourceNotFoundError",this.response=e}}},26134:(e,t,r)=>{r.d(t,{D:()=>s});class s extends Error{static status=401;response;constructor(e){const{url:t}=e;super(`401: Not authorized to access: ${t||"unspecified URL"}.`),this.name="UnauthorizedError",this.response=e}}},90857:(e,t,r)=>{r.d(t,{K:()=>d});var s=r(49640),a=r(85440),i=r(34816),n=r(6457),o=r(80986),c=r(64740),u=r(1877),l=r(26134);async function d(e,t){try{const r=await fetch(e,t);switch(r.status){case 400:throw new a.v(r);case 401:throw new l.D(r);case 403:{let e;try{const t=await r.json(),s=(t.error?.errorChain??t.errorChain)[0];"ForbiddenAccessException"===s.type&&s.message.includes("license has expired")&&(e=new Date(s.message.slice(s.message.lastIndexOf("(")+1,s.message.lastIndexOf(")"))))}catch(e){}if(e)throw new i.H(e);throw new n.q(r)}case 404:throw new u.C(r);case 500:throw new o.P(r)}return r}catch(t){const r=(0,s.$)(t);throw"Failed to fetch"===r.message||"NetworkError when attempting to fetch resource."===r.message||"Load failed"===r.message?new c.h(e,{cause:r}):r}}},44898:(e,t,r)=>{r.d(t,{h:()=>a});var s=r(90857);async function a(e,t,r){const{restPath:a}=t;await(0,s.K)(`${e}${a}/ping`,r)}},8233:(e,t,r)=>{r.d(t,{L:()=>s});const s=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},39166:(e,t,r)=>{r.d(t,{S:()=>s});const s=r(8233).L.map((e=>e.toLowerCase()))},42710:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(7994);function a(e,t){return!(!e||!t)&&e.length===t.length&&e.every(((e,r)=>{const a=t[r];return(0,s.q)(e,a)&&e.namePath.length===a.namePath.length&&e.namePath.every(((e,t)=>e===a.namePath[t]))}))}},4181:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(31529);const a=e=>{const t=e.catalogs.map((e=>{const t=e.cubes.map((e=>(e=>{const t=e.dimensions.map((e=>{const t=e.hierarchies.map((e=>{const t=(0,s.keyBy)(e.levels.map(((e,t)=>({...e,index:t}))),"name");return{...e,levels:t}})),r=(0,s.keyBy)(t,"name");return{...e,hierarchies:r}})),{measures:r,kpis:a,sets:i,contextValues:n,measureGroups:o}=e;return{...e,dimensions:(0,s.keyBy)(t,"name"),measures:(0,s.keyBy)(r,"name"),kpis:(0,s.keyBy)(a,"name"),sets:(0,s.keyBy)(i,"name"),contextValues:(0,s.keyBy)(n,"name"),measureGroups:(0,s.keyBy)(o,"name")}})(e)));return{...e,cubes:(0,s.keyBy)(t,"name")}})),{contextValues:r}=e;return{catalogs:(0,s.keyBy)(t,"name"),contextValues:(0,s.keyBy)(r,"name")}}},34357:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(20428);function a(e){const t=e.toLocaleLowerCase();return s.U[t]}},98014:(e,t,r)=>{function s(e){return"measure"===e.type?e.measureName:e.identifiers[1].value}r.d(t,{_:()=>s})},58563:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(76174);function a(e){const t=(0,s.s)(e);if(0===t.length)return-1;if(t[0].length<2)return 0;const r=t[0].slice(t[0].length-2);return"arguments"===r[0]?r[1]:0}},76174:(e,t,r)=>{r.d(t,{s:()=>c});var s=r(51834),a=r(4740),i=r(41750),n=r(69879),o=r(80266);const c=e=>{const t=[];if((0,s.u)(e))for(let t=0;t<e.axes.length;t++){const r=c(e.axes[t]);if(r.length>0)return r.map((e=>["axes",t,...e]))}if((0,o.C)(e)){const r=e;(0,a.y)(r,((e,s)=>{if((0,n.D)(r,e,s)&&!t.some((e=>e.every(((e,t)=>s[t]===e))))){const{path:e}=(0,i.A)(r,s);t.push(e)}}))}return t}},69879:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(31529),a=r(69301),i=r(90414),n=r(80266);const o=(e,t,r)=>{if(!(0,a.r)(t))return!1;const o=(0,s.initial)(r),c=(0,s.initial)(o),u=o.length>0?(0,s.get)(e,o):e,l=c.length>0?(0,s.get)(e,c):void 0;return(0,n.C)(u)||(0,i.k)(l)&&("{}"===l.name||"crossjoin"===l.name.toLowerCase())}},69301:(e,t,r)=>{r.d(t,{r:()=>i});var s=r(98014),a=r(36824);const i=(e,{measureName:t}={})=>!(!(0,a.E)(e)||"measures"!==e.identifiers[0].value.toLowerCase()||void 0===e.identifiers[1]||void 0!==t&&(0,s._)(e)!==t)},61051:(e,t,r)=>{function s(e){return Object.keys(e)}r.d(t,{u:()=>s})}}]);