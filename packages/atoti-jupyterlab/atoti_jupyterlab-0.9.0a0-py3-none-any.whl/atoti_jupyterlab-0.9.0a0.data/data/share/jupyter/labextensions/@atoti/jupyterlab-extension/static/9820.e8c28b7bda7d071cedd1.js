"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[9820,5274],{12563:(e,o,t)=>{t.r(o),t.d(o,{default:()=>T});var n=t(74389),r=t(40570),a=t(93345),i=t(95889),s=t(82966),d=t(40491),l=t(89953),u=t(29892),m=t(31529),c=t(42405),g=t(34707),f=t(67737),p=t(62736);const b=e=>(e=>{const o=e.matchAll(/Member (?<calculatedMemberUniqueName>.*) AS/gim),t=new Set;for(const e of o){const o=e?.groups?.calculatedMemberUniqueName;o&&t.add(o)}return Array.from(t)})(e).map((e=>{const[{groups:o={}}={}]=e.matchAll(/(\[Measures]).(?:(\[(?<quotedMeasure>.*)\])|(?<unquotedMeasure>\w*))/gi);return o.unquotedMeasure??o.quotedMeasure})).filter(Boolean),A=(e,o,t=0)=>e.getValueInRange({startColumn:0,endColumn:o.column,startLineNumber:o.lineNumber-t,endLineNumber:o.lineNumber}),h=({label:e={label:""},insertText:o,kind:t=c.languages.CompletionItemKind.Constant,...n})=>({label:e,kind:t,insertText:void 0!==o?o:"string"==typeof e?e:e.label,range:void 0,...n}),M={getSuggestions:({position:e,textModel:o,cube:t,dataModel:n,formatMessage:r})=>{const a=A(o,e);if(a.toLowerCase().includes("from "))return[];const i=a.match(/\[[^\]]*\]?(?:\.(?:\[[^\]]*\]?|\w*))*$/gim)?.at(-1);if(!i)return[];const[s,d,l,u]=(i||"").split(".").map((e=>e.replace(/\[([^\]]*)\]?/,"$1"))),M=t?[t]:n?(0,g.X)(n):[];if((0,f.t)({dimensionName:s}))return(({cubes:e,textModel:o,formatMessage:t})=>[...(0,m.flatMap)(e,(({name:e,measures:o})=>Object.keys(o).map((o=>h({label:{label:o,description:e}}))))),...b(o.getValue()).map(((e="")=>h({label:{label:e,description:t({id:"aui.mdxEditor.autoCompletion.calculatedMeasure"})}})))])({cubes:M,textModel:o,formatMessage:r});if(void 0===d)return(e=>[h({kind:c.languages.CompletionItemKind.Unit,label:"Measures",preselect:!0}),...(0,m.flatMap)(e,(({name:e,dimensions:o})=>Object.keys(o).map((o=>h({label:{label:o,description:e}})))))])(M);if(void 0===l)return(({cubes:e,dimensionName:o})=>(0,m.flatMap)(e,(({name:e,dimensions:t})=>{const n=t[o]?.hierarchies??{};return Object.keys(n).map((t=>h({label:{label:t,description:`${e}/${o}`}})))})))({cubes:M,dimensionName:s});if(void 0===u)return(({cubes:e,dimensionName:o,hierarchyName:t})=>[h({label:{label:"AllMember",description:`${o}/${t}`},preselect:!0}),...(0,m.flatMap)(e,(({name:e,dimensions:n})=>{const r=n[o]?.hierarchies[t]?.levels??{};return Object.keys(r).map((n=>h({label:{label:n,description:`${e}/${o}/${t}`}})))}))])({cubes:M,dimensionName:s,hierarchyName:d});const k="ALL"===l?[h({label:{label:"AllMember",description:`${s}/${d}`},preselect:!0})]:[];return k.push(...p.mP.map((e=>h({label:e,kind:c.languages.CompletionItemKind.Property,sortText:"zzz"})))),k}},k={getSuggestions:({position:e,textModel:o,cube:t,dataModel:n})=>{if(null===A(o,e,1).match(new RegExp(`(${p.J6.join("|")})[(][^)]*`,"i")))return[];const r=t?[t]:n?(0,g.X)(n):[];return(0,m.flatMap)(r,(({name:e,kpis:o})=>Object.keys(o).map((o=>h({kind:c.languages.CompletionItemKind.Event,label:{label:o,description:e}})))))}},w={getSuggestions:({position:e,textModel:o})=>null!==A(o,e).match(/(\bON\b\s*)([\w]*)$/i)?p.GI.map((e=>h({label:e}))):[]},x={getSuggestions:({position:e,textModel:o,cube:t,dataModel:n})=>{const r=A(o,e).match(/(FROM\s+)(\[)([^\]]*)(?<CB>\])*/i);return null!==r&&void 0===r.groups?.CB?(t?[t]:n?(0,g.X)(n):[]).map((({name:e})=>h({kind:c.languages.CompletionItemKind.Interface,label:e}))):[]}},y=({position:e,textModel:o,cube:t,dataModel:n,formatMessage:r})=>{const a=(0,m.flatMap)([x,w,M,k],(({getSuggestions:a})=>a({position:e,textModel:o,cube:t,dataModel:n,formatMessage:r})));return a.length>0?a:[...[...p.fj,...p.J6,...p.mP,...p.c2].map((e=>h({kind:c.languages.CompletionItemKind.Function,label:e}))),...[...p.GI].map((e=>h({kind:c.languages.CompletionItemKind.EnumMember,label:e}))),...[...p.B9,...p.P4].map((e=>h({kind:c.languages.CompletionItemKind.Operator,label:e}))),...[...p._v,...p.CY].map((e=>h({kind:c.languages.CompletionItemKind.Keyword,label:e})))]},v={id:"dark-theme",data:{base:"vs-dark",inherit:!0,rules:[{token:"identifier.delimited",foreground:"#9f9f9f"},{token:"identifier.regular",foreground:"#9d9d9d"},{token:"keyword.structural",foreground:"#c792ea"},{token:"keyword.axis",foreground:"#c792ea"},{token:"keyword.function",foreground:"#82aaff"},{token:"keyword.kpi",foreground:"#82aaff"},{token:"keyword.memberProperty",foreground:"#82aaff"},{token:"keyword.argument",foreground:"#addb67"},{token:"keyword.booleanOperator",foreground:"#397800"},{token:"keyword.cellProperty",foreground:"#397800"},{token:"boolean",foreground:"#addb67"},{token:"number",foreground:"#ff901e"},{token:"operator",foreground:"#ff8000"},{token:"comment",foreground:"#aa5500"}],colors:{"editor.background":"#373b3d"}}},C=e=>(0,m.flatMap)(e,(e=>Object.values(e.measures))),N=e=>(0,m.flatMap)(e,(e=>Object.values(e.dimensions))),$=(e,o)=>{const t=e.find((e=>e.dimensions[o])),n=t?.dimensions[o];return n?Object.values(n.hierarchies):[]},I="#faad14",E=({classNames:e={},textModel:o,offset:t,options:n={},length:r,type:a})=>{const i={error:{color:"red",className:e.line_error,position:4,zIndex:10},warning:{color:I,className:e.line_warning,position:1,zIndex:1}};return{range:c.Range.fromPositions(o.getPositionAt(t),o.getPositionAt(t+r)),options:{overviewRuler:{color:i[a].color,position:i[a].position},inlineClassName:i[a].className,zIndex:i[a].zIndex,...n}}},K=(e="",o=[])=>o.reduce(((o,t)=>{const n=((e="",o="")=>{if(e.length<2||o.length<2)return 0;const t=new Map;for(let o=0;o<e.length-1;o++){const n=e.substr(o,2);t.set(n,t.get(n)??1)}let n=0;for(let e=0;e<o.length-1;e++){const r=o.substr(e,2),a=t.get(r)??0;a>0&&(t.set(r,a-1),n++)}return 2*n/(e.length+o.length-2)})(t,e);return o.coefficient<n?{hint:t,coefficient:n}:o}),{hint:"",coefficient:0}),R=({header:e="",body:o="",hint:t={coefficient:0,hint:""},formatMessage:n=(()=>"")})=>{const r=[{value:`#### **${e}**`}];return t.coefficient>.65&&r.push({value:`${n({id:"aui.mdxEditor.hover.didYouMean"})}: ***${t.hint}?***`,isTrusted:!0}),r.push({value:o}),r},P={getDecorations:({textModel:e,mdxErrorDetails:o,classNames:t,formatMessage:n=(()=>"")})=>{if(!o)return[];const r=((e,o)=>{const t=c.editor.createModel(e);try{if(o.from.ch>=0){const e=t.getValueInRange(new c.Range(o.from.line+1,o.from.ch,o.to.line+1,t.getLineLastNonWhitespaceColumn(o.to.line+1))),n=e.length-e.trimLeft().length;return new c.Range(o.from.line+1,o.from.ch+n,o.to.line+1,o.to.ch+n)}return new c.Range(o.from.line,t.getLineLastNonWhitespaceColumn(o.from.line),o.to.line+1,t.getLineFirstNonWhitespaceColumn(o.to.line+1)+o.text.length)}catch{return new c.Range(0,0,0,0)}})(e.getValue(),o),a=e.getOffsetAt(r.getStartPosition());return[E({type:"error",classNames:t,textModel:e,offset:a,length:e.getOffsetAt(r.getEndPosition())-a,options:{hoverMessage:R({header:`${n({id:"aui.mdxEditor.hover.errorOnLine"})} ***${r.startLineNumber}***`,body:`${n({id:"aui.mdxEditor.hover.availableOptionsAre"})} : \n${o.expected?.map((e=>`- ${e}`)).join("\n")}`,hint:K(o.text,o.expected?.map((e=>e.replace(/'/g,"")))),formatMessage:n})}})]}},L={getDecorations:({textModel:e,classNames:o,formatMessage:t=(()=>"")})=>{const n=e.getValue().matchAll(/(?<function>\w+)\(/gi),r=[...p.fj,...p.J6],a=[];for(const i of n)i.index&&!["FROM",...r].map((e=>e.toLowerCase())).includes((i.groups?.function??"").toLowerCase())&&a.push(E({type:"warning",classNames:o,textModel:e,offset:i.index,length:i[0]?.length,options:{hoverMessage:R({header:`${t({id:"aui.mdxEditor.hover.unknownFunction"})} ***${i.groups?.function}***`,body:`${t({id:"aui.mdxEditor.hover.availableFunctionsAre"})} : \n${r.map((e=>`- ${e}`)).join("\n")}`,hint:K(i.groups?.function,r),formatMessage:t})}}));return a}},S={getDecorations:({textModel:e,cube:o,dataModel:t,classNames:n,formatMessage:r=(()=>"")})=>{if(!t&&!o)return[];const a=e.getValue().matchAll(/(?:FROM\s+)(?:([(])|\[([^\]]*)\]?|(\w*))/gi),i=o?[o.name]:t?(0,g.X)(t).map((({name:e})=>e)):[],s=[];for(const o of a){if("("===o[1])continue;const t=o[2]??o[3];o.index&&!i.includes(t)&&s.push(E({type:"error",classNames:n,textModel:e,offset:o.index,length:o[0]?.length,options:{hoverMessage:R({header:`${r({id:"aui.error.cubeNotFound"})} ***${t}***`,body:`${r({id:"aui.mdxEditor.hover.availableCubesAre"})} : \n${i.map((e=>`- ${e}`)).join("\n")}`,hint:K(t,i),formatMessage:r})}}))}return s}},j={getDecorations:({textModel:e,cube:o,dataModel:t,classNames:n,isCaseSensitive:r,formatMessage:a=(()=>"")})=>{if(!t&&!o)return[];const i=e.getValue().matchAll(/(\[(?<dimensionName>[^\]]*)\]?)(?<dotAfterDimension>\s*\.\s*)?((?:(\[(?<quotedHierarchy>[^\]]*)\]?)|(?<unquotedHierarchy>\w*)))?(?<dotAfterHierarchy>\s*\.\s*)?(?<memberPath>.*)?/gim),s=[];for(const d of i){if(!d.index)continue;const{dimensionName:i,dotAfterDimension:l,quotedHierarchy:u,unquotedHierarchy:m}=d.groups||{},c=e.getPositionAt(d.index);if((0,f.t)({dimensionName:i})||!r&&"measures"===i.toLowerCase()||["from ","member "].some((o=>e.getValueInRange({startLineNumber:c.lineNumber,endLineNumber:c.lineNumber,startColumn:0,endColumn:c.column}).toLowerCase().includes(o))))continue;const p=o?[o]:t?(0,g.X)(t):[],b=N(p),A=r?b.find((e=>e.name===i)):b.find((e=>e.name.toLowerCase()===i.toLowerCase()));if(void 0===A){const o=b.map((({name:e})=>e));s.push(E({type:"warning",classNames:n,textModel:e,offset:d.index,length:d[0]?.length,options:{hoverMessage:R({header:`${a({id:"aui.mdxEditor.hover.dimensionNotFound"})} ***${i}***`,body:`${a({id:"aui.mdxEditor.hover.availableDimensionsAre"})} : \n${o.map((e=>`- ${e}`)).join("\n")}`,hint:K(i,o),formatMessage:a})}}));continue}const h=(u||m)??"";if(l){const o=$(p,A.name);if(void 0===(r?o.find((e=>e.name===h)):o.find((e=>e.name.toLowerCase()===h.toLowerCase())))){const t=o.map((e=>e.name));s.push(E({type:"warning",classNames:n,textModel:e,offset:d.index,length:d[0]?.length,options:{hoverMessage:R({header:a({id:"aui.mdxEditor.hover.hierarchyWarning"},{dimensionName:i,hierarchyName:h}),body:`${a({id:"aui.mdxEditor.hover.availableHierarchiesAre"},{dimensionName:i,hierarchyName:h})} : \n${t.map((e=>`- ${e}`)).join("\n")}`,hint:K(h,t),formatMessage:a})}}));continue}}}return s}},D={getDecorations:({textModel:e,dataModel:o,classNames:t,formatMessage:n=(()=>"")})=>{if(!o)return[];const r=e.getValue().matchAll(new RegExp(`(${p.J6.join("|")})[(][^]*?"(?<kpi>.*)"[^]*?[)]`,"gim")),a=(0,m.flatMap)((0,g.X)(o),(e=>Object.keys(e.kpis))),i=[];for(const o of r){const r=o.groups?.kpi??"";o.index&&!a.includes(r)&&i.push(E({type:"warning",classNames:t,textModel:e,offset:o.index,length:o[0]?.length,options:{hoverMessage:R({header:`${n({id:"aui.mdxEditor.hover.invalidKPI"})} ***${r}***`,body:`${n({id:"aui.mdxEditor.hover.availableKPIsAre"})} : \n${a.map((e=>`- ${e}`)).join("\n")}`,hint:K(r,a),formatMessage:n})}}))}return i}},O={getDecorations:({textModel:e,cube:o,dataModel:t,classNames:n,formatMessage:r=(()=>"")})=>{if(!t)return[];const a=e.getValue().matchAll(/(\[Measures]).(?:(\[(?<quotedMeasure>.*)\])|(?<unquotedMeasure>\w*))/gi),i=o?[o]:(0,g.X)(t),s=[...C(i).map((({name:e})=>e)),...b(e.getValue())],d=[];for(const o of a){const{groups:{unquotedMeasure:t,quotedMeasure:a}={unquotedMeasure:void 0,quotedMeasure:void 0}}=o||{},i=t??a??" ";if(o.index&&!s.includes(i)){const t=e.getPositionAt(o.index);if(["from","member"].some((o=>e.getValueInRange({startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:0,endColumn:t.column}).toLowerCase().includes(o))))continue;d.push(E({type:"warning",classNames:n,textModel:e,offset:o.index,length:o[0]?.length,options:{hoverMessage:R({header:`${r({id:"aui.mdxEditor.hover.invalidMeasure"})} **${i}**`,body:`${r({id:"aui.mdxEditor.hover.availableMeasuresAre"})} : \n${s.map((e=>`- ${e}`)).join("\n")}`,hint:K(i,s),formatMessage:r})}}))}}return d}},V=e=>`background-image:\n     linear-gradient(45deg, transparent 65%, ${e} 80%, transparent 90%),\n     linear-gradient(135deg, transparent 5%, ${e} 15%, transparent 25%),\n     linear-gradient(135deg, transparent 45%, ${e} 55%, transparent 65%),\n     linear-gradient(45deg, transparent 25%, ${e} 35%, transparent 50%);\n     background-repeat:repeat-x;\n     background-size: 8px 2px;\n     background-position:0 95%;`,q={line_error:V("red"),line_warning:V(I)};var Y=t(89801);const F={provideDocumentFormattingEdits:e=>{try{return[{range:e.getFullModelRange(),text:(0,Y.A)((0,s.q)(e.getValue()),{indent:!0})}]}catch{}}},Q={id:"mdx",monarchLanguage:{defaultToken:"",tokenPostfix:".mdx",ignoreCase:!0,brackets:[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{close:"(",open:")",token:"delimiter.parenthesis"}],functionKeywords:p.fj,kpiKeywords:p.J6,argumentKeywords:p.c2,memberPropertyKeywords:p.mP,axisKeywords:p.GI,cellPropertyKeywords:p.CY,booleanOperatorKeywords:p.P4,booleanKeywords:p.B9,structuralKeywords:p._v,tokenizer:{root:[{include:"@comments"},{include:"@whiteSpace"},{include:"@numbers"},{include:"@strings"},{include:"@delimitedIdentifier"},[/[\w@]+/,{cases:{"@structuralKeywords":"keyword.structural","@booleanKeywords":"boolean","@booleanOperatorKeywords":"keyword.booleanOperator","@axisKeywords":"keyword.axis","@cellPropertyKeywords":"keyword.cellProperty","@functionKeywords":"keyword.function","@kpiKeywords":"keyword.kpi","@memberPropertyKeywords":"keyword.memberProperty","@argumentKeywords":"keyword.argument","@default":"identifier.regular"}}],{include:"@operators"}],comments:[[/(^|[^\\:])\/\/.*/,"comment"],[/(^|[^\\:])-{2}.*/,"comment"],[/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,"comment"]],whiteSpace:[[/\s+/,"white"]],numbers:[[/\d*\.\d+(E(\+|-)?\d+)?/,"number"],[/\d+/,"number"]],operators:[[/\+|\/|\*|\^|-/,"operator"],[/>=|<=|<>|=|>|</,"operator"],[/:|&/,"operator"]],delimitedIdentifier:[[/\[([^\]]{0,100})\]/,"identifier.delimited"]],strings:[[/'/,{token:"string",next:"@string"}],[/"/,{token:"string.double",next:"@stringDouble"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],stringDouble:[[/[^"]+/,"string.double"],[/""/,"string.double"],[/"/,{token:"string.double",next:"@pop"}]]}},configuration:{comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],onEnterRules:[{beforeText:/.*\bSELECT\s*$/,action:{indentAction:1}},{beforeText:/.*\bFROM\s*$/,action:{indentAction:1}}]}},B={id:"light-theme",data:{base:"vs",inherit:!0,rules:[{token:"identifier.delimited",foreground:"#1b1a1a"},{token:"identifier.regular",foreground:"#5a5a5a"},{token:"keyword.structural",foreground:"#3399ff"},{token:"keyword.axis",foreground:"#3399ff"},{token:"keyword.function",foreground:"#59bb00"},{token:"keyword.kpi",foreground:"#59bb00"},{token:"keyword.memberProperty",foreground:"#59bb00"},{token:"keyword.argument",foreground:"#ff901e"},{token:"keyword.booleaOperator",foreground:"#397800"},{token:"keyword.cellProperty",foreground:"#397800"},{token:"boolean",foreground:"#ff901e"},{token:"number",foreground:"#ff901e"},{token:"operator",foreground:"#ff8000"},{token:"comment",foreground:"#aa5500"}],colors:{"editor.background":"#fafafa"}}},_=()=>{},G=(0,a.forwardRef)((({value:e,cube:o,dataModel:t,isCaseSensitive:r,classNames:g={},onChange:f=_,options:p={tabSize:2}},b)=>{const{formatMessage:A}=(0,i.useIntl)(),[h,M]=(0,a.useState)(),[k,w]=(0,a.useState)(),x=(0,a.useMemo)((()=>((e,o,t=(({id:e})=>`${e}`))=>({triggerCharacters:["[","."],provideCompletionItems:(n,r,a,i)=>{if(!i.isCancellationRequested)return{suggestions:y({position:r,textModel:n,cube:e,dataModel:o,formatMessage:t})}}}))(o,t,A)),[o,t,A]),C=(0,a.useMemo)((()=>(({value:e,mdxErrorDetails:o,cube:t,dataModel:n,classNames:r,formatMessage:a,isCaseSensitive:i})=>{if(!e)return[];const s=c.editor.createModel(e);return(0,m.flatMap)([P,S,O,j,D,L],(({getDecorations:e})=>e({textModel:s,mdxErrorDetails:o,cube:t,dataModel:n,classNames:r,formatMessage:a,isCaseSensitive:i})))})({value:e,dataModel:t,cube:o,mdxErrorDetails:k,classNames:g,formatMessage:A,isCaseSensitive:r})),[e,k,t,g,A,o,r]),N=(0,l.DP)();return(0,a.useEffect)((()=>{M(N.isDark?v:B)}),[N.isDark]),(0,a.useEffect)((()=>{try{e&&(0,s.q)(e),w(void 0)}catch(e){if(!(e instanceof d.e))throw e;w(e.details)}}),[e]),(0,n.Y)(u.default,{ref:b,value:e,onChange:f,language:Q,theme:h,options:p,documentFormattingEditProvider:F,completionItemProvider:x,deltaDecorations:C})})),T=(0,a.forwardRef)(((e,o)=>(0,n.Y)(r.ClassNames,{children:({css:t})=>(0,n.Y)(G,{...e,ref:o,classNames:{line_error:t(q.line_error),line_warning:t(q.line_warning)}})})))},68968:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="},3552:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII="},62974:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC"}}]);