//>>built
define("dstore/legacy/DstoreAdapter",["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(u,r,v){function p(c){return c}var t={store:null,constructor:function(c){this.store=c;if(c._getQuerierFactory("filter")||c._getQuerierFactory("sort"))this.queryEngine=function(a,b){b=b||{};var e=c._getQuerierFactory("filter"),l=e?e(a):p;e=c._getQuerierFactory("sort");var m=p;e&&(m=e(r.map(b.sort,function(h){return{property:h.attribute,descending:h.descending}})));var f=p;isNaN(b.start)&&
isNaN(b.count)||(f=function(h){var k=b.start||0;k=h.slice(k,k+(b.count||Infinity));k.total=h.length;return k});return function(h){return f(m(l(h)))}};var g=this;c.on("add,update,delete",function(a){var b=a.type,e=a.target;g.notify("add"===b||"update"===b?e:void 0,"delete"===b||"update"===b?"id"in a?a.id:c.getIdentity(e):void 0)})},query:function(c,g){g=g||{};var a=this.store.filter(c),b,e=g.sort;if(e)if("[object Array]"===Object.prototype.toString.call(e))for(b=e.length-1;0<=b;b--){var l=e[b];a=a.sort(l.attribute,
l.descending)}else a=a.sort(e);if(a.track&&!a.tracking){a=a.track();var m=!0}if("start"in g){var f=g.start||0;f=a[a.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:f,end:g.count?f+g.count:Infinity})}f=f||a[a.fetchSync?"fetchSync":"fetch"]();b=f.totalLength;f=new v(f);f.total=b;f.observe=function(h,k){function n(d){return void 0===d&&m?-1:d}var w=a.on("add",function(d){h(d.target,-1,n(d.index))}),x=a.on("update",function(d){!k&&d.previousIndex===d.index&&isFinite(d.index)||h(d.target,n(d.previousIndex),
n(d.index))}),y=a.on("delete",function(d){h(d.target,n(d.previousIndex),-1)}),q={remove:function(){w.remove();x.remove();y.remove()}};q.cancel=q.remove;return q};return f},notify:function(){}};r.forEach(["get","put","add","remove","getIdentity"],function(c){t[c]=function(){var g=this.store;return(g[c+"Sync"]||g[c]).apply(g,arguments)}});return u(null,t)});
//# sourceMappingURL=DstoreAdapter.js.map