//>>built
define("dstore/Memory","dojo/_base/declare dojo/_base/lang dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(n,t,u,p,q,r,m){return n([p,q,r],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,b){b=b||{};var c=this.storage,h=c.index,k=c.fullData,g=this.Model;!g||a instanceof
g||(a=this._restore(a));var e=this.getIdentity(a);null==e&&(this._setIdentity(a,"id"in b?b.id:Math.random()),e=this.getIdentity(a));c.version++;c=e in h?"update":"add";g={target:a};var d;if("update"===c){if(!1===b.overwrite)throw Error("Object already exists");e=d=h[e]}else e=this.defaultNewToStart?0:k.length;if("beforeId"in b){var l=b.beforeId;if(null===l){var f=k.length;"update"===c&&--f}else f=h[l],d<f&&--f;void 0!==f?g.beforeId=l:f=e}else f=e;if(f===d)k[f]=a;else for(void 0!==d&&k.splice(d,1),
k.splice(f,0,a),d=void 0===d?f:Math.min(d,f),e=k.length;d<e;++d)h[this.getIdentity(k[d])]=d;this.emit(c,g);return a},addSync:function(a,b){(b=b||{}).overwrite=!1;return this.putSync(a,b)},removeSync:function(a){var b=this.storage,c=b.index;b=b.fullData;if(a in c)return c=b.splice(c[a],1)[0],this._reindex(),this.emit("delete",{id:a,target:c}),!0},setData:function(a){this.parse&&(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},
_reindex:function(){for(var a=this.storage,b=a.index={},c=a.fullData,h=this.Model,k=Object.prototype,g=0,e=c.length;g<e;g++){var d=c[g];if(h&&!(d instanceof h)){var l=this._restore(d,d.__proto__===k);d!==l&&(c[g]=d=l)}b[this.getIdentity(d)]=g}a.version++},fetchSync:function(){var a=this.data;if(!a||a._version!==this.storage.version){a=this.storage.fullData;for(var b=this.queryLog,c=0,h=b.length;c<h;c++)a=b[c].querier(a);a._version=this.storage.version;this.data=a}return new m(a)},fetchRangeSync:function(a){var b=
this.fetchSync();return new m(b.slice(a.start,a.end),{totalLength:b.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})});
//# sourceMappingURL=Memory.js.map