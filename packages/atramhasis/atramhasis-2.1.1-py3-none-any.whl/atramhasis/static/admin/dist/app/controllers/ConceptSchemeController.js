//>>built
define("app/controllers/ConceptSchemeController","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/request/xhr dojo/Deferred dojo/store/JsonRest dojo/store/Cache dojo/store/Memory dstore/Memory dojo/json".split(" "),function(k,l,h,f,m,n,p,q,r,t){return k(null,{conceptSchemeList:null,externalSchemeStore:null,_target:"/conceptschemes",_stores:{},constructor:function(a){k.safeMixin(this,a);this.conceptSchemeList=[]},getConceptSchemes:function(){return f.get(this._target,{handleAs:"json",headers:{"Content-Type":"application/json",
Accept:"application/json"}})},getConceptScheme:function(a){return f.get(this._target+"/"+a,{handleAs:"json",headers:{"Content-Type":"application/json",Accept:"application/json"}})},getConceptSchemeFromList:function(a){var c=h.filter(this.conceptSchemeList,function(b){return b.id===a});return 0<c.length?c[0]:null},editConceptScheme:function(a){var c=t.stringify(a);return f(this._target+"/"+a.id,{handleAs:"json",method:"PUT",data:c,headers:{"Content-Type":"application/json",Accept:"application/json"}})},
loadConceptSchemeStores:function(){return this.getConceptSchemes().then(l.hitch(this,function(a){var c=[];h.forEach(a,l.hitch(this,function(b){b.label||(b.label=b.uri);-1===h.indexOf(b.subject,"external")?this.conceptSchemeList.push(b):c.push(b)}));this.externalSchemeStore=new r({idProperty:"id",data:c})}))},getConceptSchemeTree:function(a){return new p(new n({target:"/conceptschemes/"+a+"/tree",getChildren:function(c){return c.children||[]}}),new q)},getMatch:function(a,c){var b=this;return f.get("/uris/"+
a,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(d){var e=d.id;return b.getConcept(d.concept_scheme.id,a).then(function(g){return{type:c,data:{id:e,label:b._getPrefLabel(g.labels,"en"),uri:a}}},function(g){throw g;})},function(d){throw d;})},getMergeMatch:function(a){var c=this;return f.get("/uris/"+a,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(b){return c.getConcept(b.concept_scheme.id,a).then(function(d){return{labels:d.labels,notes:d.notes}},function(d){throw d;
})},function(b){throw b;})},getConcept:function(a,c){var b=new m,d=c.split("/").pop();a&&d||b.reject("Malformed external scheme URI");f.get("/conceptschemes/"+a+"/c/"+d,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(e){var g={label:e.label,labels:e.labels,type:e.type,notes:e.notes};"collection"!=e.type&&(g.matches={exact:[c]});b.resolve(g)},function(e){b.reject(e)});return b},_getPrefLabel:function(a,c){var b=h.filter(a,function(e){return"prefLabel"==e.type});if(0==b.length)return a[0].label;
var d=h.filter(a,function(e){return e.language==c});return 0==d.length?b[0].label:d[0].label},getExternalSchemeStore:function(){return this.externalSchemeStore?this.externalSchemeStore:null},searchForConcepts:function(a,c){return f.get("/conceptschemes/"+a+"/c?label\x3d"+c+"\x26type\x3dall\x26sort\x3d+label",{handleAs:"json",headers:{Accept:"application/json"}})}})});
//# sourceMappingURL=ConceptSchemeController.js.map