//>>built
require({cache:{"url:app/ui/dialogs/templates/ManageProvidersDialog.html":'\x3cdiv class\x3d"dijitDialog" role\x3d"dialog" aria-labelledby\x3d"manageProvidersDialog_title"\x3e\n  \x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\n    \x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" role\x3d"heading"\x3e\x3c/span\x3e\n    \x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon"\n          data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"Annuleren" role\x3d"button" tabIndex\x3d"-1"\x3e\n\t\t\t\x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"Annuleren" tabIndex\x3d"-1"\x3e\n        \x3ci class\x3d"fa fa-times"\x3e\x3c/i\x3e\x3c/span\x3e\n\t\t\x3c/span\x3e\n  \x3c/div\x3e\n  \x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\n    \x3cdiv class\x3d"row hide" data-dojo-attach-point\x3d"providerFormNode"\x3e\n      \x3ch5\x3eProvider:\x3c/h5\x3e\n      \x3cdiv class\x3d"row"\x3e\n        \x3cdiv class\x3d"large-12 columns"\x3e\n          \x3cdiv class\x3d"placeholder-container"\x3e\n            \x3clabel for\x3d"idNode-provider"\x3eID\x3c/label\x3e\n            \x3cinput type\x3d"text" id\x3d"idNode-provider" data-dojo-attach-point\x3d"idNode"\n                   placeholder\x3d"Leave blank to use the conceptscheme id" /\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"placeholder-container"\x3e\n            \x3clabel for\x3d"uriNode-provider" title\x3d"required"\x3eConceptscheme uri *\x3c/label\x3e\n            \x3cinput type\x3d"text" id\x3d"uriNode-provider" data-dojo-attach-point\x3d"uriNode"\n            placeholder\x3d"e.g. https://id.test.net/thesauri/example" /\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"placeholder-container"\x3e\n            \x3clabel for\x3d"uriPatternNode-provider" title\x3d"required"\x3eUri pattern *\x3c/label\x3e\n            \x3cinput type\x3d"text" id\x3d"uriPatternNode-provider" data-dojo-attach-point\x3d"uriPatternNode"\n            placeholder\x3d"e.g. https://id.test.net/thesauri/example/%s" /\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"placeholder-container"\x3e\n            \x3clabel title\x3d"Provide a comma separated list for multiple subjects. For now, only hidden is supported"\n                   for\x3d"subjectNode-provider"\x3eSubject\x3c/label\x3e\n            \x3cinput type\x3d"text" id\x3d"subjectNode-provider" data-dojo-attach-point\x3d"subjectNode" placeholder\x3d"e.g. hidden"\n                   title\x3d"Provide a comma separated list for multiple subjects. For now, only hidden is supported" /\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"row"\x3e\n        \x3cdiv class\x3d"large-6 columns"\x3e\n          \x3cdiv class\x3d"placeholder-container large-label"\x3e\n            \x3clabel for\x3d"defaultLangNode-provider"\x3eDefault language\x3c/label\x3e\n            \x3cselect id\x3d"defaultLangNode-provider" data-dojo-attach-point\x3d"defaultLangNode"\x3e\x3c/select\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"placeholder-container large-label"\x3e\n            \x3clabel for\x3d"displayLangNode-provider"\x3eDisplay language\x3c/label\x3e\n            \x3cselect id\x3d"displayLangNode-provider" data-dojo-attach-point\x3d"displayLangNode"\x3e\x3c/select\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"large-6 columns"\x3e\n          \x3cdiv class\x3d"placeholder-container large-label"\x3e\n            \x3clabel for\x3d"idStrategyNode-provider"\x3eId generating strategy\x3c/label\x3e\n            \x3cselect id\x3d"idStrategyNode-provider" data-dojo-attach-point\x3d"idStrategyNode"\x3e\n              \x3coption value\x3d"GUID"\x3eGUID\x3c/option\x3e\n              \x3coption value\x3d"MANUAL"\x3eMANUAL\x3c/option\x3e\n              \x3coption value\x3d"NUMERIC" selected\x3eNUMERIC\x3c/option\x3e\n            \x3c/select\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"placeholder-container large-label"\x3e\n            \x3clabel for\x3d"expandStrategyNode-provider"\x3eExpand strategy\x3c/label\x3e\n            \x3cselect id\x3d"expandStrategyNode-provider" data-dojo-attach-point\x3d"expandStrategyNode"\x3e\n              \x3coption value\x3d"recurse" selected\x3erecurse\x3c/option\x3e\n              \x3coption value\x3d"visit"\x3evisit\x3c/option\x3e\n            \x3c/select\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"row"\x3e\n        \x3cdiv class\x3d"large-12 colums text-center"\x3e\n          \x3cbutton data-dojo-attach-event\x3d"onClick: _saveProvider" class\x3d"button tiny"\x3e\n            Save\x3c/i\x3e\n          \x3c/button\x3e\n          \x3cbutton data-dojo-attach-event\x3d"onClick: _cancelProvider" class\x3d"button tiny"\x3e\n            Cancel\n          \x3c/button\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"row" data-dojo-attach-point\x3d"providerGridContainerNode"\x3e\n      \x3cdiv class\x3d"large-12 columns"\x3e\n        \x3cbutton data-dojo-attach-event\x3d"onClick: _showProviderForm" class\x3d"button tiny"\x3e+ Add a provider\x3c/button\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"large-12 columns"\x3e\n        \x3cdiv data-dojo-attach-point\x3d"providerGridNode"\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"row footerButtons"\x3e\n      \x3chr\x3e\n      \x3cdiv class\x3d"large-12 columns text-center"\x3e\n        \x3cbutton data-dojo-attach-event\x3d"onClick: _closeClick" class\x3d"button tiny"\x3eClose\x3c/button\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'}});
define("app/ui/dialogs/ManageProvidersDialog","dojo/_base/declare dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dojo/topic dojo/_base/lang dojo/query dojo/on dojo/when dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dgrid/OnDemandGrid dgrid/extensions/DijitRegistry dgrid/extensions/ColumnResizer dojo/text!./templates/ManageProvidersDialog.html dijit/ConfirmDialog ../../utils/DomUtils dojo/NodeList-manipulate".split(" "),function(p,r,t,u,f,d,v,q,C,w,l,h,k,x,y,z,
A,B,e){return p([u,r,t],{templateString:A,parentNode:null,baseClass:"manage-providers-dialog",title:"Manage providers",providerController:null,languageController:null,_providerStore:null,_providerGrid:null,_editMode:!1,postCreate:function(){this.inherited(arguments);this._providerStore=this.providerController.getProviderStore();this._providerGrid=this._createGrid({collection:this._providerStore},this.providerGridNode);this.languageController.getLanguageStore().fetch().then(d.hitch(this,function(a){e.addOptionsToSelect(this.defaultLangNode,
{data:a,idProperty:"id",labelProperty:"name",placeholder:"Choose a language"});e.addOptionsToSelect(this.displayLangNode,{data:a,idProperty:"id",labelProperty:"name",placeholder:"Choose a language"})}))},startup:function(){this.inherited(arguments);this._providerGrid.startup()},hide:function(){this.inherited(arguments)},show:function(){this.inherited(arguments)},_closeClick:function(a){a.preventDefault();this._reset(!1);this.hide()},_reset:function(a){this._editMode=!1;this._hideProviderForm();k.remove(this.idNode,
"disabled");k.remove(this.uriNode,"disabled");this.idNode.value="";this.uriNode.value="";this.uriPatternNode.value="";this.subjectNode.value="";this.subjectNode.value="";e.setSelectedOptions(this.idStrategyNode,["NUMERIC"]);e.setSelectedOptions(this.expandStrategyNode,["recurse"]);e.setSelectedOptions(this.defaultLangNode,[""]);e.setSelectedOptions(this.displayLangNode,[""]);this._providerGrid.resize();a?setTimeout(d.hitch(this,function(){this._providerGrid.refresh()}),1E3):this._providerGrid.refresh()},
_createGrid:function(a,b){var c={id:{label:"ID",field:"id"},name:{label:"Conceptscheme uri",field:"conceptscheme_uri"},uri_pattern:{label:"Uri pattern",field:"uri_pattern"},type:{label:"Type",field:"type"},default_language:{label:"Def. lang.",field:"default_language"},force_display_language:{label:"Displ. lang.",field:"force_display_language"},id_generation_strategy:{label:"ID gen. strategy",field:"id_generation_strategy"},subject:{label:"Subject",field:"subject"},expand_strategy:{label:"Expand strategy",
field:"expand_strategy"},actions:{label:"",renderCell:d.hitch(this,function(g){if("SQLAlchemyProvider"!==g.type)return null;var m=l.create("div",{"class":"dGridHyperlink"});l.create("a",{href:"#",title:"Edit provider",className:"fa fa-pencil",innerHTML:"",onclick:d.hitch(this,function(n){n.preventDefault();this._openProvider(g)})},m);l.create("a",{href:"#",title:"Remove provider",className:"fa fa-trash",innerHTML:"",style:"margin-left: 10px;",onclick:d.hitch(this,function(n){n.preventDefault();this._removeProvider(g)})},
m);return m})}};c=new (p([x,y,z]))({collection:a.collection,columns:c,noDataMessage:"No providers found",loadingMessage:"Fetching data.."},b);c.on("dgrid-error",function(g){});return c},_showProviderForm:function(){this._editMode&&(k.set(this.idNode,"disabled",!0),k.set(this.uriNode,"disabled",!0));h.remove(this.providerFormNode,"hide");h.add(this.providerGridContainerNode,"hide")},_hideProviderForm:function(){h.add(this.providerFormNode,"hide");h.remove(this.providerGridContainerNode,"hide")},_openProvider:function(a){this._editMode=
!0;this._setProvider(a);this._showProviderForm()},_removeProvider:function(a){var b=new B({title:"Delete provider",content:'\x3cp style\x3d"font-size: 15px;"\x3eAre you sure you want to remove provider \x3cstrong\x3e'+a.id+"\x3c/strong\x3e ("+a.conceptscheme_uri+")?\x3c/p\x3e",baseClass:"confirm-dialog"});v(".dijitButton",b.domNode).addClass("button tiny");b.closeText.innerHTML='\x3ci class\x3d"fa fa-times"\x3e\x3c/i\x3e';q(b,"close",function(){b.destroy()});q(b,"execute",d.hitch(this,function(){this._providerStore.remove(a.id).then(d.hitch(this,
function(){f.publish("dGrowl","Provider removed: "+a.id,{title:"Provider",sticky:!1,channel:"info"});this._reset(!0)}),function(c){(c.response&&"409"===c.response.status||409===c.response.status)&&f.publish("dGrowl",a.id+" ("+a.conceptscheme_uri+") is in use and can't be removed",{title:"Provider",sticky:!1,channel:"warn"})})}));b.show()},_cancelProvider:function(){this._reset()},_saveProvider:function(){var a=this.subjectNode.value.split(",").map(function(b){return b.trim()}).filter(function(b){return 0<
b.length});a={id:this.idNode.value.trim()?this.idNode.value.trim():void 0,conceptscheme_uri:this.uriNode.value.trim(),uri_pattern:this.uriPatternNode.value.trim(),subject:a,id_generation_strategy:e.getSelectedOption(this.idStrategyNode),expand_strategy:e.getSelectedOption(this.expandStrategyNode),default_language:e.getSelectedOption(this.defaultLangNode),force_display_language:e.getSelectedOption(this.displayLangNode)};this._validate(a)?this._editMode?this._editProvider(a):this._addProvider(a):f.publish("dGrowl",
"Please fill in all required fields.",{title:"Provider not valid",sticky:!1,channel:"warn"})},_setProvider:function(a){this.idNode.value=a.id;this.uriNode.value=a.conceptscheme_uri;this.uriPatternNode.value=a.uri_pattern;this.subjectNode.value=a.subject.join(", ");a.id_generation_strategy&&e.setSelectedOptions(this.idStrategyNode,[a.id_generation_strategy]);a.expand_strategy&&e.setSelectedOptions(this.expandStrategyNode,[a.expand_strategy]);a.default_language&&e.setSelectedOptions(this.defaultLangNode,
[a.default_language]);a.force_display_language&&e.setSelectedOptions(this.displayLangNode,[a.force_display_language])},_validate:function(a){var b=!0;if(""===a.conceptscheme_uri||""===a.uri_pattern)b=!1;return b},_parseError:function(a){a=JSON.parse(a.response.data);var b="",c=null;w.forEach(a.errors,function(g){for(c in g)b+="-\x3cem\x3e",b+=c,b+="\x3c/em\x3e: ",b+=g[c],b+="\x3cbr\x3e"});return b},_addProvider:function(a){this._providerStore.add(a).then(d.hitch(this,function(b){f.publish("dGrowl",
"New provider added with id "+b.id,{title:"Provider",sticky:!1,channel:"info"});this.providerController.loadProviders().then(d.hitch(this,function(){this._reset(!0);this.parentNode.refresh_conceptschemes()}),d.hitch(this,function(c){c=this._parseError(c);f.publish("dGrowl",c,{title:"Error updating provider list",sticky:!0,channel:"error"})}))}),d.hitch(this,function(b){b=this._parseError(b);f.publish("dGrowl",b,{title:"Error adding provider",sticky:!0,channel:"error"})}))},_editProvider:function(a){this._providerStore.put(a).then(d.hitch(this,
function(b){f.publish("dGrowl","Provider with id "+b.id+" was saved.",{title:"Provider",sticky:!1,channel:"info"});this.providerController.loadProviders().then(d.hitch(this,function(){this._reset()}),d.hitch(this,function(c){c=this._parseError(c);f.publish("dGrowl",c,{title:"Error updating provider list",sticky:!0,channel:"error"})}))}),d.hitch(this,function(b){b=this._parseError(b);f.publish("dGrowl",b,{title:"Error editing provider",sticky:!0,channel:"error"})}))}})});
//# sourceMappingURL=ManageProvidersDialog.js.map