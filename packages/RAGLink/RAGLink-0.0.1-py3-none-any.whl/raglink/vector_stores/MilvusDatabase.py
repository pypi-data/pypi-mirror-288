#!/usr/bin/env python
# !/usr/bin/python3
# -*- coding: utf-8 -*-
# @Author  : justin.郑
# @mail    : 3907721@qq.com
# @Time    : 2024/6/17 上午10:38
# @File    : MilvusDatabase.py
# @desc    : Milvus数据库基类


import os
from dotenv import load_dotenv
load_dotenv()

from raglink.utils.logger import logger
from pymilvus import connections, FieldSchema, CollectionSchema, DataType, Collection, utility


class MilvusDatabase:
    def __init__(self,
                 collection_name,
                 connections_name="default",
                 connections_host='localhost',
                 connections_port='19530',
                 is_local=True):
        """
        初始化
        :param collection_name:     集合名称
        :param connections_name:    链接数据库名称
        :param connections_host:    链接数据库Host
        :param connections_port:    链接数据库端口
        :param is_local:            是否链接本地数据 True为本地数据库 False；为zilliz远程数据库
        """
        self.collection_name = collection_name
        if is_local:
            # 连接本地数据库
            connections.connect(connections_name, host=connections_host, port=connections_port)
            logger.info("MILVUS 连接本地数据库")
        else:
            # 连接Zilliz服务器
            connections.connect(
                connections_name,
                uri=os.getenv("MILVUS_URI"),
                token=os.getenv("MILVUS_TOKEN")
            )
            logger.info("MILVUS 连接Zilliz Cloud数据库")

        # 判断该集合是否存在
        if utility.has_collection(self.collection_name):
            self.collection = Collection(self.collection_name)
            # 检查集合索引是否已经加载
            load_status = utility.load_state(collection_name)
            if str(load_status) == "NotLoad":
                self.collection.load()

    # 查询集合
    def get_collection(self):
        return self.collection

    # 创建集合与索引
    def create_collection(self, collection_description, dimension, index_type="attu", metric_type='L2'):
        """
        创建集合与索引
        :param collection_description:  集合描述
        :param dimension:               向量维度
        :param index_type:              索引类型    zilliz 为远程zilliz数据库；attu 本地数据库
        :param metric_type:             默认 L2    L2距离(欧氏距离)是向量相似性度量方法，用于衡量向量之间的距离和相似度
        :return:
        """
        # 判断该集合是否存在，存在直接输出该集合
        if utility.has_collection(self.collection_name):
            # utility.drop.collection(collection_name)
            logger.info("Milvus 创建集合时，该集合已存在载入之前集合")
            return Collection(self.collection_name)

        # --- 1. 创建集合 ---
        # CollectionSchema 类创建了一个集合模式 schema（纲要），并指定了集合的字段定义和描述信息。
        # 定义字段
        fields = [
            FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
            FieldSchema(name="source", dtype=DataType.VARCHAR, max_length=255),
            FieldSchema(name="content", dtype=DataType.VARCHAR, max_length=30000),
            FieldSchema(name="content_vector", dtype=DataType.FLOAT_VECTOR, dim=dimension),
        ]
        # 创建schema（纲要）
        schema = CollectionSchema(fields=fields, description=collection_description)

        #  创建集合 Collection 类创建了一个名为 collection 的集合对象，并传入集合名称和集合模式（纲要）。
        collection = Collection(name=self.collection_name, schema=schema)
        logger.info("Milvus 创建集合")

        # --- 2. 创建索引 ---
        # L2距离(欧氏距离)是向量相似性度量方法，用于衡量向量之间的距离和相似度。
        # params为设置索引的参数：较大的 nlist值有助于提高搜索速度，但会增加索引的内存消耗
        if index_type == 'attu':
            index_params = {
                'metric_type': metric_type,
                'index_type': "IVF_FLAT",       # 倒排文件(Inverted File)的索引方法，适用于高维向量的相似性搜索。
                'params': {"nlist": 1024}
            }
        elif index_type == "zilliz":
            index_params = {
                'metric_type': metric_type,
                'index_type': "AUTOINDEX",      # index_type被设置为"AUTOINDEX"，表示使用自动索引
                'params': {}
            }
        # field_name 创建索引的字段名； index_params 索引参数； index_name 索引命名(可选)
        collection.create_index(field_name='content_vector', index_params=index_params)
        logger.info(f"Milvus 创建索引，类型为{index_type}")
        # 加载集合到内存
        collection.load()
        self.collection = collection

    # 删除集合
    def drop_collection(self):
        if utility.has_collection(self.collection_name):
            utility.drop_collection(self.collection_name)
            logger.info("Milvus 删除集合 成功")
            return "drop success"
        logger.info("Milvus 删除集合 失败")
        return "drop fail"

    # 创建集合分区
    def create_partition(self, partition_name, partition_description=""):
        """
        创建集合分区
        :param partition_name:          分区名称
        :param partition_description:   分区描述
        :return:
        """
        if utility.has_partition(self.collection_name, partition_name):
            logger.info("Milvus 分区已经存在")
            return "partition already exists"

        # 创建分区 分区名称；分区描述
        partition = self.collection.create_partition(
            partition_name=partition_name,
            description=partition_description
        )
        # 分区加载到内存
        partition.load()
        return partition

    # 查询分区
    def get_partition(self):
        return self.collection.partitions

    # 分区中插入数据
    def insert_data_partition(self, data, partition_name):
        """
        分区中插入数据
        :param data:            存储数据
        :param partition_name:  分区名
        :return:
        """
        # 判断分区是否存在，不存在创建分区
        if self.collection.has_partition(partition_name):
            newpart = self.collection.partition(partition_name)
        else:
            self.create_partition(partition_name)
            newpart = self.collection.partition(partition_name)

        # 分区中插入数据
        res = newpart.insert(data)
        logger.debug(f"Milvus 分区中插入数据:{res}")
        return res

    # 查询分区中的数据
    def search_data_partition(self, data, partition_name, top_k=3):
        """
        查询分区中的数据
        :param data:            查询数据
        :param partition_name:  分区名
        :param top_k:           输出块数
        :return:
        """
        # 判断该集合中分区是否存在
        if self.collection.has_partition(partition_name):
            newpart = self.collection.partition(partition_name)

            # 分区中搜索数据
            res = newpart.search(
                data=data,
                anns_field="content_vector",
                param={"metric_type": "L2"},
                output_fields=["content", "source"],
                limit=top_k
            )

            logger.debug(f"Milvus 分区检索结构: {res}")
            return res
        else:
            logger.warning(f"Milvus 该分区不存在，分区名：{partition_name}")

    # 删除分区
    def drop_partition(self, partition_name):
        # self.collection.release_collection(self.collection_name)
        if utility.has_partition(self.collection_name, partition_name):
            self.collection.release()
            self.collection.drop_partition(partition_name)
            logger.info("Milvus 删除集合分区 成功")
            return "drop partition success"
        logger.info("Milvus 删除集合分区 失败")
        return "drop partition fail"


if __name__ == '__main__':
    milvus_retrieval = MilvusDatabase(collection_name="test10", is_local=False)

    # 创建集合
    collection = milvus_retrieval.create_collection(
        collection_description="test09",
        dimension=768,
        index_type="zilliz"
    )

    # 删除集合
    # milvus_retrieval.drop_collection()

    # 创建分区
    # partition = milvus_retrieval.create_partition(
    #     partition_name="test_partition_05",
    #     partition_description="test_desc_04"
    # )
    # print(partition)

    # 插入数据分区
    # data = [
    #     {
    #         "source": "./data/安徽产业介绍问答.docx",
    #         "content": "中方为基辛格准备了午宴，宴会桌中央是鲜花铺成的中国卷轴，寓意福寿如山， 友谊绵长； 一百个寿桃、糖艺制作的老寿星和仙鹤，传递了最传统的祝福； 北京烤鸭、西湖醋鱼、两吃大虾",
    #         "content_vector": [-0.3635123892141898,0.9800666077471702,0.34180121222436166,0.9945157060064242,0.5483701949140074,-0.5111285152732061,-0.8604950088499652,-0.603615092180354,-0.21396481108487153,0.5042182837365874,0.5245454081453582,-0.0520155635515529,-0.7621087886914479,0.037752613235316534,-0.9150064335946235,0.39561544990970865,-0.97595346001319,-0.12882253286084078,-0.15411978637188506,0.17369832193303747,-0.08722981939014973,-0.25100757419898123,0.2678216918556835,-0.4051508615556272,-0.41082848711928266,0.5405250630148488,0.9063461552921968,0.39632671821475074,0.46634576852544574,-0.8884638661653403,0.8723820744496242,-0.09715312624685835,0.1663712287967214,-0.45466859557046435,-0.8326852295090865,-0.14572903837892315,0.919936505907019,-0.2966577104177457,-0.4920617629971933,-0.25933054072562833,0.69595475429504,0.9289710016675707,0.8811509298949516,-0.39748680672290093,0.24059837924409866,-0.05569910712271553,-0.3976295027414085,0.9225477746240451,0.2864265801317991,-0.13486226699519177,0.4999103839893895,-0.22628044290198113,0.21369018382768368,0.5011771116933306,-0.4668734658485836,-0.24816429833155995,0.8938766180758324,0.7717615995532245,-0.11964837248779303,0.44996433081488973,-0.7038004681176186,-0.6421741839297359,-0.044237110184787376,-0.021453985061547165,-0.4637242737028284,0.23756486033888202,0.41970204135741596,0.4056514348181126,0.22384521919678302,0.6649768894066803,0.15939738305779305,-0.44023104145589476,-0.39461769455830487,-0.5574359533965856,0.009763566180493788,0.9553889309305805,-0.11403155468413884,0.31500010176868143,-0.5423504192347273,-0.23574971810466838,0.4631682829598853,0.5054252228742631,-0.28806891242240984,-0.4080031732228404,0.162272016555284,-0.3905461438964395,0.018366251413201695,-0.4187353284001669,-0.8594785429461,0.5321123635331853,-0.20122186960142896,-0.9282292757357307,0.3861775367882436,-0.426328269202785,0.8523221751481618,0.26330435591487666,-0.6290419565077134,-0.18292137468874947,-0.7819578131200731,-0.8069691688428857,0.8824081814750813,-0.19169084110315127,-0.15171842605094166,-0.8233018604346514,0.10180038329727337,-0.2679247352355285,0.9462015485891935,0.7851023562701636,0.760356508315714,-0.7189520175870847,-0.12941156402677434,0.9608632231691412,0.49419129201384826,0.8813291160670396,0.015407458320841005,-0.7885337324463579,0.9431506762767436,0.8761657388683319,0.06918898741359292,0.2006586203505023,-0.7696073576885525,-0.05279312841044814,0.5373746999831381,0.2523951957354895,-0.028202389865822797,0.43385196064275755,-0.4996143227790226,0.4857032886339985,0.27764350228633616,0.9428171505234808,0.6296235226871916,-0.1858049863899245,0.9371252726842323,-0.9135650188200597,-0.41237017467667836,0.9128104253747085,-0.687487702802233,-0.10236984822755435,0.6899239836266897,0.12692944128335748,-0.15574249823040032,-0.5745620207026056,0.021226860826867977,0.1297653451470333,0.6940394966322199,0.15399208645789897,-0.835298659594585,0.6445439883597022,0.03128660696040675,-0.4649397820642467,0.7312930511055,-0.7257083459552203,0.0024184809253164907,0.27099233880913176,-0.22582479455902393,-0.18592813449962708,0.8105842586710992,-0.28789227575987986,-0.8026675946287236,0.06490680543514893,0.6332831701347315,0.8577059123271191,-0.5412978638935553,-0.729869976773277,0.1254957779451733,-0.22390031562084256,0.7042896363952005,0.665839851668121,-0.655354344582846,-0.6011693684647659,-0.6395064767001353,-0.5513731675499205,-0.015094122944423027,0.7462335804922742,0.448953032615641,0.16024194983793105,0.32992944079695685,0.7606843721583461,-0.16094422402063513,-0.7688461906839508,-0.1320794551764759,-0.49699378974056363,-0.9596158177513692,-0.4913240363384257,-0.27831375828057836,0.2753358457988966,0.2566663023947471,0.8882957982879056,0.24771095986624947,-0.9924376083291315,0.3647673089088812,0.7084194481208275,-0.5305530791966642,-0.5654672480503922,-0.760663565480689,-0.3015489475349844,0.8782003986771179,-0.11413424072837608,-0.1666425715000508,0.08675352907999767,-0.011197879145840473,0.021562338073556564,0.5770871771254134,-0.01813209775220681,0.5847712377429539,0.8312821234264598,0.3555280280933377,-0.8687413288117178,-0.1876189527185792,0.43150819360221915,0.4491136763014578,-0.5930478484611696,0.15936362644664892,-0.9676139357133395,-0.9399719437635055,-0.42985175132666775,0.6763722435783022,-0.789196446636035,-0.6176452724277193,-0.8386265378168645,-0.4822702141323463,-0.49948621195679266,-0.4915086386728562,-0.18341469943390254,-0.5556819334193668,0.27181694967062464,0.4080297554955101,-0.18280753355366985,0.9587182858792227,-0.3636735057308358,-0.3750170830721178,-0.2627210955755792,-0.7688673262984265,-0.5575807642782109,0.0878167946727384,0.4729118966503729,-0.8843932419367115,0.10146838442224593,-0.10917851528921685,-0.7100349590665442,0.24554836253349044,0.7252885371421649,0.699696395921277,0.17085644413438805,0.640238667436466,0.8653994671715144,0.8438901401929757,-0.6477753772069301,-0.941183492599218,-0.285212153687713,-0.9380535633163629,-0.5184046544545502,-0.6259031710479033,0.42561370667154996,-0.5733845456825151,-0.0882574030376615,0.5813604450036307,-0.8272998260242541,0.8709085509386818,0.9197281390754448,-0.789505067508542,-0.5389898315804746,0.4396011777985531,0.2600999895396625,-0.2966703830793833,0.16536907142553758,-0.7057014081236652,0.8542491549976179,0.6181753310886895,0.9962179096971207,-0.37853150267798985,0.3392961595011723,-0.8523509614709959,-0.8555897594783335,-0.9509705542272056,-0.1612648846919713,-0.7580727293730856,0.18122538588081327,-0.6248910474850935,0.5655641558372393,-0.015169031820265078,0.8921058801763324,-0.3524914284581726,0.03591591100217917,0.138734900480032,0.7419994150996032,-0.4747561359975685,0.24271968882247208,0.8725386143340044,-0.15866042311748152,0.23296908092555468,-0.6892761500766926,0.19164228068645106,0.6059694588267888,0.14152242334644316,-0.3507686556458871,0.9986430379441331,0.6058301885834141,-0.14246074709546197,-0.6491582146508268,0.6749263139516533,-0.8761471038877648,-0.5809924750073361,0.5757435858292042,-0.07849792673062761,-0.2108111560618413,0.0016876749497878318,-0.9624906828989548,-0.933784505836436,-0.20280857662860718,-0.7316046502506235,-0.3323321024898629,0.9024537394484313,0.4187787174673039,-0.7770985424229022,-0.13612675352317827,-0.29343654730868196,-0.28817038547458584,-0.893061516380613,0.06064112881484229,0.37357577504800044,0.14978692119278536,0.7927924409240865,-0.29345148025462686,-0.04464628097826706,0.25754392553313266,-0.516677028793217,0.6404665084893122,-0.6396529214659261,0.5035911123253392,-0.37510160245431035,-0.8234618758682721,0.35666329608847325,0.940950188177637,0.10960966076624135,-0.32361145807859804,-0.46622899346562074,-0.7904775908730577,0.831276657430172,-0.15938835696640696,-0.5388860199142402,-0.4457567598458272,-0.1603927947657633,-0.8815780805880249,0.6148839004565958,0.5724143620415816,0.2762081862934749,0.3603906496076694,-0.22866234351403758,0.4129640361795148,0.22111592708560845,0.1206400125156275,-0.5203819521233264,-0.6714551908103403,-0.0063372312469214265,0.14795249201976435,-0.5803597536626723,-0.4067788881754588,-0.9969235264712362,0.7280283181296119,0.39299338641427295,-0.9687775738710036,-0.3491298590933276,0.07623662956262267,-0.2633974048110903,-0.6726883223063982,0.6948071077590432,0.169027692738275,0.8359509999894794,0.40841046132181424,-0.05841726681111026,-0.8854692934910879,0.8416038024276769,-0.27259912862521474,0.5752316659488457,0.26664917964076307,0.3509525936039788,0.6599890063739953,0.36383131271366187,-0.8839800536454732,0.8039962181268956,0.44346741481225105,0.6101880552559966,0.2288022611167546,0.9569314829623259,0.9270193119194379,-0.7848858414046804,-0.03627116446526646,0.6417136162555308,-0.8160018913715956,0.16746003233181272,-0.5346077879294737,0.6071310502556355,0.29448667451394894,-0.3824318503404609,-0.5226153828721452,-0.5426622759539748,0.8256891203882484,0.022951039172488308,0.7649125454036205,-0.1471512874223957,-0.26482477118396996,0.6038380548060966,0.15029246313158584,0.09523366296859681,0.47311231819456134,-0.3994365372052544,-0.29244522496444314,0.8892008832938394,-0.5136439548147618,-0.40506751459673906,-0.008018179123215674,0.41210977899123025,-0.6855876788396147,0.46129844992386926,-0.05358407537466925,0.9149863536761869,-0.6100064472067679,0.252048482243745,0.6465372341400482,-0.6667591215738655,0.6138834270533597,0.3240915913258673,0.9647086075937263,0.5696673150762119,0.10241167956150043,-0.9955289415665347,0.37859904200438543,-0.8401514432128474,0.6465244582174416,0.3864363473734975,-0.35944759826985817,0.14916909722941574,0.30432397433882774,0.4208822136593833,-0.8319708975878672,-0.40225813365139973,-0.4565637554319466,0.4984839464912125,0.7896784660530913,-0.3099089982334493,0.3838551476282721,-0.6923654224726763,0.40275870696524607,-0.6299736586876117,-0.954588076941794,-0.7173916693948108,-0.5824297946741779,-0.16711551512534206,0.6187110855095885,-0.13812292008666227,0.4343251472179044,0.14016851744037595,0.9173092985863283,-0.9366328180203991,0.5180530831823316,-0.47974861987135387,-0.32362273487781246,0.26172210602604795,-0.6195216692461922,0.5250820025129217,0.2237857696125809,0.17378148910793967,0.5757874336668878,0.5496473236905066,-0.8660629956651167,-0.3408711937830793,0.7008118353941193,-0.6444414383725363,0.7304836518746363,0.7029059949360568,-0.6157346453551957,0.5485325345259986,-0.9011119396509821,-0.6824288439228876,-0.7591985636749898,0.13394399137021784,0.8085735213531298,0.3799354015702401,-0.17102932191178022,-0.13435056813510382,0.9784796041913222,0.20629803001087454,-0.1237461371319788,-0.44279783539233675,-0.9907404024532638,-0.27083920401318373,0.5429476440813845,-0.7239081499139044,-0.3156955007938682,0.4176862684864888,-0.11538826634549948,0.34880988353404785,0.017968382912178393,-0.5834138637376123,0.2378019068493702,0.8782747232923036,-0.686655033282966,0.9884631835448539,-0.572989485502474,0.18431383913299437,-0.4820875647544587,0.9568380738553908,0.26563339806933306,-0.28551670120771777,0.6714801196481006,-0.27015091839462135,-0.3723151062001755,-0.5139219319232669,0.2797366211398977,0.7728206018562274,-0.5061278128463591,0.4799794982869008,0.569026626150342,0.22445028319244864,0.6185206312043463,-0.23842443285835868,-0.495400810702185,-0.9207284402709794,0.802263777354822,-0.5455383985725855,-0.7551343499197396,-0.7730811026744582,-0.17303105311790246,-0.646203340804419,-0.8888466498939358,-0.3877274434876876,-0.6025206500606328,-0.4632975606127552,0.9858689148839153,0.32554309758959676,-0.3640555233375009,-0.29200327539210313,-0.446183369325134,-0.47329392420250405,0.3060830055708055,0.8179117893942152,0.07351567823308058,-0.5159292258291355,-0.9445018853352356,0.922874337368734,-0.5217829693484426,-0.5311751910841784,0.2986102755036577,0.9110621595499431,0.5243660894603166,-0.4476070816377635,0.5916933932619213,-0.8415883673860756,0.9450385732715956,-0.6368916951699279,-0.22995397699593734,-0.5294236935404351,0.33167573443198006,0.9889178281720807,-0.6308868591186909,0.729560858344388,0.219676282949669,-0.32822961992607236,-0.6835159936306021,0.07480332465051798,0.24722789734069273,0.34054934289339545,0.23673566572416083,0.3094293600582181,-0.8276884700752525,0.8511608225256457,0.26235486436359934,-0.7734519329249894,0.5507439868132349,0.4405553780875735,-0.2553890579319573,0.5141772638444557,-0.10894526258862358,0.30763546945991616,-0.21537242556356095,-0.9988075240869023,-0.7541232694955398,-0.6513781919949766,0.21546290052435024,-0.34331987979090894,-0.9973657977212458,0.02509175198777247,-0.2129788263597132,0.4541628546744312,0.8050667602900852,-0.2861138710361544,-0.5468493657606543,-0.3125526391807356,0.608135102449477,0.6109446064273436,-0.5076147204103165,-0.9951232853590226,-0.43382523544129126,-0.5152912059144263,-0.2133564458381818,-0.6752026885085407,0.9700658823468233,-0.31595564925387576,-0.6499217621527538,-0.29340740440518287,-0.5456201958471023,0.9335505046431831,0.26162291241925706,0.6883559718671306,-0.44600838156916534,0.5892258689066021,0.7320642190885338,0.9514287234061287,0.04278508344916321,-0.05442330787158012,-0.02729356671566574,-0.3800802322620149,-0.08905211665944268,-0.29252210088950803,0.6037136049758633,0.6538711292540109,0.595204094147227,0.8000275730628785,0.7695361087817254,0.1069220427336044,-0.3535311913717878,0.583144018098144,-0.7208859875995133,0.48616309397337254,0.6830503342599339,0.06586770233143846,0.6286034297491709,-0.9270032524224945,0.06442140043003874,0.5769838141074348,-0.13896490607289325,0.17201891871480246,-0.3315899067280106,-0.7599168814019523,-0.6325352590453572,-0.03261791159722094,0.9242792728492513,-0.13859872028999587,0.029741449423329236,-0.5038478798582455,0.7678585464411678,0.6019916349810523,0.6814004844556789,-0.8790220664617285,0.8168474878346796,0.5958473325159057,-0.6333571637289792,-0.1101661346228584,-0.4370471644808005,-0.29238478762424447,0.8098013222008875,-0.2722841965053153,0.8783056494421164,0.6618209990944466,-0.7337254144493874,-0.051971858740536,-0.38774816641351206,0.9588204073784294,-0.958752489285329,-0.42087087739827744,-0.45143630148973424,-0.24445300777288614,-0.07174377179070657,-0.7775528350137011,0.734484935720618,-0.07977860279315951,0.08409085424093021,0.004638665643866169,0.9976144256842712,-0.3878382910216134,-0.4359743798213167,-0.4734162276759808,-0.12874652529594433,-0.6941921622217493,-0.14471014697706708,-0.6444141696430412,-0.7180876096301769,0.8301341657100534,-0.7056859663984723,0.6036355691936255,0.19682888641695717,-0.641002832801979,0.4334363683499176,-0.3033074867137908,-0.5318793008071325,-0.4822328771890907,0.37188673020079066,0.8703240634193745,0.012637748077096944,0.5144706054418506,-0.5871167898458045,0.7859766718087986,0.28887013905201453,-0.9245181574356853,-0.9018725350492303,-0.8274218128429198,-0.7850019196886004,0.9292077282604085,-0.6278546967297716,-0.6320900264291733,-0.1272713942235617,0.19567137719511862,-0.5466686944846504,-0.9201889449170526,0.12215600122947556,0.8088763962639747,-0.1275194910497488,0.26029028422818046,-0.11707003032226604,0.49966900415754156,0.8514716806259546,-0.08351349844335054,0.300754438690056,0.25023448314415697,0.1394950045298431,-0.9405738190553405,-0.7505200077496434,0.6685364392354747,0.6130904921165188,-0.8758619738263658,-0.9639798886880411,-0.822532901488026,0.29213187486963466,0.48121138491456383,-0.7700670213971064,0.9175232763740517,0.878757540044476,-0.707696405366796,0.36529894899741344,0.6795407756908511,-0.6925795813614637,-0.7081976197184476,0.37603886180435797,0.9687634941701417,-0.6214045266228003,0.701773302012705,0.06591229573630031,-0.884443534961491,-0.1471254442526353,-0.5832702830266321,0.9294398373722006,0.7119931823663619,0.8993987634578147,0.14584602160292937,-0.024710603081718796,0.09786264554162027,-0.7853481038422563,-0.025274254165248866,-0.24569143463706467,-0.9253898417246611,0.7844777532477132,-0.9485078471373725,-0.38830586951435153,0.6446929632813483,0.32962237485414914,0.30615743857737976,-0.22959159708261168,-0.37601629947431037,0.3205569103582675,0.1581736656267343,0.2939736326405116,-0.1402475455210639,-0.7117657314205708,-0.09100053070033742,0.6399404990138415,0.07855095060817208,-0.471365083926806]
    #     }
    # ]
    # milvus_retrieval.insert_data_partition(data=data, partition_name="test_partition_04")

    # 搜索分区数据
    # data = [[-0.5966634064089733,0.4998302342637706,0.8454105960003133,-0.4261354389047105,0.14444856158504127,-0.9217872969077596,-0.7619084547173172,0.8077965055760354,0.6039520110824101,-0.6914908568233822,-0.6842414719025995,0.32730932404919577,0.19735534434553537,0.17702611587421702,0.5574640369073729,0.7039867533647071,0.8865118876598337,-0.8922317871914904,0.8363244627857576,0.7956191130350283,0.6547978634697447,-0.33029382888440995,-0.31597572389524364,0.941748469011342,-0.5246755802441196,0.715933127902038,-0.4825090522448694,0.5359973409884915,0.07496846114639966,0.8043626647365094,0.8451398393957179,0.3881382050722466,0.8184341384706684,-0.43842488367839305,0.32401158143769426,0.6213622525306639,-0.4362750630964931,-0.7381327069490307,0.5799941339186168,0.09126436946163685,0.9489849040486034,0.6833462269934778,-0.8299064532879321,0.6173751518517423,0.7948528174268537,-0.06993819018708547,-0.6682330273597106,0.8694652504896423,-0.5816285149435245,-0.41208586824402804,0.6447359227522436,-0.02005056355831103,0.8234669755004365,-0.7784487839035754,0.7111615172144989,0.5350819630622161,-0.49234178888072044,-0.8116180485820084,0.15479967255746052,-0.27375945181736405,0.7033427659713978,0.9532711724282068,-0.7914752470370707,-0.7254502965864973,0.38997196142455626,-0.6065369168317316,-0.011077979186943976,-0.15947581105238284,0.7585886283719221,-0.5820331394052323,0.38092740548794923,-0.4901960997095618,-0.49626724485096885,-0.5888963567714576,0.986805917678165,0.7937543180377391,-0.5749366964048759,0.3615790366370537,0.769090812695995,0.906220146078835,0.43385044342096046,-0.93208688192869,0.05665969528029402,-0.5643450331381943,0.07170877926770425,0.9819296856853499,-0.06026998147711704,-0.0011269327960206077,-0.05296473194952389,0.1818854956840914,-0.3010444406188577,0.3283602448007794,-0.07505375963254912,-0.0030461590480632683,-0.49116914347320284,-0.6410235951407932,0.7652585939171368,-0.02990703921129456,0.9999153337909934,-0.32137551877467185,0.18462527766232628,-0.2972008915736464,-0.4417932406975116,-0.7136866742478605,0.6051158189608468,0.17441000397090334,0.10668727045662307,-0.35052140519042596,-0.19826678772042605,0.8235678510814248,-0.3890262244488778,0.2755974566618804,-0.8909003768986143,0.133654924469784,-0.7157313972867692,-0.4260121032752813,0.8354831550910844,-0.4393330861772482,0.6769681831857879,-0.9043751362001857,0.0785735659670812,-0.8721011948354118,0.48483800562005563,0.20209175404017055,-0.19142705677250582,-0.9333353609473274,0.51695708537895,-0.5776402908251246,0.07315403937874243,-0.20323569388752039,0.613958833816965,-0.21629193965862736,-0.6403970140453061,-0.9211633502634333,-0.5790106434131554,0.5019434981246955,-0.4200130948868517,0.9472059858233728,-0.17003217166017293,0.6339411419108945,0.8778981958235101,0.6380263024725081,-0.259407658368497,-0.9836755934340013,-0.2291209256221607,-0.9161485181029003,0.08051142513992948,0.8637852018557681,0.940366709778929,0.22737768786065504,-0.8140653925480543,0.8815517894478442,0.7246931732929642,0.41992955753596917,0.3776318494418671,0.5280650166161716,0.22166169613741804,0.1809964604777068,0.9881515925916295,0.956098554573259,0.6017214973313123,0.9119269267753809,-0.09274392974249301,0.11629331992615954,0.2168487076684995,-0.7693982190990929,0.9120068853247438,-0.48802831979873407,0.270234029402449,0.6106004999793824,0.8547480851141573,0.043046384590756936,0.42679474105269066,-0.5051526394913122,-0.5561781073252987,0.5647013191212771,-0.7455788747265115,-0.9125682538250155,-0.6009717570797755,0.8434100421989945,-0.9496087738179437,0.28077431827597055,-0.41282913899459484,-0.231513501079458,-0.585079034678831,-0.7738287959453132,-0.6611485571345019,-0.6589772890537484,0.7281162931852587,-0.7693913847048934,0.3158821879148008,0.7153865329596352,-0.19652729274252634,0.8086687063080449,-0.712045282784538,0.24811970723776477,-0.31030638497217744,0.788738681037753,0.31906740160049574,0.5824441281551329,0.26234746448915036,-0.9831413371399629,0.9670424847543884,-0.7200015730618732,-0.5013895076617967,0.8570752521419462,-0.4881529062836587,0.08391870027956494,0.35523460032448306,-0.9247330550955899,-0.2939556393036329,0.390308765688939,0.8055210704031985,-0.6126833579255082,-0.7209955713627954,-0.8713413725911523,0.0016945495239912844,0.9522341536980474,-0.34569841579673843,-0.9009685210387552,0.9347759656257986,0.7607828953722311,-0.5230338386312181,-0.7876689871072182,-0.736837755072377,0.9877443460544459,0.6012838972013403,-0.25240017107181334,0.24502039582833524,-0.8603780678225843,0.2503087166687459,-0.758561624134191,-0.7923724001328751,0.7444285615189681,-0.9777800475993941,0.9489822763532085,-0.5883852178867623,0.6566924368084086,0.19799856203578026,0.7028685880965093,-0.8532733603872193,-0.5361476293429068,0.7757503018039704,0.7512707406153272,-0.04456535977478793,-0.8840016057226874,0.5504219705645712,-0.8210171193953861,0.5212383513229144,0.7080862195533488,0.5879684662520739,0.3719842905416606,0.5587438714527231,0.7993166542929648,-0.3118448569844061,-0.7660281463514418,0.9886428217423802,-0.5494018573990858,0.32177323620931686,-0.9306739736481786,-0.33776672964522825,-0.6289690670210173,0.9238988259159049,0.9576489870115081,0.12605478795611869,0.8147319733091463,-0.9491098566733169,0.93411603721243,0.420423889446887,0.31209122335280326,0.48058554945782417,-0.007493462352735847,0.7176279678184823,-0.8760133696323318,-0.17833851220098929,-0.20249788631177346,0.14473131497243763,0.5813179031074103,0.13635878112943223,0.7479670139565848,0.8852814056453497,0.3330959521686032,0.4405762570052334,-0.633803520202078,0.08034475613058034,-0.8768409540866602,-0.41864893286973404,0.777008758140715,0.03696490565817334,-0.5038888701104347,-0.5289452256744396,0.21954832963237125,-0.4916058483373078,0.2501577714086938,0.8367704599699197,-0.2475145257393514,0.6404164472079918,0.9706642567721624,0.12788738027214497,0.34584162927746376,0.516371308300589,0.23662439031471472,0.8817035416854204,0.8470382312487257,0.3300463282933659,0.4192951805858176,0.31973694797158947,0.5131855117028548,0.9168121715573698,0.871145117853239,-0.9103498167201114,0.4693659017488867,-0.6960511703918841,0.2871113839592483,0.42639024824176963,0.3819480613199051,-0.305708247384634,0.783089660449904,0.2706023642393438,0.8488681818883901,-0.4307222679086309,0.26844660941256127,0.9870077617880331,0.5082746344231754,-0.8846069072152585,-0.8447412471858857,0.3461060379871559,0.6918734322271674,-0.6514091354329885,-0.43206689931829456,0.934521991076626,-0.4221423096456818,0.14991940665093217,0.4978428919507192,-0.25327681827795856,0.15542095081256146,0.5806274462663243,-0.163132700796498,0.5661001815934246,-0.17539968880156698,0.3308183134906584,-0.6124545422396239,0.7207331857194093,-0.5326536535217639,-0.38629040353229716,0.6006501580113632,0.3128365838538467,-0.1867945153404491,0.46089642408946885,0.41136260906646016,0.9591235322216805,-0.9094504100454843,-0.7576236874842219,-0.6807983165665663,0.6599758200790489,0.064717457695318,-0.7612898632729344,0.8517822127288899,0.695550302823013,0.1256090603015363,0.1374055771886713,0.32392439017482677,-0.058692199239702925,0.407009968153744,0.12618179468052637,-0.9309305201557754,0.27103780786876186,-0.8473737759615956,-0.08403356195853351,-0.3250140486636741,-0.2753459453049396,0.6586106660998381,-0.8078265999331644,0.2938246389780801,-0.8052720170735899,0.6324334459839023,0.0876949300404124,0.6640769763902121,-0.11519887825618325,-0.3014437148936169,-0.6872647656612763,-0.9417376171229241,-0.2072790364746675,-0.18568128048503318,0.9567888846123618,0.8377965394559754,-0.6167753358152741,-0.6373295169340616,0.058895304475401034,0.661861466902623,-0.20971131867742088,-0.8442424275726275,0.47596750674032506,0.06855700940168541,0.7340778508245684,0.2908393368141218,0.4341653583972038,0.5065927554063634,0.8246292516064917,-0.6263585849795452,0.19307182483302276,0.4632938950127343,-0.5187826455287439,0.3857444303319144,0.977219723338359,-0.12630468208307932,-0.07268751338666757,0.6869115709798583,-0.9627941368288546,0.5954543731075506,0.08725397318180006,-0.39617264191078316,0.47985709925977793,0.14156472256590713,-0.9373988001093287,0.3220565168936811,-0.1455953908970371,-0.04332118369947335,0.8578306400620763,0.7344256573273362,-0.3529810929422863,0.16286627892560657,-0.5852937841752095,0.38319658355710917,-0.2517463806701734,-0.8871707829307005,0.8576582681231888,0.146617791787377,-0.3421291061929155,-0.4487010385336767,-0.49969509321627115,0.21324567769013814,0.11614448871518901,0.10830866036301523,0.4114939899424217,0.736307756508416,-0.3999092864077265,-0.8617126670163806,0.49570089877242474,0.31216036225520316,0.38786609020436913,0.2727696811573632,0.46754288200801586,0.3520342728438932,-0.26009532442421124,0.7401473540726111,-0.817151649809275,-0.8279607757760419,-0.6027280092773426,0.3269335734134453,0.18064615503313752,0.31771701672290753,0.30831238678808615,-0.31336581233756755,-0.22254015827334195,-0.27052702724167865,0.4302964347619955,0.8977918815610275,0.03287786078154742,0.8443652500062049,-0.9773676134044293,-0.8600041898355681,0.029195746581676563,-0.6328269458556035,0.232906900929424,-0.6176894987472836,-0.8950662619354455,-0.9750203417546848,-0.2688002280946329,-0.934704178484655,0.8790239372288202,0.44130532091483965,-0.14431245641700485,0.7488440960528038,-0.4976953466763452,0.8193249279783741,0.10860848575180992,-0.7511744296474656,-0.39040584256500344,0.7464686475838995,-0.767394489625866,0.25487839581314664,-0.35476274511026373,-0.9800769930655839,-0.4817868199293738,-0.31477858418097626,0.6247491720749636,0.1536378982676132,0.696643034613996,0.164213474866715,-0.008284297541513608,-0.3974808477405678,-0.09712366537211636,-0.44215158393287424,0.4416456642932012,-0.30067646461797426,-0.9169788353187571,0.022172784140992885,-0.3424114964067555,-0.14958919778014335,0.937599176750973,0.6593821925630898,0.8323027834629315,-0.9254981240745843,0.8473413570921333,0.35936916892950355,-0.5539813082739091,-0.8648970177267175,0.7313621137205335,-0.26638208896194304,-0.835794989814316,0.3144290164553214,-0.7190771248197181,0.8599802668208001,0.7199059244602766,0.46963087827526695,0.3119327866651076,-0.7708128744875518,-0.06323489913898217,-0.08818822074036459,-0.44603673699240054,0.8319439411966267,-0.8076037965145713,0.9460920582473489,-0.32118107243796157,-0.8594464718998767,0.6783703663337728,0.8051326182715874,0.25012470828160405,0.14988802165423154,-0.50623516472561,0.6125152158761511,-0.3455965530833378,0.5615546579277138,-0.09708776773189975,-0.658927170430402,0.031408656804921,-0.12596672874362103,-0.5580255498168298,-0.009689283358359946,0.9851253674760874,-0.8740267377714708,-0.03856859924610867,0.7281691923852889,-0.4288593910034404,-0.675230354377595,-0.9816816180845995,-0.10604595654878213,0.9843750762947376,0.6557391415378129,0.8802267959719117,-0.70915519607802,0.2506862341309841,-0.6642519479171913,0.4651921707009685,0.9131908876361472,0.6892199128103587,-0.6220446519942942,0.7824253005471935,-0.494330785786123,-0.298273690207125,0.9713751881336459,-0.286727819823563,0.7778373703867323,0.49499110262901436,-0.5060105405793127,0.4670233395846759,-0.8892426879776141,0.540472682276051,0.09228770629635363,0.8756219734732449,0.5366692535441704,-0.3977967661467936,0.1073297502741728,-0.4379878815948677,0.7645915172050819,-0.15566616203025863,-0.1038511125460222,0.8779213372588266,0.6651396169106845,0.8471332344989342,0.3978913065084684,-0.24159476141764524,0.8938098732016648,0.7383871867965488,0.9570417059952583,-0.26058423649155316,0.33888056531268496,-0.04283136656952169,0.5607396140733445,-0.4541867008161189,0.5379225835324786,-0.11718337724608019,0.8148687749399413,0.9591655309061353,0.41351213203642145,0.08158595202115526,-0.813211577616967,0.3670371343794292,-0.5009489618210368,0.4960425587780575,0.44507918852051187,0.3698939777598691,-0.8717471476301457,0.9137148005767319,-0.3727266434170644,0.15638357390346558,-0.8949413333493383,0.04830955713652196,-0.43796297749121926,-0.2467599403934697,0.019995271582455176,0.4758937126149423,0.5160211915037018,-0.524096944670152,-0.12475750383825646,0.08119263408831356,0.612740455590846,-0.3133078872327659,-0.63710732192924,0.1600971165367484,0.7941658945374084,0.16791498911968272,-0.2577335806739043,0.9106171103505756,-0.7953556278932987,-0.5738026182273321,0.071875659368702,0.05990073953451125,0.9591784618998109,-0.28034949754026006,0.6707837263700052,-0.19003251514066255,0.26439264003342067,-0.8683121702188656,-0.8744346257392939,-0.14486431101955533,-0.06240722687102096,0.009483458042991888,-0.23928700884337406,0.8556680285395821,-0.708005293381895,0.5941495092036053,-0.9895802385077661,0.7568514731561959,0.45943956376648987,-0.4350567570462536,0.5230829334859433,-0.33067813399513435,-0.9245436879049431,-0.6042289035235193,0.528986748641231,0.3831624222742671,0.4481921155134203,-0.012138573777447093,0.586326707611609,0.4821919601537601,-0.0663852567276777,-0.3651083709633052,-0.2308853028749902,-0.4783700798385624,-0.8172332843893373,-0.7572935056480796,-0.22280176766415583,-0.5493575129048287,-0.3637624935823853,0.5991531259885532,-0.9216651616432636,0.30210921412101976,0.7993417609046249,-0.3255150427869473,-0.33419101805148443,0.9525809060583692,-0.8606039234933318,0.03914103381976197,-0.2454612134613512,-0.7896964278329377,-0.2348031928607599,-0.3161272126005976,-0.8420072506203959,0.02194271039893292,0.46880647666070363,0.5978566725307204,-0.8496188960860254,0.5880301235397496,-0.4824124822236331,-0.16951408845929916,-0.7343077373775304,0.7889322404657166,0.4187392557507923,-0.4997152788638417,0.6400232045545204,-0.17067137049359848,0.2000856760995915,-0.6471019128235558,0.8701841082654935,-0.5485663283092777,-0.6876218774504197,0.9968752163823154,0.8499250114315218,-0.729691923776111,0.5294441023608711,0.2791092978502787,-0.25150130249416414,0.7050291274692317,-0.44784300193260895,0.11519078885807743,0.09557780111153491,0.9176918615335392,0.6752895904632827,0.3242409502971595,-0.5272852469368088,-0.2872624180062311,-0.46787490349662764,0.290933613687719,0.025498015328682344,0.12536794689614084,-0.6825802853492953,0.6766590384346136,-0.38340763830574853,-0.8960723784973288,0.6520206092742133,-0.9640651574615373,0.03314193154389922,-0.6380311753937999,-0.1251711358642258,0.8328883265734022,-0.7906188824036176,-0.12803456230759291,0.2996723982148979,0.6506712734210047,0.39130728931509173,-0.7003311260010587,-0.9643651369776753,-0.18157231506162774,-0.36050800151243023,0.6878543577327969,-0.9929282600174791,-0.1904615927943818,-0.8988092749329086,-0.6238556314629653,-0.11196406357792399,0.6226590620564749,-0.014362835422729425,0.2970723245841784,-0.41770184014770484,0.5965636595861581,0.32288815559019945,-0.3706606127759502,0.9595983719284007,-0.8594988213515853,-0.6242110954203974,0.33911287131460943,0.5391102076643082,-0.5393343841810099,-0.7889660728089141,-0.7655168091145017,-0.30817828032214734,0.23803618799192128,0.24028575200136792,0.4798394201032292,-0.9684292407511759,-0.15739843414444477,-0.5878246906922879,-0.9398841070052251,0.3021883842395119,-0.058915117318727894,-0.7561366364649937]]
    # milvus_retrieval.search_data_partition(data, partition_name="test_partition_05")


    # 删除分区
    # milvus_retrieval.drop_partition(partition_name="test_partition_04")

    # 查询分区
    # res = milvus_retrieval.get_partition()
    # print(res)