import{k as T,x as F,d as V,a as f,o,c as d,e as t,b as s,f as h,g as r,t as u,i as b,r as x,q as D,y as Y,h as U,u as H,z as K,A as Z,B as ee,_ as q,w as L,F as N,C as P,D as te,G,H as R,I as j,s as ne}from"./index-MVknvJjp.js";/* empty css                                                                       */import{_ as le}from"./IndexView.vue_vue_type_script_setup_true_lang-Cd9xcGO1.js";const J=(e="",i=[],n=[])=>T.post("/api/rs/user_list",{word:e,wxids:i,labels:n}).then(l=>l).catch(l=>(console.log(l),"")),A=()=>T.post("/api/rs/user_session_list",{}).then(e=>e).catch(e=>(console.log(e),[])),W=()=>T.get("/api/rs/mywxid").then(e=>e.my_wxid).catch(e=>(console.log(e),"")),oe=()=>T.post("/api/ls/realtimemsg",{}).then(e=>(console.log(e),F({title:"Success",message:"获取实时消息成功!",type:"success"}),!0)).catch(e=>(console.log(e),F({title:"Error",message:"获取实时消息失败!",type:"error"}),!1)),se=e=>T.post("/api/rs/msg_count",{wxids:e}).then(i=>i).catch(i=>(console.log(i),"")),O=e=>se([e]).then(i=>i[e]).catch(i=>(console.log(i),0)),ie=(e,i,n)=>T.post("/api/rs/msg_list",{start:i,limit:n,wxid:e}).then(l=>l).catch(l=>(console.log(l),"")),re={key:0,style:{"max-width":"560px"}},ae=t("br",null,null,-1),ce=t("br",null,null,-1),de=t("br",null,null,-1),ue=t("br",null,null,-1),_e=t("br",null,null,-1),he=t("br",null,null,-1),fe=t("br",null,null,-1),pe=t("br",null,null,-1),ve=t("br",null,null,-1),me=t("br",null,null,-1),ye=t("br",null,null,-1),xe=t("br",null,null,-1),we=t("br",null,null,-1),ge=t("br",null,null,-1),$e=t("span",null,[r("朋友圈背景："),t("br")],-1),be=["src"],ke={key:1},Ee=t("br",null,null,-1),Se=t("br",null,null,-1),Ue=t("br",null,null,-1),Ve={key:0},Me=t("br",null,null,-1),Ce={key:1},Be=t("br",null,null,-1),Te={key:2},Ie=t("br",null,null,-1),Le={key:3},qe=t("br",null,null,-1),ze={key:4},He=t("br",null,null,-1),De={key:5},Ne=t("br",null,null,-1),Re={key:6},je=t("br",null,null,-1),Oe={key:7},Fe=t("br",null,null,-1),Pe={key:8},Ae=t("br",null,null,-1),We={key:9},Ke=t("br",null,null,-1),Ge={key:10},Je=t("br",null,null,-1),Xe={key:11},Qe=t("br",null,null,-1),Ye=["src"],X=V({__name:"UserInfoShow",props:{userinfo:{type:Object,default:()=>({})},show_all:{type:Boolean,default:!0,required:!1}},setup(e){return(i,n)=>{const l=f("el-divider");return e.show_all?(o(),d("div",re,[t("div",null,[s(l,{"content-position":"center"},{default:h(()=>[r("基本信息")]),_:1}),t("span",null,[r("wxid："+u(e.userinfo.wxid),1),ae]),t("span",null,[r("账号："+u(e.userinfo.account),1),ce]),t("span",null,[r("昵称："+u(e.userinfo.nickname),1),de]),t("span",null,[r("备注："+u(e.userinfo.remark),1),ue])]),t("div",null,[s(l,{"content-position":"center"},{default:h(()=>[r("个人信息")]),_:1}),t("span",null,[r("性别："+u(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),_e]),t("span",null,[r("手机："+u(e.userinfo.ExtraBuf.手机号),1),he]),t("span",null,[r("标签："+u(e.userinfo.LabelIDList.join("/")),1),fe]),t("span",null,[r("描述："+u(e.userinfo.describe),1),pe]),t("span",null,[r("个签："+u(e.userinfo.ExtraBuf.个性签名),1),ve]),t("span",null,[r("国家："+u(e.userinfo.ExtraBuf.国),1),me]),t("span",null,[r("省份："+u(e.userinfo.ExtraBuf.省),1),ye]),t("span",null,[r("市名："+u(e.userinfo.ExtraBuf.市),1),xe])]),t("div",null,[s(l,{"content-position":"center"},{default:h(()=>[r("其他信息")]),_:1}),t("span",null,[r("公司："+u(e.userinfo.ExtraBuf.公司名称),1),we]),t("span",null,[r("企微："+u(e.userinfo.ExtraBuf.企微属性),1),ge]),$e,e.userinfo.ExtraBuf.朋友圈背景?(o(),d("img",{key:0,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{width:"180px","max-height":"180px"},alt:"朋友圈背景"},null,8,be)):b("",!0)])])):(o(),d("div",ke,[t("span",null,[r("wxid："+u(e.userinfo.wxid),1),Ee]),t("span",null,[r("账号："+u(e.userinfo.account),1),Se]),t("span",null,[r("昵称："+u(e.userinfo.nickname),1),Ue]),e.userinfo.remark?(o(),d("span",Ve,[r("备注："+u(e.userinfo.remark),1),Me])):b("",!0),e.userinfo.ExtraBuf["性别[1男2女]"]?(o(),d("span",Ce,[r("性别："+u(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),Be])):b("",!0),e.userinfo.ExtraBuf.手机号?(o(),d("span",Te,[r("手机："+u(e.userinfo.ExtraBuf.手机号),1),Ie])):b("",!0),e.userinfo.LabelIDList&&e.userinfo.LabelIDList.length>0?(o(),d("span",Le,[r("标签："+u(e.userinfo.LabelIDList.join("/")),1),qe])):b("",!0),e.userinfo.describe?(o(),d("span",ze,[r("描述："+u(e.userinfo.describe),1),He])):b("",!0),e.userinfo.ExtraBuf.个性签名?(o(),d("span",De,[r("个签："+u(e.userinfo.ExtraBuf.个性签名),1),Ne])):b("",!0),e.userinfo.ExtraBuf.国?(o(),d("span",Re,[r("国家："+u(e.userinfo.ExtraBuf.国),1),je])):b("",!0),e.userinfo.ExtraBuf.省?(o(),d("span",Oe,[r("省份："+u(e.userinfo.ExtraBuf.省),1),Fe])):b("",!0),e.userinfo.ExtraBuf.市?(o(),d("span",Pe,[r("市名："+u(e.userinfo.ExtraBuf.市),1),Ae])):b("",!0),e.userinfo.ExtraBuf.公司名称?(o(),d("span",We,[r("公司："+u(e.userinfo.ExtraBuf.公司名称),1),Ke])):b("",!0),e.userinfo.ExtraBuf.企微属性?(o(),d("span",Ge,[r("企微："+u(e.userinfo.ExtraBuf.企微属性),1),Je])):b("",!0),e.userinfo.ExtraBuf.朋友圈背景?(o(),d("span",Xe,[r("朋友圈背景："),Qe])):b("",!0),e.userinfo.ExtraBuf.朋友圈背景?(o(),d("img",{key:12,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{width:"180px","max-height":"180px"},alt:"朋友圈背景"},null,8,Ye)):b("",!0)]))}}}),Ze=e=>(Z("data-v-a26d5cf5"),e=e(),ee(),e),et={style:{padding:"10px 10px"}},tt={slot:"content",class:"tips"},nt=Ze(()=>t("br",null,null,-1)),lt={key:0,style:{color:"#909399","font-size":"12px"}},ot=V({__name:"ContactsList",emits:["wxid"],setup(e,{emit:i}){const n=x([]);D(async()=>{try{n.value=await A()}catch(m){return console.error("Error fetching data:",m),[]}});const a=x(""),_=async()=>{try{if(a.value===""){n.value=await A();return}console.log(a.value),n.value=[];const m=await J(a.value);m!==null&&typeof m=="object"&&Object.entries(m).forEach(([w,E])=>{n.value.push(E)})}catch(m){return console.error("Error fetching data:",m),[]}},p=i,v=m=>{m!==void 0&&m.wxid!==void 0&&p("wxid",m.wxid)};return(m,w)=>{const E=f("el-input"),y=f("el-button"),I=f("el-avatar"),C=f("el-table-column"),k=f("el-tooltip"),S=f("el-table");return o(),d("div",null,[t("div",et,[s(E,{placeholder:"请输入关键字",modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=g=>a.value=g),onKeyup:Y(_,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),s(y,{type:"primary",onClick:_,style:{width:"50px"}},{default:h(()=>[r("搜索")]),_:1})]),s(S,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:v},{default:h(()=>[s(C,{width:"57"},{default:h(({row:g})=>[g.headImgUrl!==""?(o(),U(I,{key:0,size:33,src:"/api/rs/imgsrc/"+g.headImgUrl},null,8,["src"])):(o(),U(I,{key:1,size:33},{default:h(()=>[r(" 群")]),_:1}))]),_:1}),s(C,{width:"190"},{default:h(({row:g})=>[s(k,{class:"item",effect:"light",placement:"right"},{content:h(()=>[s(X,{userinfo:g,show_all:!1,style:{"max-width":"600px"}},null,8,["userinfo"])]),default:h(()=>[t("div",tt,[t("span",null,u(H(K)(g)),1),r(),nt,g.nTime?(o(),d("span",lt,u(g.nTime),1)):b("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),st=q(ot,[["__scopeId","data-v-a26d5cf5"]]),it=V({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(e,{emit:i}){const n=e,l=x(0),a=x({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:{个性签名:"",企微属性:"",公司名称:"",国:"",备注图片:"",备注图片2:"",市:"","性别[1男2女]":0,手机号:"",朋友圈背景:"",省:""},LabelIDList:[]}),_=async()=>{try{const k=await J("",[n.wxid]);return a.value=k[n.wxid],a.value.wxid=n.wxid,k}catch(k){return console.error("Error fetching data wxid2user :",k),[]}},p=async()=>{try{l.value=0;const k=await O(n.wxid);return l.value=k,k}catch(k){return console.error("Error fetching data msg_count:",k),[]}},v=()=>{y.value=!1,_(),p()};D(()=>{v()}),L(()=>n.wxid,async(k,S)=>{k!==S&&v()});const m=x(!1),w=x(!1),E=async()=>{if(w.value){console.log("正在获取实时消息，请稍后再试!");return}w.value=!0;try{const k=await oe();return w.value=!1,k}catch{return w.value=!1,[]}},y=x(!1),I=i,C=k=>{I("exporting",k),y.value=k};return(k,S)=>{const g=f("el-text"),$=f("el-col"),M=f("el-row"),B=f("el-dialog");return o(),d(N,null,[s(M,{gutter:5,style:{width:"100%"}},{default:h(()=>[s($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[s(g,{class:"label_color mx-1",truncated:""},{default:h(()=>[r("wxid:")]),_:1}),r("  "),s(g,{class:"data_color mx-1",truncated:"",title:a.value.wxid},{default:h(()=>[r(u(a.value.wxid),1)]),_:1},8,["title"])]),_:1}),s($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[s(g,{class:"label_color mx-1",truncated:""},{default:h(()=>[r("名称:")]),_:1}),r("  "),s(g,{class:"data_color mx-1",truncated:"",title:"show_name"},{default:h(()=>[r(u(H(K)(a.value)),1)]),_:1})]),_:1}),s($,{span:5,style:{"white-space":"nowrap"}},{default:h(()=>[s(g,{class:"label_color mx-1",truncated:""},{default:h(()=>[r("数量:")]),_:1}),r("  "),s(g,{class:"data_color mx-1",truncated:"",title:l.value},{default:h(()=>[r(u(l.value),1)]),_:1},8,["title"])]),_:1}),s($,{span:2,style:{"white-space":"nowrap"}},{default:h(()=>[s(g,{class:"button_color mx-1 underline",truncated:"",onClick:S[0]||(S[0]=c=>m.value=!m.value)},{default:h(()=>[r(" 详细信息")]),_:1})]),_:1}),s($,{span:2,style:{"white-space":"nowrap"}},{default:h(()=>[y.value?b("",!0):(o(),U(g,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:S[1]||(S[1]=c=>{C(!0)})},{default:h(()=>[r("导出备份 ")]),_:1})),y.value?(o(),U(g,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:S[2]||(S[2]=c=>{C(!1)})},{default:h(()=>[r("聊天查看 ")]),_:1})):b("",!0)]),_:1}),s($,{span:3,style:{"white-space":"nowrap"}},{default:h(()=>[s(g,{class:"button_color mx-1 underline",truncated:"",onClick:S[3]||(S[3]=c=>{E()})},{default:h(()=>[r("实时消息 "),w.value?(o(),d(N,{key:0},[r("...")],64)):b("",!0)]),_:1})]),_:1})]),_:1}),s(B,{modelValue:m.value,"onUpdate:modelValue":S[4]||(S[4]=c=>m.value=c),title:"详细信息",width:"600",center:""},{default:h(()=>[s(X,{userinfo:a.value,show_all:!0},null,8,["userinfo"])]),_:1},8,["modelValue"])],64)}}}),rt=q(it,[["__scopeId","data-v-51a93461"]]),at={class:"chat-content"},ct={key:0,class:"word"},dt=["src"],ut={class:"info"},_t={class:"time"},ht=["innerHTML"],ft={key:1,class:"word-my"},pt={class:"info"},vt={class:"time"},mt=["innerHTML"],yt=["src"],xt=V({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,l)=>(o(),d("div",at,[e.is_sender?(o(),d("div",ft,[t("div",pt,[t("p",vt,u(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,mt)]),t("img",{src:e.headUrl},null,8,yt)])):(o(),d("div",ct,[t("img",{src:e.headUrl},null,8,dt),t("div",ut,[t("p",_t,u(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,ht)])]))]))}}),wt=q(xt,[["__scopeId","data-v-40672aa8"]]),gt={class:"chat-content"},$t={key:0,class:"word"},bt=["src"],kt={class:"info"},Et={class:"time"},St={class:"demo-image__preview"},Ut={key:1,class:"word-my"},Vt={class:"info"},Mt={class:"time"},Ct={class:"demo-image__preview"},Bt=["src"],Tt=V({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>{const l=f("el-image");return o(),d("div",gt,[e.is_sender?(o(),d("div",Ut,[t("div",Vt,[t("p",Mt,u(e.direction),1),t("div",Ct,[s(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,Bt)])):(o(),d("div",$t,[t("img",{src:e.headUrl},null,8,bt),t("div",kt,[t("p",Et,u(e.direction),1),t("div",St,[s(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),It=q(Tt,[["__scopeId","data-v-3e5fc52f"]]),Lt={class:"chat-content"},qt={key:0,class:"word"},zt=["src"],Ht={class:"info"},Dt={class:"time"},Nt={class:"demo-video__preview"},Rt={controls:"",width:"30%"},jt=["src"],Ot={key:1,class:"word-my"},Ft={class:"info"},Pt={class:"time"},At={class:"demo-video__preview"},Wt={controls:"",width:"50%"},Kt=["src"],Gt=["src"],Jt=V({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>(o(),d("div",Lt,[e.is_sender?(o(),d("div",Ot,[t("div",Ft,[t("p",Pt,u(e.direction),1),t("div",At,[t("video",Wt,[t("source",{src:e.src,type:"video/mp4"},null,8,Kt)])])]),t("img",{src:e.headUrl},null,8,Gt)])):(o(),d("div",qt,[t("img",{src:e.headUrl},null,8,zt),t("div",Ht,[t("p",Dt,u(e.direction),1),t("div",Nt,[t("video",Rt,[t("source",{src:e.src,type:"video/mp4"},null,8,jt)])])])]))]))}}),Xt=q(Jt,[["__scopeId","data-v-aa7dcebf"]]),Qt={class:"chat-content"},Yt={key:0,class:"word"},Zt=["src"],en={class:"info"},tn={class:"time"},nn={controls:"",style:{"background-color":"#fff"}},ln=["src"],on={key:1,class:"word-my"},sn={class:"info"},rn={class:"time"},an={controls:"",style:{"background-color":"#95EC69"}},cn=["src"],dn=["src"],un=V({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){return(i,n)=>(o(),d("div",Qt,[e.is_sender?(o(),d("div",on,[t("div",sn,[t("p",rn,u(e.direction),1),t("audio",an,[t("source",{src:e.src,type:"audio/wav"},null,8,cn)]),s(H(P),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),t("img",{src:e.headUrl},null,8,dn)])):(o(),d("div",Yt,[t("img",{src:e.headUrl},null,8,Zt),t("div",en,[t("p",tn,u(e.direction),1),t("audio",nn,[t("source",{src:e.src,type:"audio/wav"},null,8,ln)]),s(H(P),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),_n=q(un,[["__scopeId","data-v-c9969dce"]]),hn={class:"chat-content"},fn={key:0,class:"word"},pn=["src"],vn={class:"info"},mn={class:"time"},yn={style:{float:"left"}},xn=["href"],wn={key:1,class:"word-my"},gn={class:"info"},$n={class:"time"},bn={style:{float:"right"}},kn=["href"],En=["src"],Sn=V({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const i=e,n=x(""),l=te({file_name:String,file_size:Number,file_size_unit:String});D(async()=>{console.log("文件加载中");const _=await a(i.src);l.file_name=_.file_name,l.file_size=Number(_.file_size)/1024,l.file_size<1024?l.file_size_unit="kb":(l.file_size=l.file_size/1024,l.file_size_unit="mb"),l.file_size=Number(_.file_size)/1024,n.value=`/api/file/${i.src}`});const a=async _=>{try{return await T.post("/api/rs/file_info",{file_path:_})}catch(p){return console.error("Error fetching file_info:",p),""}};return(_,p)=>{const v=f("el-card");return o(),d("div",hn,[e.is_sender?(o(),d("div",wn,[t("div",gn,[t("p",$n,u(e.direction),1),t("div",bn,[s(v,{shadow:"hover",style:{width:"fit-content"}},{default:h(()=>[r("文件 ： "),t("a",{href:n.value,download:""},u(l.file_name),9,kn),t("div",null,[r(" 文件大小："),t("span",null,u(l.file_size)+u(l.file_size_unit),1)])]),_:1})])]),t("img",{src:e.headUrl},null,8,En)])):(o(),d("div",fn,[t("img",{src:e.headUrl},null,8,pn),t("div",vn,[t("p",mn,u(e.direction),1),t("div",yn,[s(v,{shadow:"hover",style:{width:"fit-content"}},{default:h(()=>[r("文件 ： "),t("a",{href:n.value,download:""},u(l.file_name),9,xn),t("div",null,[r(" 文件大小："),t("span",null,u(l.file_size)+u(l.file_size_unit),1)])]),_:1})])])]))])}}}),Un=q(Sn,[["__scopeId","data-v-d3aaee81"]]),Vn={class:"chat-content"},Mn={key:0,class:"word"},Cn=["src"],Bn={class:"info"},Tn={class:"time"},In={class:"demo-image__preview"},Ln={key:1,class:"word-my"},qn={class:"info"},zn={class:"time"},Hn={class:"demo-image__preview"},Dn=["src"],Nn=V({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>{const l=f("el-image");return o(),d("div",Vn,[e.is_sender?(o(),d("div",Ln,[t("div",qn,[t("p",zn,u(e.direction),1),t("div",Hn,[s(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,Dn)])):(o(),d("div",Mn,[t("img",{src:e.headUrl},null,8,Cn),t("div",Bn,[t("p",Tn,u(e.direction),1),t("div",In,[s(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Rn=q(Nn,[["__scopeId","data-v-4f39fede"]]),jn={class:"chat-content"},On={key:0,class:"word"},Fn=["src"],Pn={class:"info"},An={class:"time"},Wn=["innerHTML"],Kn={key:1,class:"word-my"},Gn={class:"info"},Jn={class:"time"},Xn=["innerHTML"],Qn=["src"],Yn=V({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,l)=>(o(),d("div",jn,[e.is_sender?(o(),d("div",Kn,[t("div",Gn,[t("p",Jn,u(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,Xn)]),t("img",{src:e.headUrl},null,8,Qn)])):(o(),d("div",On,[t("img",{src:e.headUrl},null,8,Fn),t("div",Pn,[t("p",An,u(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,Wn)])]))]))}}),Zn=q(Yn,[["__scopeId","data-v-3a49c7fd"]]),el={id:"chat"},tl={class:"chat_body"},nl={class:"chat_window",ref:"chatWindow"},ll={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},ol=V({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(e,{expose:i}){const n=e,l=x([]),a=x({}),_=x(!1),p=x(""),v=x(0),m=x(100),w=x(0),E=x(!1),y=async($,M,B)=>{if(_.value){console.log("正在获取消息，请稍后再试!");return}if(B==""){console.log("wxid 为空, 请检查!");return}try{_.value=!0,$<0&&($=0);const c=await ie(B,$,M);return l.value=c.msg_list,a.value=Object.assign(a.value,c.user_list),_.value=!1,c}catch(c){return _.value=!1,console.error("Error fetching data:",c),[]}},I=async()=>{try{p.value=await W(),w.value=await O(n.wxid),v.value=w.value-m.value,v.value<0&&(v.value=0),await y(v.value,m.value,n.wxid),E.value||await R(()=>{n.setScrollTop(),E.value=!1})}catch($){return console.error("Error fetching data:",$),[]}},C=()=>{l.value=[],a.value={},E.value=!1,w.value=0,v.value=0,I()};L(()=>n.wxid,($,M)=>{console.log("username changed： ",M,$),C()}),D(()=>{C()});const k=async()=>{p.value=await W(),w.value=await O(n.wxid);let $=m.value,M=v.value-$;M<0&&(M=0);const B=await y(M,$,n.wxid);v.value=M,console.log("loadMore",M,v.value,$,n.wxid),l.value=B.msg_list.concat(l.value),l.value.sort((c,z)=>c.id-z.id),l.value=l.value.filter((c,z,Q)=>z===0||c.id!==Q[z-1].id),a.value=Object.assign(a.value,B.user_list),await R(()=>{n.updateScrollTop()})};i({loadMore:k});const S=$=>($.talker=="我"&&($.talker=p.value),`${(B=>{const c=a.value[B.talker];return(c==null?void 0:c.remark)||(c==null?void 0:c.nickname)||(c==null?void 0:c.account)||B.talker})($)} [${$.type_name}] ${$.CreateTime}`),g=$=>($.talker=="我"&&($.talker=p.value),a.value.hasOwnProperty($.talker)?j(a.value[$.talker].headImgUrl):"");return($,M)=>{const B=f("el-button");return o(),d("div",el,[t("div",tl,[t("div",nl,[l.value.length<w.value?(o(),d("div",ll,[s(B,{type:"primary",onClick:k},{default:h(()=>[r("查看更多消息")]),_:1})])):b("",!0),(o(!0),d(N,null,G(l.value,(c,z)=>(o(),d("div",{class:"message",key:z},[c.type_name=="文本"?(o(),U(wt,{key:0,is_sender:c.is_sender,direction:S(c),headUrl:g(c),content:c.msg},null,8,["is_sender","direction","headUrl","content"])):c.type_name=="图片"?(o(),U(It,{key:1,is_sender:c.is_sender,direction:S(c),headUrl:g(c),src:H(j)(c.src)},null,8,["is_sender","direction","headUrl","src"])):c.type_name=="动画表情"?(o(),U(Rn,{key:2,is_sender:c.is_sender,direction:S(c),headUrl:g(c),src:H(j)(c.src)},null,8,["is_sender","direction","headUrl","src"])):c.type_name=="视频"?(o(),U(Xt,{key:3,is_sender:c.is_sender,direction:S(c),headUrl:g(c),src:"/api/rs/video/"+c.src},null,8,["is_sender","direction","headUrl","src"])):c.type_name=="文件"?(o(),U(Un,{key:4,is_sender:c.is_sender,direction:S(c),headUrl:g(c),src:c.src},null,8,["is_sender","direction","headUrl","src"])):c.type_name=="语音"?(o(),U(_n,{key:5,is_sender:c.is_sender,direction:S(c),headUrl:g(c),src:"/api/rs/"+c.src,msg:c.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(o(),U(Zn,{key:6,is_sender:c.is_sender,direction:S(c),headUrl:g(c),content:c.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),sl=q(ol,[["__scopeId","data-v-38b53442"]]),il=t("br",null,null,-1),rl=t("br",null,null,-1),al={style:{position:"relative"}},cl=V({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(_,p)=>{console.log(_)});const n=x(""),l=x(""),a=async()=>{l.value="请求中...";try{l.value=await T.post("/api/rs/export_endb",{wx_path:n.value})}catch(_){return console.error("Error fetching data msg_count:",_),l.value=`请求失败
`+_,[]}};return(_,p)=>{const v=f("el-input"),m=f("el-button"),w=f("el-divider");return o(),d("div",null,[r(" 微信文件夹路径(可选)： "),s(v,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=E=>n.value=E),style:{width:"70%"}},null,8,["modelValue"]),il,rl,t("div",al,[s(m,{type:"primary",onClick:p[1]||(p[1]=E=>a())},{default:h(()=>[r("导出")]),_:1})]),s(w),s(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":p[2]||(p[2]=E=>l.value=E),style:{width:"100%"}},null,8,["modelValue"])])}}}),dl=t("br",null,null,-1),ul=t("br",null,null,-1),_l=t("br",null,null,-1),hl=t("br",null,null,-1),fl={style:{position:"relative"}},pl=V({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(p,v)=>{console.log(p)});const n=x(""),l=x(""),a=x(""),_=async()=>{a.value="正在处理中...";try{a.value=await T.post("/api/rs/export_dedb",{key:l.value,wx_path:n.value})}catch(p){return console.error("Error fetching data msg_count:",p),a.value=`请求失败
`+p,[]}};return(p,v)=>{const m=f("el-input"),w=f("el-button"),E=f("el-divider");return o(),d("div",null,[r(" 密钥(可选)： "),s(m,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=y=>l.value=y),style:{width:"75%"}},null,8,["modelValue"]),dl,ul,r(" 微信文件夹路径(可选)： "),s(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":v[1]||(v[1]=y=>n.value=y),style:{width:"70%"}},null,8,["modelValue"]),_l,hl,t("div",fl,[s(w,{type:"primary",onClick:v[2]||(v[2]=y=>_())},{default:h(()=>[r("导出")]),_:1})]),s(E),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":v[3]||(v[3]=y=>a.value=y),style:{width:"100%"}},null,8,["modelValue"])])}}}),vl={style:{position:"relative"}},ml=V({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(a,_)=>{console.log(a)});const n=x(""),l=async()=>{n.value="正在处理中...";try{n.value=await T.post("/api/rs/export_csv",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,_)=>{const p=f("el-button"),v=f("el-divider"),m=f("el-input");return o(),d("div",null,[t("div",vl,[s(p,{type:"primary",onClick:_[0]||(_[0]=w=>l())},{default:h(()=>[r("导出")]),_:1})]),s(v),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":_[1]||(_[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),yl={style:{position:"relative"}},xl=V({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(a,_)=>{console.log(a)}),x([]);const n=x(""),l=async()=>{n.value="正在处理中...";try{n.value=await T.post("/api/rs/export_json",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,_)=>{const p=f("el-button"),v=f("el-divider"),m=f("el-input");return o(),d("div",null,[t("div",yl,[s(p,{type:"primary",onClick:_[0]||(_[0]=w=>l())},{default:h(()=>[r("导出")]),_:1})]),s(v),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":_[1]||(_[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),wl={style:{position:"relative"}},gl=V({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(a,_)=>{console.log(a)}),x([]);const n=x(""),l=async()=>{n.value="正在处理中...";try{n.value=await T.post("/api/rs/export_html",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,_)=>{const p=f("el-button"),v=f("el-divider"),m=f("el-input");return o(),d("div",null,[t("div",wl,[s(p,{type:"primary",onClick:_[0]||(_[0]=w=>l())},{default:h(()=>[r("导出")]),_:1})]),s(v),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":_[1]||(_[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),$l=t("br",null,null,-1),bl=V({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(l,a)=>{console.log(l)});const n=()=>{console.log("requestExport")};return(l,a)=>{const _=f("el-button");return o(),d("div",null,[t("span",null,u(i.wxid),1),$l,s(_,{type:"primary",onClick:a[0]||(a[0]=p=>n())},{default:h(()=>[r("导出")]),_:1})])}}}),kl=t("br",null,null,-1),El=V({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(l,a)=>{console.log(l)});const n=()=>{console.log("requestExport")};return(l,a)=>{const _=f("el-button");return o(),d("div",null,[t("span",null,u(i.wxid),1),kl,s(_,{type:"primary",onClick:a[0]||(a[0]=p=>n())},{default:h(()=>[r("导出")]),_:1})])}}}),Sl={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Ul={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Vl={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Ml=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Cl={style:{"margin-top":"20px"}},Bl=t("br",null,null,-1),Tl=t("br",null,null,-1),Il={key:0},Ll=V({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(e){const i=e;L(()=>i.wxid,(a,_)=>{console.log(a)});const n=x("");x("");const l={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(a,_)=>{const p=f("el-option"),v=f("el-select"),m=f("el-divider"),w=f("el-main");return o(),d("div",Sl,[s(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:h(()=>[t("div",Ul,[t("div",Vl,[Ml,t("div",Cl,[r(" 导出类型: "),s(v,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=E=>n.value=E)},{default:h(()=>[(o(),d(N,null,G(l,(E,y)=>s(p,{label:E.brief,value:y,key:y},{default:h(()=>[r(u(E.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Bl,Tl,n.value?(o(),d("span",Il,u(l[n.value].detail),1)):b("",!0)]),s(m),n.value=="endb"?(o(),U(cl,{key:0,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="dedb"?(o(),U(pl,{key:1,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="csv"?(o(),U(ml,{key:2,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="json"?(o(),U(xl,{key:3,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="html"?(o(),U(gl,{key:4,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="pdf"?(o(),U(bl,{key:5,wxid:i.wxid},null,8,["wxid"])):b("",!0),n.value=="docx"?(o(),U(El,{key:6,wxid:i.wxid},null,8,["wxid"])):b("",!0)])])]),_:1})])}}}),ql=V({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(e){const i=x(null),n=x(null);x(0);const l=x(0),a=()=>{R(()=>{if(i.value){const y=i.value.$el.children[0];y&&(y.scrollTop=y.scrollHeight,l.value=y.scrollHeight)}})},_=()=>{const y=i.value.$el.children[0];if(y){const I=l.value,C=y.scrollHeight-I;y.scrollTop=y.scrollTop+C,l.value=y.scrollHeight}};function p({scrollTop:y}){y===0&&n.value&&n.value.loadMore()}const v=e,m=x(!1),w=y=>{m.value=y},E=()=>{m.value=!1,R(()=>{a()})};return L(()=>v.wxid,async(y,I)=>{y!==I&&E()}),D(()=>{E()}),(y,I)=>{const C=f("el-header"),k=f("el-scrollbar"),S=f("el-main"),g=f("el-container");return o(),U(g,null,{default:h(()=>[s(C,{style:{height:"40px","max-height":"40px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:h(()=>[s(rt,{wxid:e.wxid,onExporting:w},null,8,["wxid"])]),_:1}),s(S,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:h(()=>[s(k,{ref_key:"scrollbarRef",ref:i,onScroll:p},{default:h(()=>[m.value?(o(),U(Ll,{key:0,wxid:e.wxid},null,8,["wxid"])):(o(),U(sl,{key:1,ref_key:"chatRecordsMainRef",ref:n,wxid:e.wxid,setScrollTop:a,updateScrollTop:_},null,8,["wxid"]))]),_:1},512)]),_:1})]),_:1})}}}),zl={id:"chat_view",class:"common-layout"},Hl={key:0,style:{height:"calc(100vh)",width:"100%"}},Dl={key:1,style:{width:"100%",height:"100%"}},Ol=V({__name:"ChatView",setup(e){const i=x(""),n=l=>{i.value=l};return D(()=>{ne().then(l=>{console.log("API version: "+l)}).catch(l=>{console.error("Error fetching API version:",l)})}),(l,a)=>{const _=f("el-aside"),p=f("el-container");return o(),d("div",zl,[t("div",null,[s(p,null,{default:h(()=>[s(_,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:h(()=>[s(st,{onWxid:n})]),_:1}),i.value!=""?(o(),d("div",Hl,[s(ql,{wxid:i.value},null,8,["wxid"])])):(o(),d("div",Dl,[s(le)]))]),_:1})])])}}});export{Ol as default};
