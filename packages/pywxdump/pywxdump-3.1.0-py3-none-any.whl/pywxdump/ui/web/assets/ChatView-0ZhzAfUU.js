import{k as q,x as j,d as M,r as w,q as N,b as v,o as s,c as u,e as t,a as o,y as J,f as d,j as p,g as S,t as y,F as H,h as E,w as z,_ as I,u as O,z as F,A as X,B as A,C as D,s as G}from"./index-uH07H8hv.js";/* empty css                                                                       */import{_ as Q}from"./IndexView.vue_vue_type_script_setup_true_lang-y_OkT-VL.js";const W=(e="",r=[],n=[])=>q.post("/api/rs/user_list",{word:e,wxids:r,labels:n}).then(l=>l).catch(l=>(console.log(l),"")),B=()=>q.post("/api/rs/user_session_list",{}).then(e=>e).catch(e=>(console.log(e),[])),P=()=>q.get("/api/rs/mywxid").then(e=>e.my_wxid).catch(e=>(console.log(e),"")),Y=()=>q.post("/api/ls/realtimemsg",{}).then(e=>(console.log(e),j({title:"Success",message:"获取实时消息成功!",type:"success"}),!0)).catch(e=>(console.log(e),j({title:"Error",message:"获取实时消息失败!",type:"error"}),!1)),Z=e=>q.post("/api/rs/msg_count",{wxids:e}).then(r=>r).catch(r=>(console.log(r),"")),R=e=>Z([e]).then(r=>r[e]).catch(r=>(console.log(r),0)),ee={style:{padding:"10px 10px"}},te={key:0},ne={key:1},le={key:0},oe={key:1},se=t("br",null,null,-1),ie={key:2,style:{color:"#909399","font-size":"12px"}},re=M({__name:"ContactsList",emits:["wxid"],setup(e,{emit:r}){const n=w([]);N(async()=>{try{n.value=await B()}catch(f){return console.error("Error fetching data:",f),[]}});const i=w(""),a=async()=>{try{if(i.value===""){n.value=await B();return}n.value=[];const f=await W(i.value);f!==null&&typeof f=="object"&&Object.entries(f).forEach(([$,b])=>{n.value.push(b)})}catch(f){return console.error("Error fetching data:",f),[]}},h=r,m=f=>{f!==void 0&&h("wxid",f.wxid)};return(f,$)=>{const b=v("el-input"),x=v("el-button"),T=v("el-avatar"),g=v("el-table-column"),U=v("el-tooltip"),k=v("el-table");return s(),u("div",null,[t("div",ee,[o(b,{placeholder:"请输入关键字",modelValue:i.value,"onUpdate:modelValue":$[0]||($[0]=c=>i.value=c),onKeyup:J(a,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),o(x,{type:"primary",onClick:a,style:{width:"50px"}},{default:d(()=>[p("搜索")]),_:1})]),o(k,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:m},{default:d(()=>[o(g,{width:"57"},{default:d(({row:c})=>[c.headImgUrl!==""?(s(),S(T,{key:0,size:33,src:"/api/rs/imgsrc/"+c.headImgUrl},null,8,["src"])):(s(),S(T,{key:1,size:33},{default:d(()=>[p(" 群聊 ")]),_:1}))]),_:1}),o(g,{width:"190"},{default:d(({row:c})=>[c.LabelIDList.length>0?(s(),S(U,{key:0,class:"item",effect:"light",content:c.LabelIDList.join(" "),placement:"right"},{default:d(()=>[c.remark!==null&&c.remark!==""?(s(),u("span",te,y(c.remark),1)):(s(),u("span",ne,y(c.nickname),1))]),_:2},1032,["content"])):(s(),u(H,{key:1},[c.remark!==null&&c.remark!==""?(s(),u("span",le,y(c.remark),1)):(s(),u("span",oe,y(c.nickname),1))],64)),se,c.nTime?(s(),u("span",ie,y(c.nTime),1)):E("",!0)]),_:1})]),_:1},8,["data"])])}}}),ae=M({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(e,{emit:r}){const n=e,l=w({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:"",LabelIDList:[]}),i=w(0),a=async()=>{try{const g=await W("",[n.wxid]);return l.value.wxid=n.wxid,l.value.account=g[n.wxid].account,l.value.describe=g[n.wxid].describe,l.value.headImgUrl=g[n.wxid].headImgUrl,l.value.nickname=g[n.wxid].nickname,l.value.remark=g[n.wxid].remark,g}catch(g){return console.error("Error fetching data wxid2user :",g),[]}},h=async()=>{try{const g=await R(n.wxid);return i.value=g,g}catch(g){return console.error("Error fetching data msg_count:",g),[]}},m=async()=>{b.value=!1,await a(),await h()};N(()=>{m()}),z(()=>n.wxid,async(g,U)=>{g!==U&&await m()});const f=w(!1),$=async()=>{if(f.value){console.log("正在获取实时消息，请稍后再试!");return}f.value=!0;try{const g=await Y();return f.value=!1,g}catch{return f.value=!1,[]}},b=w(!1),x=r,T=g=>{x("exporting",g),b.value=g};return(g,U)=>{const k=v("el-text"),c=v("el-col"),C=v("el-row");return s(),u(H,null,[o(C,{gutter:5,style:{width:"100%"}},{default:d(()=>[o(c,{span:6,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("wxid:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:l.value.wxid},{default:d(()=>[p(y(l.value.wxid),1)]),_:1},8,["title"])]),_:1}),o(c,{span:6,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("账号:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:l.value.account},{default:d(()=>[p(y(l.value.account),1)]),_:1},8,["title"])]),_:1}),o(c,{span:6,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("昵称:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:l.value.nickname},{default:d(()=>[p(y(l.value.nickname),1)]),_:1},8,["title"])]),_:1}),o(c,{span:6,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("备注:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:l.value.remark},{default:d(()=>[p(y(l.value.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),o(C,{gutter:5,style:{width:"100%"}},{default:d(()=>[o(c,{span:3,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("数量:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:i.value},{default:d(()=>[p(y(i.value),1)]),_:1},8,["title"])]),_:1}),o(c,{span:15,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"label_color mx-1",truncated:""},{default:d(()=>[p("描述:")]),_:1}),p("  "),o(k,{class:"data_color mx-1",truncated:"",title:l.value.describe},{default:d(()=>[p(y(l.value.describe),1)]),_:1},8,["title"])]),_:1}),o(c,{span:3,style:{"white-space":"nowrap"}},{default:d(()=>[o(k,{class:"button_color mx-1 underline",truncated:"",onClick:U[0]||(U[0]=V=>{$()})},{default:d(()=>[p("实时消息 "),f.value?(s(),u(H,{key:0},[p("(获取中)")],64)):E("",!0)]),_:1})]),_:1}),o(c,{span:3,style:{"white-space":"nowrap"}},{default:d(()=>[b.value?E("",!0):(s(),S(k,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:U[1]||(U[1]=V=>{T(!0)})},{default:d(()=>[p("导出备份 ")]),_:1})),b.value?(s(),S(k,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:U[2]||(U[2]=V=>{T(!1)})},{default:d(()=>[p("聊天查看 ")]),_:1})):E("",!0)]),_:1})]),_:1})],64)}}}),ce=I(ae,[["__scopeId","data-v-c84b3d5d"]]),de={class:"chat-content"},ue={key:0,class:"word"},_e=["src"],pe={class:"info"},he={class:"time"},ve=["innerHTML"],me={key:1,class:"word-my"},fe={class:"info"},ye={class:"time"},xe=["innerHTML"],we=["src"],ge=M({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const r=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,l)=>(s(),u("div",de,[e.is_sender?(s(),u("div",me,[t("div",fe,[t("p",ye,y(e.direction),1),t("div",{class:"info-content",innerHTML:r(e.content)},null,8,xe)]),t("img",{src:e.headUrl},null,8,we)])):(s(),u("div",ue,[t("img",{src:e.headUrl},null,8,_e),t("div",pe,[t("p",he,y(e.direction),1),t("div",{class:"info-content",innerHTML:r(e.content)},null,8,ve)])]))]))}}),$e=I(ge,[["__scopeId","data-v-40672aa8"]]),be={class:"chat-content"},ke={key:0,class:"word"},Se=["src"],Ue={class:"info"},Ve={class:"time"},Me={class:"demo-image__preview"},Ce={key:1,class:"word-my"},Ee={class:"info"},Te={class:"time"},qe={class:"demo-image__preview"},ze=["src"],Ie=M({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(r,n)=>{const l=v("el-image");return s(),u("div",be,[e.is_sender?(s(),u("div",Ce,[t("div",Ee,[t("p",Te,y(e.direction),1),t("div",qe,[o(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,ze)])):(s(),u("div",ke,[t("img",{src:e.headUrl},null,8,Se),t("div",Ue,[t("p",Ve,y(e.direction),1),t("div",Me,[o(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Le=I(Ie,[["__scopeId","data-v-3e5fc52f"]]),He={class:"chat-content"},Ne={key:0,class:"word"},De=["src"],Re={class:"info"},je={class:"time"},Oe={class:"demo-video__preview"},Fe={controls:"",width:"30%"},Be=["src"],Pe={key:1,class:"word-my"},Ae={class:"info"},We={class:"time"},Ke={class:"demo-video__preview"},Je={controls:"",width:"50%"},Xe=["src"],Ge=["src"],Qe=M({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(r,n)=>(s(),u("div",He,[e.is_sender?(s(),u("div",Pe,[t("div",Ae,[t("p",We,y(e.direction),1),t("div",Ke,[t("video",Je,[t("source",{src:e.src,type:"video/mp4"},null,8,Xe)])])]),t("img",{src:e.headUrl},null,8,Ge)])):(s(),u("div",Ne,[t("img",{src:e.headUrl},null,8,De),t("div",Re,[t("p",je,y(e.direction),1),t("div",Oe,[t("video",Fe,[t("source",{src:e.src,type:"video/mp4"},null,8,Be)])])])]))]))}}),Ye=I(Qe,[["__scopeId","data-v-aa7dcebf"]]),Ze={class:"chat-content"},et={key:0,class:"word"},tt=["src"],nt={class:"info"},lt={class:"time"},ot={controls:"",style:{"background-color":"#fff"}},st=["src"],it={key:1,class:"word-my"},rt={class:"info"},at={class:"time"},ct={controls:"",style:{"background-color":"#95EC69"}},dt=["src"],ut=["src"],_t=M({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){return(r,n)=>(s(),u("div",Ze,[e.is_sender?(s(),u("div",it,[t("div",rt,[t("p",at,y(e.direction),1),t("audio",ct,[t("source",{src:e.src,type:"audio/wav"},null,8,dt)]),o(O(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),t("img",{src:e.headUrl},null,8,ut)])):(s(),u("div",et,[t("img",{src:e.headUrl},null,8,tt),t("div",nt,[t("p",lt,y(e.direction),1),t("audio",ot,[t("source",{src:e.src,type:"audio/wav"},null,8,st)]),o(O(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),pt=I(_t,[["__scopeId","data-v-c9969dce"]]),ht={class:"chat-content"},vt={key:0,class:"word"},mt=["src"],ft={class:"info"},yt={class:"time"},xt={style:{float:"left"}},wt=["href"],gt={key:1,class:"word-my"},$t={class:"info"},bt={class:"time"},kt={style:{float:"right"}},St=["href"],Ut=["src"],Vt=M({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const r=e,n=w(""),l=X({file_name:String,file_size:Number,file_size_unit:String});N(async()=>{console.log("文件加载中");const a=await i(r.src);l.file_name=a.file_name,l.file_size=Number(a.file_size)/1024,l.file_size<1024?l.file_size_unit="kb":(l.file_size=l.file_size/1024,l.file_size_unit="mb"),l.file_size=Number(a.file_size)/1024,n.value=`/api/file/${r.src}`});const i=async a=>{try{return await q.post("/api/rs/file_info",{file_path:a})}catch(h){return console.error("Error fetching file_info:",h),""}};return(a,h)=>{const m=v("el-card");return s(),u("div",ht,[e.is_sender?(s(),u("div",gt,[t("div",$t,[t("p",bt,y(e.direction),1),t("div",kt,[o(m,{shadow:"hover",style:{width:"fit-content"}},{default:d(()=>[p("文件 ： "),t("a",{href:n.value,download:""},y(l.file_name),9,St),t("div",null,[p(" 文件大小："),t("span",null,y(l.file_size)+y(l.file_size_unit),1)])]),_:1})])]),t("img",{src:e.headUrl},null,8,Ut)])):(s(),u("div",vt,[t("img",{src:e.headUrl},null,8,mt),t("div",ft,[t("p",yt,y(e.direction),1),t("div",xt,[o(m,{shadow:"hover",style:{width:"fit-content"}},{default:d(()=>[p("文件 ： "),t("a",{href:n.value,download:""},y(l.file_name),9,wt),t("div",null,[p(" 文件大小："),t("span",null,y(l.file_size)+y(l.file_size_unit),1)])]),_:1})])])]))])}}}),Mt=I(Vt,[["__scopeId","data-v-d3aaee81"]]),Ct={class:"chat-content"},Et={key:0,class:"word"},Tt=["src"],qt={class:"info"},zt={class:"time"},It={class:"demo-image__preview"},Lt={key:1,class:"word-my"},Ht={class:"info"},Nt={class:"time"},Dt={class:"demo-image__preview"},Rt=["src"],jt=M({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(r,n)=>{const l=v("el-image");return s(),u("div",Ct,[e.is_sender?(s(),u("div",Lt,[t("div",Ht,[t("p",Nt,y(e.direction),1),t("div",Dt,[o(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,Rt)])):(s(),u("div",Et,[t("img",{src:e.headUrl},null,8,Tt),t("div",qt,[t("p",zt,y(e.direction),1),t("div",It,[o(l,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Ot=I(jt,[["__scopeId","data-v-4f39fede"]]),Ft={class:"chat-content"},Bt={key:0,class:"word"},Pt=["src"],At={class:"info"},Wt={class:"time"},Kt=["innerHTML"],Jt={key:1,class:"word-my"},Xt={class:"info"},Gt={class:"time"},Qt=["innerHTML"],Yt=["src"],Zt=M({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const r=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,l)=>(s(),u("div",Ft,[e.is_sender?(s(),u("div",Jt,[t("div",Xt,[t("p",Gt,y(e.direction),1),t("div",{class:"info-content",innerHTML:r(e.content)},null,8,Qt)]),t("img",{src:e.headUrl},null,8,Yt)])):(s(),u("div",Bt,[t("img",{src:e.headUrl},null,8,Pt),t("div",At,[t("p",Wt,y(e.direction),1),t("div",{class:"info-content",innerHTML:r(e.content)},null,8,Kt)])]))]))}}),en=I(Zt,[["__scopeId","data-v-3a49c7fd"]]),tn={id:"chat"},nn={class:"chat_body"},ln={class:"chat_window",ref:"chatWindow"},on={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},sn=M({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(e,{expose:r}){const n=e,l=w([]),i=w({}),a=w(!1),h=w(""),m=w(0),f=w(100),$=w(0),b=w(!1),x=async(c,C,V)=>{if(a.value){console.log("正在获取消息，请稍后再试!");return}if(V==""){console.log("wxid 为空, 请检查!");return}try{a.value=!0,c<0&&(c=0);const _=await q.post("/api/rs/msg_list",{start:c,limit:C,wxid:V});return l.value=_.msg_list,i.value=Object.assign(i.value,_.user_list),a.value=!1,_}catch(_){return a.value=!1,console.error("Error fetching data:",_),[]}},T=async()=>{try{h.value=await P(),$.value=await R(n.wxid),m.value=$.value-f.value,m.value<0&&(m.value=0),await x(m.value,f.value,n.wxid),b.value||await D(()=>{n.setScrollTop(),b.value=!1})}catch(c){return console.error("Error fetching data:",c),[]}};z(()=>n.wxid,(c,C)=>{console.log("username changed： ",C,c),l.value=[],i.value={},b.value=!1,$.value=0,m.value=0,T()});const g=async()=>{h.value=await P(),$.value=await R(n.wxid);let c=f.value,C=m.value-c;C<0&&(C=0);const V=await x(C,c,n.wxid);m.value=C,console.log("loadMore",C,m.value,c,n.wxid),l.value=V.msg_list.concat(l.value),l.value.sort((_,L)=>_.id-L.id),l.value=l.value.filter((_,L,K)=>L===0||_.id!==K[L-1].id),i.value=Object.assign(i.value,V.user_list),await D(()=>{n.updateScrollTop()})};r({loadMore:g});const U=c=>(c.talker=="我"&&(c.talker=h.value),`${(V=>i.value.hasOwnProperty(V.talker)?i.value[V.talker].remark?i.value[V.talker].remark:i.value[V.talker].nickname?i.value[V.talker].nickname:i.value[V.talker].account?i.value[V.talker].account:V.talker:V.talker)(c)} [${c.type_name}] ${c.CreateTime}`),k=c=>(c.talker=="我"&&(c.talker=h.value),i.value.hasOwnProperty(c.talker)?"/api/rs/imgsrc/"+i.value[c.talker].headImgUrl:"");return(c,C)=>{const V=v("el-button");return s(),u("div",tn,[t("div",nn,[t("div",ln,[l.value.length<$.value?(s(),u("div",on,[o(V,{type:"primary",onClick:g},{default:d(()=>[p("查看更多消息")]),_:1})])):E("",!0),(s(!0),u(H,null,A(l.value,(_,L)=>(s(),u("div",{class:"message",key:L},[_.type_name=="文本"?(s(),S($e,{key:0,is_sender:_.is_sender,direction:U(_),headUrl:k(_),content:_.msg},null,8,["is_sender","direction","headUrl","content"])):_.type_name=="图片"?(s(),S(Le,{key:1,is_sender:_.is_sender,direction:U(_),headUrl:k(_),src:"/rs_api/img/"+_.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="动画表情"?(s(),S(Ot,{key:2,is_sender:_.is_sender,direction:U(_),headUrl:k(_),src:"/rs_api/imgsrc/"+_.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="视频"?(s(),S(Ye,{key:3,is_sender:_.is_sender,direction:U(_),headUrl:k(_),src:"/rs_api/video/"+_.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="文件"?(s(),S(Mt,{key:4,is_sender:_.is_sender,direction:U(_),headUrl:k(_),src:_.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="语音"?(s(),S(pt,{key:5,is_sender:_.is_sender,direction:U(_),headUrl:k(_),src:"/rs_api/"+_.src,msg:_.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(s(),S(en,{key:6,is_sender:_.is_sender,direction:U(_),headUrl:k(_),content:_.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),rn=I(sn,[["__scopeId","data-v-778e289c"]]),an=t("br",null,null,-1),cn=t("br",null,null,-1),dn={style:{position:"relative"}},un=M({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(a,h)=>{console.log(a)});const n=w(""),l=w(""),i=async()=>{l.value="请求中...";try{l.value=await q.post("/api/rs/export_endb",{wx_path:n.value})}catch(a){return console.error("Error fetching data msg_count:",a),l.value=`请求失败
`+a,[]}};return(a,h)=>{const m=v("el-input"),f=v("el-button"),$=v("el-divider");return s(),u("div",null,[p(" 微信文件夹路径(可选)： "),o(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=b=>n.value=b),style:{width:"70%"}},null,8,["modelValue"]),an,cn,t("div",dn,[o(f,{type:"primary",onClick:h[1]||(h[1]=b=>i())},{default:d(()=>[p("导出")]),_:1})]),o($),o(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":h[2]||(h[2]=b=>l.value=b),style:{width:"100%"}},null,8,["modelValue"])])}}}),_n=t("br",null,null,-1),pn=t("br",null,null,-1),hn=t("br",null,null,-1),vn=t("br",null,null,-1),mn={style:{position:"relative"}},fn=M({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(h,m)=>{console.log(h)});const n=w(""),l=w(""),i=w(""),a=async()=>{i.value="正在处理中...";try{i.value=await q.post("/api/rs/export_dedb",{key:l.value,wx_path:n.value})}catch(h){return console.error("Error fetching data msg_count:",h),i.value=`请求失败
`+h,[]}};return(h,m)=>{const f=v("el-input"),$=v("el-button"),b=v("el-divider");return s(),u("div",null,[p(" 密钥(可选)： "),o(f,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=x=>l.value=x),style:{width:"75%"}},null,8,["modelValue"]),_n,pn,p(" 微信文件夹路径(可选)： "),o(f,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=x=>n.value=x),style:{width:"70%"}},null,8,["modelValue"]),hn,vn,t("div",mn,[o($,{type:"primary",onClick:m[2]||(m[2]=x=>a())},{default:d(()=>[p("导出")]),_:1})]),o(b),o(f,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:i.value,"onUpdate:modelValue":m[3]||(m[3]=x=>i.value=x),style:{width:"100%"}},null,8,["modelValue"])])}}}),yn={style:{position:"relative"}},xn=M({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(i,a)=>{console.log(i)});const n=w(""),l=async()=>{n.value="正在处理中...";try{n.value=await q.post("/api/rs/export_csv",{wxid:r.wxid})}catch(i){return console.error("Error fetching data msg_count:",i),n.value=`请求失败
`+i,[]}};return(i,a)=>{const h=v("el-button"),m=v("el-divider"),f=v("el-input");return s(),u("div",null,[t("div",yn,[o(h,{type:"primary",onClick:a[0]||(a[0]=$=>l())},{default:d(()=>[p("导出")]),_:1})]),o(m),o(f,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=$=>n.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),wn={style:{position:"relative"}},gn=M({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(i,a)=>{console.log(i)}),w([]);const n=w(""),l=async()=>{n.value="正在处理中...";try{n.value=await q.post("/api/rs/export_json",{wxid:r.wxid})}catch(i){return console.error("Error fetching data msg_count:",i),n.value=`请求失败
`+i,[]}};return(i,a)=>{const h=v("el-button"),m=v("el-divider"),f=v("el-input");return s(),u("div",null,[t("div",wn,[o(h,{type:"primary",onClick:a[0]||(a[0]=$=>l())},{default:d(()=>[p("导出")]),_:1})]),o(m),o(f,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=$=>n.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),$n={style:{position:"relative"}},bn=M({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(i,a)=>{console.log(i)}),w([]);const n=w(""),l=async()=>{n.value="正在处理中...";try{n.value=await q.post("/api/rs/export_html",{wxid:r.wxid})}catch(i){return console.error("Error fetching data msg_count:",i),n.value=`请求失败
`+i,[]}};return(i,a)=>{const h=v("el-button"),m=v("el-divider"),f=v("el-input");return s(),u("div",null,[t("div",$n,[o(h,{type:"primary",onClick:a[0]||(a[0]=$=>l())},{default:d(()=>[p("导出")]),_:1})]),o(m),o(f,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=$=>n.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),kn=t("br",null,null,-1),Sn=M({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(l,i)=>{console.log(l)});const n=()=>{console.log("requestExport")};return(l,i)=>{const a=v("el-button");return s(),u("div",null,[t("span",null,y(r.wxid),1),kn,o(a,{type:"primary",onClick:i[0]||(i[0]=h=>n())},{default:d(()=>[p("导出")]),_:1})])}}}),Un=t("br",null,null,-1),Vn=M({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(l,i)=>{console.log(l)});const n=()=>{console.log("requestExport")};return(l,i)=>{const a=v("el-button");return s(),u("div",null,[t("span",null,y(r.wxid),1),Un,o(a,{type:"primary",onClick:i[0]||(i[0]=h=>n())},{default:d(()=>[p("导出")]),_:1})])}}}),Mn={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Cn={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},En={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Tn=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),qn={style:{"margin-top":"20px"}},zn=t("br",null,null,-1),In=t("br",null,null,-1),Ln={key:0},Hn=M({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(e){const r=e;z(()=>r.wxid,(i,a)=>{console.log(i)});const n=w("");w("");const l={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(i,a)=>{const h=v("el-option"),m=v("el-select"),f=v("el-divider"),$=v("el-main");return s(),u("div",Mn,[o($,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:d(()=>[t("div",Cn,[t("div",En,[Tn,t("div",qn,[p(" 导出类型: "),o(m,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=b=>n.value=b)},{default:d(()=>[(s(),u(H,null,A(l,(b,x)=>o(h,{label:b.brief,value:x,key:x},{default:d(()=>[p(y(b.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),zn,In,n.value?(s(),u("span",Ln,y(l[n.value].detail),1)):E("",!0)]),o(f),n.value=="endb"?(s(),S(un,{key:0,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="dedb"?(s(),S(fn,{key:1,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="csv"?(s(),S(xn,{key:2,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="json"?(s(),S(gn,{key:3,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="html"?(s(),S(bn,{key:4,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="pdf"?(s(),S(Sn,{key:5,wxid:r.wxid},null,8,["wxid"])):E("",!0),n.value=="docx"?(s(),S(Vn,{key:6,wxid:r.wxid},null,8,["wxid"])):E("",!0)])])]),_:1})])}}}),Nn=M({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(e){const r=w(null),n=w(null);w(0);const l=w(0),i=()=>{D(()=>{if(r.value){const x=r.value.$el.children[0];x&&(x.scrollTop=x.scrollHeight,l.value=x.scrollHeight)}})},a=()=>{const x=r.value.$el.children[0];if(x){const T=l.value,g=x.scrollHeight-T;x.scrollTop=x.scrollTop+g,l.value=x.scrollHeight}};function h({scrollTop:x}){x===0&&n.value&&n.value.loadMore()}const m=e,f=w(!1),$=x=>{f.value=x},b=async()=>{f.value=!1,await D(()=>{i()})};return z(()=>m.wxid,async(x,T)=>{x!==T&&await b()}),N(()=>{b()}),(x,T)=>{const g=v("el-header"),U=v("el-scrollbar"),k=v("el-main"),c=v("el-container");return s(),S(c,null,{default:d(()=>[o(g,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:d(()=>[o(ce,{wxid:e.wxid,onExporting:$},null,8,["wxid"])]),_:1}),o(k,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:d(()=>[o(U,{ref_key:"scrollbarRef",ref:r,onScroll:h},{default:d(()=>[f.value?(s(),S(Hn,{key:0,wxid:e.wxid},null,8,["wxid"])):(s(),S(rn,{key:1,ref_key:"chatRecordsMainRef",ref:n,wxid:e.wxid,setScrollTop:i,updateScrollTop:a},null,8,["wxid"]))]),_:1},512)]),_:1})]),_:1})}}}),Dn={id:"chat_view",class:"common-layout"},Rn={key:0,style:{height:"calc(100vh)",width:"100%"}},jn={key:1,style:{width:"100%",height:"100%"}},Pn=M({__name:"ChatView",setup(e){const r=w(""),n=l=>{r.value=l};return N(()=>{G().then(l=>{console.log("API version: "+l)}).catch(l=>{console.error("Error fetching API version:",l)})}),(l,i)=>{const a=v("el-aside"),h=v("el-container");return s(),u("div",Dn,[t("div",null,[o(h,null,{default:d(()=>[o(a,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:d(()=>[o(re,{onWxid:n})]),_:1}),r.value!=""?(s(),u("div",Rn,[o(Nn,{wxid:r.value},null,8,["wxid"])])):(s(),u("div",jn,[o(Q)]))]),_:1})])])}}});export{Pn as default};
