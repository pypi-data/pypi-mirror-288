import{k as L,x as F,d as S,a as f,o as l,c as u,e as t,b as s,f as _,g as r,t as c,h as k,i as g,r as x,q as j,y as Z,u as N,z as W,A as ee,B as te,_ as q,w as z,F as H,C as P,D as ne,G as K,H as O,I as oe,s as le}from"./index-06XPMlP6.js";/* empty css                                                                       */import{_ as se}from"./IndexView.vue_vue_type_script_setup_true_lang-YRMKdUyd.js";const G=(e="",i=[],n=[])=>L.post("/api/rs/user_list",{word:e,wxids:i,labels:n}).then(o=>o).catch(o=>(console.log(o),"")),A=()=>L.post("/api/rs/user_session_list",{}).then(e=>e).catch(e=>(console.log(e),[])),ie=()=>L.get("/api/rs/mywxid").then(e=>e.my_wxid).catch(e=>(console.log(e),"")),re=()=>L.post("/api/ls/realtimemsg",{}).then(e=>(console.log(e),F({title:"Success",message:"获取实时消息成功!",type:"success"}),!0)).catch(e=>(console.log(e),F({title:"Error",message:"获取实时消息失败!",type:"error"}),!1)),ae=e=>L.post("/api/rs/msg_count",{wxids:e}).then(i=>i).catch(i=>(console.log(i),"")),J=e=>ae([e]).then(i=>i[e]).catch(i=>(console.log(i),0)),ce=(e,i,n)=>L.post("/api/rs/msg_list",{start:i,limit:n,wxid:e}).then(o=>o).catch(o=>(console.log(o),"")),de={key:0,style:{"max-width":"560px"}},ue=t("br",null,null,-1),_e=t("br",null,null,-1),he=t("br",null,null,-1),fe=t("br",null,null,-1),me=t("br",null,null,-1),pe=t("br",null,null,-1),ve=t("br",null,null,-1),xe=t("br",null,null,-1),ye=t("br",null,null,-1),we=t("br",null,null,-1),ge=t("br",null,null,-1),$e=t("br",null,null,-1),be=t("br",null,null,-1),ke=t("br",null,null,-1),Ee=t("span",null,[r("朋友圈背景："),t("br")],-1),Se={key:1,style:{"max-width":"560px"}},Ue=t("br",null,null,-1),Ce=t("br",null,null,-1),Ve=t("br",null,null,-1),Me={key:0},Be=t("br",null,null,-1),Ie={key:1},ze=t("br",null,null,-1),Le={key:2},Te=t("br",null,null,-1),qe={key:3},De=t("br",null,null,-1),Ne={key:4},je=t("br",null,null,-1),He={key:5},Re=t("br",null,null,-1),Oe={key:6},Fe=t("br",null,null,-1),Pe={key:7},Ae=t("br",null,null,-1),We={key:8},Ke=t("br",null,null,-1),Ge={key:9},Je=t("br",null,null,-1),Xe={key:10},Qe=t("br",null,null,-1),Ye={key:11},Ze=t("br",null,null,-1),X=S({__name:"UserInfoShow",props:{userinfo:{type:Object,default:()=>({})},show_all:{type:Boolean,default:!0,required:!1}},setup(e){return(i,n)=>{const o=f("el-divider"),a=f("el-image");return e.show_all?(l(),u("div",de,[t("div",null,[s(o,{"content-position":"center"},{default:_(()=>[r("基本信息")]),_:1}),t("span",null,[r("wxid："+c(e.userinfo.wxid),1),ue]),t("span",null,[r("账号："+c(e.userinfo.account),1),_e]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),he]),t("span",null,[r("备注："+c(e.userinfo.remark),1),fe])]),t("div",null,[s(o,{"content-position":"center"},{default:_(()=>[r("个人信息")]),_:1}),t("span",null,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),me]),t("span",null,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),pe]),t("span",null,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),ve]),t("span",null,[r("描述："+c(e.userinfo.describe),1),xe]),t("span",null,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),ye]),t("span",null,[r("国家："+c(e.userinfo.ExtraBuf.国),1),we]),t("span",null,[r("省份："+c(e.userinfo.ExtraBuf.省),1),ge]),t("span",null,[r("市名："+c(e.userinfo.ExtraBuf.市),1),$e])]),t("div",null,[s(o,{"content-position":"center"},{default:_(()=>[r("其他信息")]),_:1}),t("span",null,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),be]),t("span",null,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),ke]),Ee,e.userinfo.ExtraBuf.朋友圈背景?(l(),k(a,{key:0,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):g("",!0)])])):(l(),u("div",Se,[t("span",null,[r("wxid："+c(e.userinfo.wxid),1),Ue]),t("span",null,[r("账号："+c(e.userinfo.account),1),Ce]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),Ve]),e.userinfo.remark?(l(),u("span",Me,[r("备注："+c(e.userinfo.remark),1),Be])):g("",!0),e.userinfo.ExtraBuf["性别[1男2女]"]?(l(),u("span",Ie,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),ze])):g("",!0),e.userinfo.ExtraBuf.手机号?(l(),u("span",Le,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),Te])):g("",!0),e.userinfo.LabelIDList&&e.userinfo.LabelIDList.length>0?(l(),u("span",qe,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),De])):g("",!0),e.userinfo.describe?(l(),u("span",Ne,[r("描述："+c(e.userinfo.describe),1),je])):g("",!0),e.userinfo.ExtraBuf.个性签名?(l(),u("span",He,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),Re])):g("",!0),e.userinfo.ExtraBuf.国?(l(),u("span",Oe,[r("国家："+c(e.userinfo.ExtraBuf.国),1),Fe])):g("",!0),e.userinfo.ExtraBuf.省?(l(),u("span",Pe,[r("省份："+c(e.userinfo.ExtraBuf.省),1),Ae])):g("",!0),e.userinfo.ExtraBuf.市?(l(),u("span",We,[r("市名："+c(e.userinfo.ExtraBuf.市),1),Ke])):g("",!0),e.userinfo.ExtraBuf.公司名称?(l(),u("span",Ge,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),Je])):g("",!0),e.userinfo.ExtraBuf.企微属性?(l(),u("span",Xe,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),Qe])):g("",!0),e.userinfo.ExtraBuf.朋友圈背景?(l(),u("span",Ye,[r("朋友圈背景："),Ze])):g("",!0),e.userinfo.ExtraBuf.朋友圈背景?(l(),k(a,{key:12,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):g("",!0)]))}}}),et=e=>(ee("data-v-a26d5cf5"),e=e(),te(),e),tt={style:{padding:"10px 10px"}},nt={slot:"content",class:"tips"},ot=et(()=>t("br",null,null,-1)),lt={key:0,style:{color:"#909399","font-size":"12px"}},st=S({__name:"ContactsList",emits:["wxid"],setup(e,{emit:i}){const n=x([]);j(async()=>{try{n.value=await A()}catch(p){return console.error("Error fetching data:",p),[]}});const a=x(""),d=async()=>{try{if(a.value===""){n.value=await A();return}console.log(a.value),n.value=[];const p=await G(a.value);p!==null&&typeof p=="object"&&Object.entries(p).forEach(([w,U])=>{n.value.push(U)})}catch(p){return console.error("Error fetching data:",p),[]}},h=i,m=p=>{p!==void 0&&p.wxid!==void 0&&h("wxid",p.wxid)};return(p,w)=>{const U=f("el-input"),$=f("el-button"),I=f("el-avatar"),T=f("el-table-column"),b=f("el-tooltip"),V=f("el-table");return l(),u("div",null,[t("div",tt,[s(U,{placeholder:"请输入关键字",modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=E=>a.value=E),onKeyup:Z(d,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),s($,{type:"primary",onClick:d,style:{width:"50px"}},{default:_(()=>[r("搜索")]),_:1})]),s(V,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:m},{default:_(()=>[s(T,{width:"57"},{default:_(({row:E})=>[E.headImgUrl!==""?(l(),k(I,{key:0,size:33,src:"/api/rs/imgsrc/"+E.headImgUrl},null,8,["src"])):(l(),k(I,{key:1,size:33},{default:_(()=>[r(" 群")]),_:1}))]),_:1}),s(T,{width:"190"},{default:_(({row:E})=>[s(b,{class:"item",effect:"light",placement:"right"},{content:_(()=>[s(X,{userinfo:E,show_all:!1,style:{"max-width":"600px"}},null,8,["userinfo"])]),default:_(()=>[t("div",nt,[t("span",null,c(N(W)(E)),1),r(),ot,E.nTime?(l(),u("span",lt,c(E.nTime),1)):g("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),it=q(st,[["__scopeId","data-v-a26d5cf5"]]),rt=S({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(e,{emit:i}){const n=e,o=x(0),a=x({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:{个性签名:"",企微属性:"",公司名称:"",国:"",备注图片:"",备注图片2:"",市:"","性别[1男2女]":0,手机号:"",朋友圈背景:"",省:""},LabelIDList:[]}),d=async()=>{try{const b=await G("",[n.wxid]);return a.value=b[n.wxid],a.value.wxid=n.wxid,b}catch(b){return console.error("Error fetching data wxid2user :",b),[]}},h=async()=>{try{o.value=0;const b=await J(n.wxid);return o.value=b,b}catch(b){return console.error("Error fetching data msg_count:",b),[]}},m=()=>{$.value=!1,d(),h()};j(()=>{m()}),z(()=>n.wxid,async(b,V)=>{b!==V&&m()});const p=x(!1),w=x(!1),U=async()=>{if(w.value){console.log("正在获取实时消息，请稍后再试!");return}w.value=!0;try{const b=await re();return w.value=!1,b}catch{return w.value=!1,[]}},$=x(!1),I=i,T=b=>{I("exporting",b),$.value=b};return(b,V)=>{const E=f("el-text"),D=f("el-col"),y=f("el-row"),C=f("el-dialog");return l(),u(H,null,[s(y,{gutter:5,style:{width:"100%"}},{default:_(()=>[s(D,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("wxid:")]),_:1}),r("  "),s(E,{class:"data_color mx-1",truncated:"",title:a.value.wxid},{default:_(()=>[r(c(a.value.wxid),1)]),_:1},8,["title"])]),_:1}),s(D,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("名称:")]),_:1}),r("  "),s(E,{class:"data_color mx-1",truncated:"",title:"show_name"},{default:_(()=>[r(c(N(W)(a.value)),1)]),_:1})]),_:1}),s(D,{span:5,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("数量:")]),_:1}),r("  "),s(E,{class:"data_color mx-1",truncated:"",title:o.value},{default:_(()=>[r(c(o.value),1)]),_:1},8,["title"])]),_:1}),s(D,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"button_color mx-1 underline",truncated:"",onClick:V[0]||(V[0]=B=>p.value=!p.value)},{default:_(()=>[r(" 详细信息")]),_:1})]),_:1}),s(D,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[$.value?g("",!0):(l(),k(E,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:V[1]||(V[1]=B=>{T(!0)})},{default:_(()=>[r("导出备份 ")]),_:1})),$.value?(l(),k(E,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:V[2]||(V[2]=B=>{T(!1)})},{default:_(()=>[r("聊天查看 ")]),_:1})):g("",!0)]),_:1}),s(D,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"button_color mx-1 underline",truncated:"",onClick:V[3]||(V[3]=B=>{U()})},{default:_(()=>[r("实时消息 "),w.value?(l(),u(H,{key:0},[r("...")],64)):g("",!0)]),_:1})]),_:1})]),_:1}),s(C,{modelValue:p.value,"onUpdate:modelValue":V[4]||(V[4]=B=>p.value=B),title:"详细信息",width:"600",center:""},{default:_(()=>[s(X,{userinfo:a.value,show_all:!0},null,8,["userinfo"])]),_:1},8,["modelValue"])],64)}}}),at=q(rt,[["__scopeId","data-v-51a93461"]]),ct={class:"chat-content"},dt={key:0,class:"word"},ut=["src"],_t={class:"info"},ht={class:"time"},ft=["innerHTML"],mt={key:1,class:"word-my"},pt={class:"info"},vt={class:"time"},xt=["innerHTML"],yt=["src"],wt=S({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,o)=>(l(),u("div",ct,[e.is_sender?(l(),u("div",mt,[t("div",pt,[t("p",vt,c(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,xt)]),t("img",{src:e.headUrl},null,8,yt)])):(l(),u("div",dt,[t("img",{src:e.headUrl},null,8,ut),t("div",_t,[t("p",ht,c(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,ft)])]))]))}}),gt=q(wt,[["__scopeId","data-v-40672aa8"]]),$t={class:"chat-content"},bt={key:0,class:"word"},kt=["src"],Et={class:"info"},St={class:"time"},Ut={class:"demo-image__preview"},Ct={key:1,class:"word-my"},Vt={class:"info"},Mt={class:"time"},Bt={class:"demo-image__preview"},It=["src"],zt=S({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>{const o=f("el-image");return l(),u("div",$t,[e.is_sender?(l(),u("div",Ct,[t("div",Vt,[t("p",Mt,c(e.direction),1),t("div",Bt,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,It)])):(l(),u("div",bt,[t("img",{src:e.headUrl},null,8,kt),t("div",Et,[t("p",St,c(e.direction),1),t("div",Ut,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Lt=q(zt,[["__scopeId","data-v-50919614"]]),Tt={class:"chat-content"},qt={key:0,class:"word"},Dt=["src"],Nt={class:"info"},jt={class:"time"},Ht={class:"demo-video__preview"},Rt={controls:"",width:"30%"},Ot=["src"],Ft={key:1,class:"word-my"},Pt={class:"info"},At={class:"time"},Wt={class:"demo-video__preview"},Kt={controls:"",width:"50%"},Gt=["src"],Jt=["src"],Xt=S({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>(l(),u("div",Tt,[e.is_sender?(l(),u("div",Ft,[t("div",Pt,[t("p",At,c(e.direction),1),t("div",Wt,[t("video",Kt,[t("source",{src:e.src,type:"video/mp4"},null,8,Gt)])])]),t("img",{src:e.headUrl},null,8,Jt)])):(l(),u("div",qt,[t("img",{src:e.headUrl},null,8,Dt),t("div",Nt,[t("p",jt,c(e.direction),1),t("div",Ht,[t("video",Rt,[t("source",{src:e.src,type:"video/mp4"},null,8,Ot)])])])]))]))}}),Qt=q(Xt,[["__scopeId","data-v-aa7dcebf"]]),Yt={class:"chat-content"},Zt={key:0,class:"word"},en=["src"],tn={class:"info"},nn={class:"time"},on={controls:"",style:{"background-color":"#fff"}},ln=["src"],sn={key:1,class:"word-my"},rn={class:"info"},an={class:"time"},cn={controls:"",style:{"background-color":"#95EC69"}},dn=["src"],un=["src"],_n=S({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){return(i,n)=>(l(),u("div",Yt,[e.is_sender?(l(),u("div",sn,[t("div",rn,[t("p",an,c(e.direction),1),t("audio",cn,[t("source",{src:e.src,type:"audio/wav"},null,8,dn)]),s(N(P),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),t("img",{src:e.headUrl},null,8,un)])):(l(),u("div",Zt,[t("img",{src:e.headUrl},null,8,en),t("div",tn,[t("p",nn,c(e.direction),1),t("audio",on,[t("source",{src:e.src,type:"audio/wav"},null,8,ln)]),s(N(P),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),hn=q(_n,[["__scopeId","data-v-c9969dce"]]),fn={class:"chat-content"},mn={key:0,class:"word"},pn=["src"],vn={class:"info"},xn={class:"time"},yn={style:{float:"left"}},wn=["href"],gn={key:1,class:"word-my"},$n={class:"info"},bn={class:"time"},kn={style:{float:"right"}},En=["href"],Sn=["src"],Un=S({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const i=e,n=x(""),o=ne({file_name:String,file_size:Number,file_size_unit:String});j(async()=>{console.log("文件加载中");const d=await a(i.src);o.file_name=d.file_name,o.file_size=Number(d.file_size)/1024,o.file_size<1024?o.file_size_unit="kb":(o.file_size=o.file_size/1024,o.file_size_unit="mb"),o.file_size=Number(d.file_size)/1024,n.value=`/api/file/${i.src}`});const a=async d=>{try{return await L.post("/api/rs/file_info",{file_path:d})}catch(h){return console.error("Error fetching file_info:",h),""}};return(d,h)=>{const m=f("el-card");return l(),u("div",fn,[e.is_sender?(l(),u("div",gn,[t("div",$n,[t("p",bn,c(e.direction),1),t("div",kn,[s(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(o.file_name),9,En),t("div",null,[r(" 文件大小："),t("span",null,c(o.file_size)+c(o.file_size_unit),1)])]),_:1})])]),t("img",{src:e.headUrl},null,8,Sn)])):(l(),u("div",mn,[t("img",{src:e.headUrl},null,8,pn),t("div",vn,[t("p",xn,c(e.direction),1),t("div",yn,[s(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(o.file_name),9,wn),t("div",null,[r(" 文件大小："),t("span",null,c(o.file_size)+c(o.file_size_unit),1)])]),_:1})])])]))])}}}),Cn=q(Un,[["__scopeId","data-v-d3aaee81"]]),Vn={class:"chat-content"},Mn={key:0,class:"word"},Bn=["src"],In={class:"info"},zn={class:"time"},Ln={class:"demo-image__preview"},Tn={key:1,class:"word-my"},qn={class:"info"},Dn={class:"time"},Nn={class:"demo-image__preview"},jn=["src"],Hn=S({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(i,n)=>{const o=f("el-image");return l(),u("div",Vn,[e.is_sender?(l(),u("div",Tn,[t("div",qn,[t("p",Dn,c(e.direction),1),t("div",Nn,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,jn)])):(l(),u("div",Mn,[t("img",{src:e.headUrl},null,8,Bn),t("div",In,[t("p",zn,c(e.direction),1),t("div",Ln,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Rn=q(Hn,[["__scopeId","data-v-4f39fede"]]),On={class:"chat-content"},Fn={key:0,class:"word"},Pn=["src"],An={class:"info"},Wn={class:"time"},Kn=["innerHTML"],Gn={key:1,class:"word-my"},Jn={class:"info"},Xn={class:"time"},Qn=["innerHTML"],Yn=["src"],Zn=S({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,o)=>(l(),u("div",On,[e.is_sender?(l(),u("div",Gn,[t("div",Jn,[t("p",Xn,c(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,Qn)]),t("img",{src:e.headUrl},null,8,Yn)])):(l(),u("div",Fn,[t("img",{src:e.headUrl},null,8,Pn),t("div",An,[t("p",Wn,c(e.direction),1),t("div",{class:"info-content",innerHTML:i(e.content)},null,8,Kn)])]))]))}}),eo=q(Zn,[["__scopeId","data-v-56977698"]]),to={id:"chat"},no=["id"],oo=S({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0}},setup(e){const i=e,n=x([]),o=x({}),a=x(!1),d=x(""),h=x(0),m=x(100),p=x(0),w=x(0),U=x(0),$=y=>(y.talker=="我"&&(y.talker=d.value),`${(B=>{const M=o.value[B.talker];return(M==null?void 0:M.remark)||(M==null?void 0:M.nickname)||(M==null?void 0:M.account)||B.talker})(y)} [${y.type_name}] ${y.CreateTime}`),I=y=>(y.talker=="我"&&(y.talker=d.value),o.value.hasOwnProperty(y.talker)?O(o.value[y.talker].headImgUrl):""),T=async(y="")=>{if(a.value){console.log("正在获取消息，请稍后再试!");return}if(i.wxid==""){console.log("wxid 为空, 请检查!");return}try{a.value=!0,h.value<0&&(h.value=0),console.log("fetchData",i.wxid,h.value,m.value);const C=await ce(i.wxid,h.value,m.value);return n.value=C.msg_list,o.value=Object.assign(o.value,C.user_list),n.value=n.value.filter((B,M,R)=>M===0||B.id!==R[M-1].id),n.value.sort((B,M)=>B.id-M.id),p.value=n.value[0].id,w.value=n.value[n.value.length-1].id,y=="top"?D(n.value[0].id):y=="bottom"&&D(n.value[n.value.length-1].id),a.value=!1,C}catch(C){return a.value=!1,console.error("Error fetching data:",C),[]}},b=async()=>{try{n.value=[],o.value={},a.value=!1,h.value=0,m.value=m.value||100,p.value=0,w.value=0,d.value=await ie(),U.value=await J(i.wxid),await T()}catch(y){return console.error("Error fetching data:",y),[]}};z(()=>i.wxid,(y,C)=>{console.log("username changed： ",C,y),b()}),z(()=>h.value,(y,C)=>{console.log("msg start changed： ",C,y),y>C?T("top"):T("bottom")}),j(()=>{b()});const V=y=>{m.value=y,T()},E=y=>{h.value=(y-1)*m.value},D=y=>{oe(()=>{const C=document.getElementById(`message-${y}`);console.log(`scrollToId： message-${y}`),C&&C.scrollIntoView({behavior:"instant",block:"center"})})};return(y,C)=>{const B=f("el-main"),M=f("el-pagination"),R=f("el-footer"),Q=f("el-container");return l(),u("div",to,[s(Q,{class:"chat-records-main-container"},{default:_(()=>[s(B,{class:"chat-records-main-main"},{default:_(()=>[(l(!0),u(H,null,K(n.value,(v,Y)=>(l(),u("div",{class:"message",key:Y,id:`message-${v.id}`},[v.type_name=="文本"?(l(),k(gt,{key:0,is_sender:v.is_sender,direction:$(v),headUrl:I(v),content:v.msg},null,8,["is_sender","direction","headUrl","content"])):v.type_name=="图片"?(l(),k(Lt,{key:1,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:N(O)(v.src)},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="动画表情"?(l(),k(Rn,{key:2,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:N(O)(v.src)},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="视频"?(l(),k(Qt,{key:3,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:"/api/rs/video/"+v.src},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="文件"?(l(),k(Cn,{key:4,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:v.src},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="语音"?(l(),k(hn,{key:5,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:"/api/rs/"+v.src,msg:v.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(l(),k(eo,{key:6,is_sender:v.is_sender,direction:$(v),headUrl:I(v),content:v.msg},null,8,["is_sender","direction","headUrl","content"]))],8,no))),128))]),_:1}),s(R,{height:"20px",class:"chat-records-main-footer"},{default:_(()=>[s(M,{background:"",small:"",layout:"sizes, prev, pager, next, jumper",total:U.value,"page-size":m.value,"page-sizes":[50,100,200,300,500],onSizeChange:V,"current-page":Math.floor(h.value/m.value+1),onCurrentChange:E},null,8,["total","page-size","current-page"])]),_:1})]),_:1})])}}}),lo=q(oo,[["__scopeId","data-v-55806267"]]),so=t("br",null,null,-1),io=t("br",null,null,-1),ro={style:{position:"relative"}},ao=S({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(d,h)=>{console.log(d)});const n=x(""),o=x(""),a=async()=>{o.value="请求中...";try{o.value=await L.post("/api/rs/export_endb",{wx_path:n.value})}catch(d){return console.error("Error fetching data msg_count:",d),o.value=`请求失败
`+d,[]}};return(d,h)=>{const m=f("el-input"),p=f("el-button"),w=f("el-divider");return l(),u("div",null,[r(" 微信文件夹路径(可选)： "),s(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=U=>n.value=U),style:{width:"70%"}},null,8,["modelValue"]),so,io,t("div",ro,[s(p,{type:"primary",onClick:h[1]||(h[1]=U=>a())},{default:_(()=>[r("导出")]),_:1})]),s(w),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=U=>o.value=U),style:{width:"100%"}},null,8,["modelValue"])])}}}),co=t("br",null,null,-1),uo=t("br",null,null,-1),_o=t("br",null,null,-1),ho=t("br",null,null,-1),fo={style:{position:"relative"}},mo=S({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(h,m)=>{console.log(h)});const n=x(""),o=x(""),a=x(""),d=async()=>{a.value="正在处理中...";try{a.value=await L.post("/api/rs/export_dedb",{key:o.value,wx_path:n.value})}catch(h){return console.error("Error fetching data msg_count:",h),a.value=`请求失败
`+h,[]}};return(h,m)=>{const p=f("el-input"),w=f("el-button"),U=f("el-divider");return l(),u("div",null,[r(" 密钥(可选)： "),s(p,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=$=>o.value=$),style:{width:"75%"}},null,8,["modelValue"]),co,uo,r(" 微信文件夹路径(可选)： "),s(p,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=$=>n.value=$),style:{width:"70%"}},null,8,["modelValue"]),_o,ho,t("div",fo,[s(w,{type:"primary",onClick:m[2]||(m[2]=$=>d())},{default:_(()=>[r("导出")]),_:1})]),s(U),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":m[3]||(m[3]=$=>a.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),po={style:{position:"relative"}},vo=S({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(a,d)=>{console.log(a)});const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await L.post("/api/rs/export_csv",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[t("div",po,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[r("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),xo={style:{position:"relative"}},yo=S({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(a,d)=>{console.log(a)}),x([]);const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await L.post("/api/rs/export_json",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[t("div",xo,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[r("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),wo={style:{position:"relative"}},go=S({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(a,d)=>{console.log(a)}),x([]);const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await L.post("/api/rs/export_html",{wxid:i.wxid})}catch(a){return console.error("Error fetching data msg_count:",a),n.value=`请求失败
`+a,[]}};return(a,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[t("div",wo,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[r("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),$o=t("br",null,null,-1),bo=S({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(o,a)=>{console.log(o)});const n=()=>{console.log("requestExport")};return(o,a)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(i.wxid),1),$o,s(d,{type:"primary",onClick:a[0]||(a[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),ko=t("br",null,null,-1),Eo=S({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(o,a)=>{console.log(o)});const n=()=>{console.log("requestExport")};return(o,a)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(i.wxid),1),ko,s(d,{type:"primary",onClick:a[0]||(a[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),So={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Uo={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Co={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Vo=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Mo={style:{"margin-top":"20px"}},Bo=t("br",null,null,-1),Io=t("br",null,null,-1),zo={key:0},Lo=S({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(e){const i=e;z(()=>i.wxid,(a,d)=>{console.log(a)});const n=x("");x("");const o={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(a,d)=>{const h=f("el-option"),m=f("el-select"),p=f("el-divider"),w=f("el-main");return l(),u("div",So,[s(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[t("div",Uo,[t("div",Co,[Vo,t("div",Mo,[r(" 导出类型: "),s(m,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=U=>n.value=U)},{default:_(()=>[(l(),u(H,null,K(o,(U,$)=>s(h,{label:U.brief,value:$,key:$},{default:_(()=>[r(c(U.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Bo,Io,n.value?(l(),u("span",zo,c(o[n.value].detail),1)):g("",!0)]),s(p),n.value=="endb"?(l(),k(ao,{key:0,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="dedb"?(l(),k(mo,{key:1,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="csv"?(l(),k(vo,{key:2,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="json"?(l(),k(yo,{key:3,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="html"?(l(),k(go,{key:4,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="pdf"?(l(),k(bo,{key:5,wxid:i.wxid},null,8,["wxid"])):g("",!0),n.value=="docx"?(l(),k(Eo,{key:6,wxid:i.wxid},null,8,["wxid"])):g("",!0)])])]),_:1})])}}}),To=S({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(e){const i=e,n=x(!1),o=d=>{n.value=d},a=()=>{n.value=!1};return z(()=>i.wxid,async(d,h)=>{d!==h&&a()}),j(()=>{a()}),(d,h)=>{const m=f("el-header"),p=f("el-main"),w=f("el-container");return l(),k(w,null,{default:_(()=>[s(m,{style:{height:"40px","max-height":"40px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:_(()=>[s(at,{wxid:e.wxid,onExporting:o},null,8,["wxid"])]),_:1}),s(p,{style:{height:"calc(100vh - 40px)",padding:"0",margin:"0","background-color":"#f5f5f5"}},{default:_(()=>[n.value?(l(),k(Lo,{key:0,wxid:e.wxid},null,8,["wxid"])):(l(),k(lo,{key:1,wxid:e.wxid},null,8,["wxid"]))]),_:1})]),_:1})}}}),qo={id:"chat_view",class:"common-layout"},Do={key:0,style:{height:"calc(100vh)",width:"100%"}},No={key:1,style:{width:"100%",height:"100%"}},Oo=S({__name:"ChatView",setup(e){const i=x(""),n=o=>{i.value=o};return j(()=>{le().then(o=>{console.log("API version: "+o)}).catch(o=>{console.error("Error fetching API version:",o)})}),(o,a)=>{const d=f("el-aside"),h=f("el-container");return l(),u("div",qo,[t("div",null,[s(h,null,{default:_(()=>[s(d,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:_(()=>[s(it,{onWxid:n})]),_:1}),i.value!=""?(l(),u("div",Do,[s(To,{wxid:i.value},null,8,["wxid"])])):(l(),u("div",No,[s(se)]))]),_:1})])])}}});export{Oo as default};
